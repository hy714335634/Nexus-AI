<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus-AI Platform - å¤šAgentå¯¹è¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .dialog-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .dialog-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dialog-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .selected-agents {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .agent-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .dialog-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
            overflow: hidden;
        }
        
        .chat-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
            margin-bottom: 1rem;
        }
        
        .message {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .message.agent .message-avatar {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
        }
        
        .message-content {
            flex: 1;
            max-width: 70%;
        }
        
        .message.user .message-content {
            text-align: right;
        }
        
        .message-bubble {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1rem;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .message.user .message-bubble {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .message.agent .message-bubble {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            color: white;
        }
        
        .message-text {
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }
        
        .message-time {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .agent-response {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
        }
        
        .response-header {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .response-content {
            color: #333;
            line-height: 1.5;
        }
        
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.2rem;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            min-height: 60px;
            max-height: 120px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .send-button {
            padding: 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            min-width: 60px;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .agent-status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .status-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .status-agents {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .status-agent {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #667eea;
            font-weight: 600;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .dialog-content {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .chat-input-container {
                flex-direction: column;
            }
            
            .send-button {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="dialog-container">
        <!-- å¯¹è¯å¤´éƒ¨ -->
        <div class="dialog-header">
            <div class="header-content">
                <div>
                    <div class="dialog-title">
                        ğŸ¤– å¤šAgentåä½œå¯¹è¯
                    </div>
                    <div class="selected-agents" id="selectedAgents">
                        <!-- é€‰ä¸­çš„Agentæ ‡ç­¾å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="clearChat()">ğŸ—‘ï¸ æ¸…ç©ºå¯¹è¯</button>
                    <button class="btn btn-secondary" onclick="exportChat()">ğŸ“¤ å¯¼å‡ºå¯¹è¯</button>
                    <button class="btn btn-primary" onclick="closeDialog()">âŒ å…³é—­</button>
                </div>
            </div>
        </div>

        <!-- å¯¹è¯å†…å®¹ -->
        <div class="dialog-content">
            <!-- AgentçŠ¶æ€æ  -->
            <div class="agent-status-bar">
                <div class="status-title">ğŸ”„ åä½œAgentçŠ¶æ€</div>
                <div class="status-agents" id="statusAgents">
                    <!-- AgentçŠ¶æ€å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>

            <!-- å¯¹è¯å®¹å™¨ -->
            <div class="chat-container">
                <!-- æ¶ˆæ¯åŒºåŸŸ -->
                <div class="chat-messages" id="chatMessages">
                    <div class="message agent">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">
                                    æ¬¢è¿ä½¿ç”¨å¤šAgentåä½œå¯¹è¯ï¼æˆ‘å·²ç»å‡†å¤‡å¥½ä¸æ‚¨é€‰ä¸­çš„Agentå›¢é˜Ÿä¸€èµ·ä¸ºæ‚¨æœåŠ¡ã€‚
                                    <br><br>
                                    è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Œæˆ‘ä¼šåè°ƒç›¸å…³Agentä¸ºæ‚¨æä¾›æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚
                                </div>
                                <div class="message-time">åˆšåˆš</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¾“å…¥æŒ‡ç¤ºå™¨ -->
                <div class="typing-indicator" id="typingIndicator">
                    <span>Agentå›¢é˜Ÿæ­£åœ¨åä½œå¤„ç†</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="chat-input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="ğŸ’­ æè¿°æ‚¨éœ€è¦å®Œæˆçš„ä»»åŠ¡...

ä¾‹å¦‚ï¼šæˆ‘éœ€è¦åˆ†æå®¢æˆ·æŠ•è¯‰æ•°æ®ï¼Œç”Ÿæˆæœˆåº¦æŠ¥å‘Šï¼Œå¹¶è‡ªåŠ¨å‘é€ç»™ç›¸å…³éƒ¨é—¨è´Ÿè´£äºº"></textarea>
                    <button class="send-button" id="sendButton" onclick="sendMessage()">ğŸš€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è¦†ç›–å±‚ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">æ­£åœ¨åè°ƒAgentå›¢é˜Ÿ...</div>
        </div>
    </div>

    <script>
        // è·å–URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const agentIds = urlParams.get('agents') ? urlParams.get('agents').split(',') : [];

        // Agentæ•°æ®æ˜ å°„
        const agentData = {
            'customer_complaint_agent': {
                name: 'å®¢æˆ·æŠ•è¯‰å¤„ç†Agent',
                category: 'å®¢æˆ·æœåŠ¡',
                avatar: 'ğŸ“'
            },
            'data_analysis_agent': {
                name: 'æ•°æ®åˆ†æAgent',
                category: 'æ•°æ®åˆ†æ',
                avatar: 'ğŸ“Š'
            },
            'sales_lead_agent': {
                name: 'é”€å”®çº¿ç´¢åˆ†æAgent',
                category: 'é”€å”®ç®¡ç†',
                avatar: 'ğŸ’°'
            },
            'report_generator_agent': {
                name: 'æŠ¥è¡¨ç”ŸæˆAgent',
                category: 'è‡ªåŠ¨åŒ–',
                avatar: 'ğŸ“‹'
            },
            'email_notification_agent': {
                name: 'é‚®ä»¶é€šçŸ¥Agent',
                category: 'é›†æˆå·¥å…·',
                avatar: 'ğŸ“§'
            },
            'document_processor_agent': {
                name: 'æ–‡æ¡£å¤„ç†Agent',
                category: 'è‡ªåŠ¨åŒ–',
                avatar: 'ğŸ“„'
            },
            'inventory_manager_agent': {
                name: 'åº“å­˜ç®¡ç†Agent',
                category: 'ä¾›åº”é“¾',
                avatar: 'ğŸ“¦'
            },
            'quality_control_agent': {
                name: 'è´¨é‡æ§åˆ¶Agent',
                category: 'è´¨é‡ç®¡ç†',
                avatar: 'ğŸ”'
            }
        };

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            renderSelectedAgents();
            renderStatusAgents();
            
            // ç»‘å®šå›è½¦é”®å‘é€
            document.getElementById('chatInput').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });

        // æ¸²æŸ“é€‰ä¸­çš„Agentæ ‡ç­¾
        function renderSelectedAgents() {
            const container = document.getElementById('selectedAgents');
            container.innerHTML = agentIds.map(agentId => {
                const agent = agentData[agentId];
                if (agent) {
                    return `<div class="agent-tag">${agent.avatar} ${agent.name}</div>`;
                }
                return '';
            }).join('');
        }

        // æ¸²æŸ“AgentçŠ¶æ€
        function renderStatusAgents() {
            const container = document.getElementById('statusAgents');
            container.innerHTML = agentIds.map(agentId => {
                const agent = agentData[agentId];
                if (agent) {
                    return `
                        <div class="status-agent">
                            <div class="status-dot"></div>
                            <span>${agent.name}</span>
                        </div>
                    `;
                }
                return '';
            }).join('');
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage('user', message);
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            input.value = '';
            
            // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
            showTypingIndicator();
            
            // æ¨¡æ‹ŸAgentå›¢é˜Ÿå“åº”
            setTimeout(() => {
                hideTypingIndicator();
                processUserRequest(message);
            }, 2000);
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
        function addMessage(sender, text, agentResponses = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = sender === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–';
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            let agentResponsesHtml = '';
            if (agentResponses && agentResponses.length > 0) {
                agentResponsesHtml = agentResponses.map(response => `
                    <div class="agent-response">
                        <div class="response-header">
                            ${response.avatar} ${response.name}
                        </div>
                        <div class="response-content">${response.content}</div>
                    </div>
                `).join('');
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="message-text">${text}</div>
                        ${agentResponsesHtml}
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            document.getElementById('sendButton').disabled = true;
        }

        // éšè—è¾“å…¥æŒ‡ç¤ºå™¨
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('sendButton').disabled = false;
        }

        // å¤„ç†ç”¨æˆ·è¯·æ±‚
        function processUserRequest(request) {
            // åˆ†æè¯·æ±‚å¹¶ç¡®å®šå‚ä¸çš„Agent
            const participatingAgents = analyzeRequest(request);
            
            // ç”ŸæˆAgentå“åº”
            const agentResponses = generateAgentResponses(request, participatingAgents);
            
            // æ·»åŠ ç³»ç»Ÿå“åº”
            const systemResponse = generateSystemResponse(participatingAgents);
            addMessage('agent', systemResponse, agentResponses);
            
            // æ˜¾ç¤ºåŠ è½½è¦†ç›–å±‚
            showLoadingOverlay();
            
            // æ¨¡æ‹Ÿæ‰§è¡Œåä½œ
            setTimeout(() => {
                hideLoadingOverlay();
                addExecutionResult(participatingAgents);
            }, 3000);
        }

        // åˆ†æè¯·æ±‚å¹¶ç¡®å®šå‚ä¸çš„Agent
        function analyzeRequest(request) {
            const participatingAgents = [];
            
            // æ ¹æ®è¯·æ±‚å†…å®¹ç¡®å®šå‚ä¸çš„Agent
            if (request.includes('æŠ•è¯‰') || request.includes('å®¢æˆ·')) {
                participatingAgents.push('customer_complaint_agent');
            }
            if (request.includes('åˆ†æ') || request.includes('æ•°æ®') || request.includes('ç»Ÿè®¡')) {
                participatingAgents.push('data_analysis_agent');
            }
            if (request.includes('é”€å”®') || request.includes('çº¿ç´¢') || request.includes('ä¸šç»©')) {
                participatingAgents.push('sales_lead_agent');
            }
            if (request.includes('æŠ¥å‘Š') || request.includes('æŠ¥è¡¨') || request.includes('ç”Ÿæˆ')) {
                participatingAgents.push('report_generator_agent');
            }
            if (request.includes('é‚®ä»¶') || request.includes('å‘é€') || request.includes('é€šçŸ¥')) {
                participatingAgents.push('email_notification_agent');
            }
            if (request.includes('æ–‡æ¡£') || request.includes('å¤„ç†') || request.includes('è§£æ')) {
                participatingAgents.push('document_processor_agent');
            }
            if (request.includes('åº“å­˜') || request.includes('ç®¡ç†') || request.includes('ä¾›åº”é“¾')) {
                participatingAgents.push('inventory_manager_agent');
            }
            if (request.includes('è´¨é‡') || request.includes('æ§åˆ¶') || request.includes('æ£€æµ‹')) {
                participatingAgents.push('quality_control_agent');
            }
            
            // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ç‰¹å®šAgentï¼Œä½¿ç”¨é»˜è®¤çš„Agentç»„åˆ
            if (participatingAgents.length === 0) {
                participatingAgents.push('data_analysis_agent', 'report_generator_agent');
            }
            
            return participatingAgents;
        }

        // ç”ŸæˆAgentå“åº”
        function generateAgentResponses(request, participatingAgents) {
            return participatingAgents.map(agentId => {
                const agent = agentData[agentId];
                let content = '';
                
                switch(agentId) {
                    case 'customer_complaint_agent':
                        content = 'æˆ‘å·²ç»å‡†å¤‡å¥½å¤„ç†å®¢æˆ·æŠ•è¯‰ç›¸å…³ä»»åŠ¡ã€‚å¯ä»¥è‡ªåŠ¨åˆ†ç±»æŠ•è¯‰ç±»å‹ï¼Œåˆ†é…å¤„ç†ä¸“å®¶ï¼Œå¹¶è·Ÿè¸ªå¤„ç†è¿›åº¦ã€‚';
                        break;
                    case 'data_analysis_agent':
                        content = 'æˆ‘å°†åˆ†æç›¸å…³æ•°æ®ï¼Œæå–å…³é”®æŒ‡æ ‡å’Œè¶‹åŠ¿ï¼Œä¸ºå†³ç­–æä¾›æ•°æ®æ”¯æŒã€‚';
                        break;
                    case 'sales_lead_agent':
                        content = 'æˆ‘å¯ä»¥åˆ†æé”€å”®çº¿ç´¢è´¨é‡ï¼Œé¢„æµ‹è½¬åŒ–æ¦‚ç‡ï¼Œä¼˜åŒ–é”€å”®ç­–ç•¥ã€‚';
                        break;
                    case 'report_generator_agent':
                        content = 'æˆ‘å°†ç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ•°æ®å¯è§†åŒ–å›¾è¡¨å’Œå…³é”®æ´å¯Ÿã€‚';
                        break;
                    case 'email_notification_agent':
                        content = 'æˆ‘ä¼šå¤„ç†é‚®ä»¶å‘é€å’Œé€šçŸ¥ä»»åŠ¡ï¼Œç¡®ä¿ç›¸å…³äººå‘˜åŠæ—¶æ”¶åˆ°ä¿¡æ¯ã€‚';
                        break;
                    case 'document_processor_agent':
                        content = 'æˆ‘å¯ä»¥å¤„ç†å„ç§æ–‡æ¡£æ ¼å¼ï¼Œæå–å…³é”®ä¿¡æ¯å¹¶è¿›è¡Œç»“æ„åŒ–å­˜å‚¨ã€‚';
                        break;
                    case 'inventory_manager_agent':
                        content = 'æˆ‘å°†ç›‘æ§åº“å­˜çŠ¶æ€ï¼Œé¢„æµ‹ç¼ºè´§é£é™©ï¼Œæä¾›è¡¥è´§å»ºè®®ã€‚';
                        break;
                    case 'quality_control_agent':
                        content = 'æˆ‘å¯ä»¥è¿›è¡Œè´¨é‡æ£€æµ‹ï¼Œè¯†åˆ«å¼‚å¸¸æƒ…å†µï¼Œç”Ÿæˆè´¨é‡æ§åˆ¶æŠ¥å‘Šã€‚';
                        break;
                    default:
                        content = 'æˆ‘å·²ç»å‡†å¤‡å¥½å¤„ç†ç›¸å…³ä»»åŠ¡ã€‚';
                }
                
                return {
                    name: agent.name,
                    avatar: agent.avatar,
                    content: content
                };
            });
        }

        // ç”Ÿæˆç³»ç»Ÿå“åº”
        function generateSystemResponse(participatingAgents) {
            let response = `æˆ‘å·²ç»åˆ†æäº†æ‚¨çš„éœ€æ±‚ï¼Œå°†åè°ƒä»¥ä¸‹ ${participatingAgents.length} ä¸ªAgentä¸ºæ‚¨æœåŠ¡ï¼š\n\n`;
            
            participatingAgents.forEach(agentId => {
                const agent = agentData[agentId];
                if (agent) {
                    response += `â€¢ ${agent.avatar} ${agent.name} - ${agent.category}\n`;
                }
            });
            
            response += `\nç°åœ¨å¼€å§‹æ‰§è¡Œåä½œä»»åŠ¡...`;
            
            return response;
        }

        // æ˜¾ç¤ºåŠ è½½è¦†ç›–å±‚
        function showLoadingOverlay() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // éšè—åŠ è½½è¦†ç›–å±‚
        function hideLoadingOverlay() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // æ·»åŠ æ‰§è¡Œç»“æœ
        function addExecutionResult(participatingAgents) {
            const result = `âœ… Agentåä½œæ‰§è¡Œå®Œæˆï¼\n\n`;
            const details = participatingAgents.map(agentId => {
                const agent = agentData[agentId];
                return `â€¢ ${agent.avatar} ${agent.name}: ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ\n`;
            }).join('');
            
            const summary = `\nğŸ“Š åä½œæ‘˜è¦ï¼š\nâ€¢ å‚ä¸Agent: ${participatingAgents.length}ä¸ª\nâ€¢ æ€»æ‰§è¡Œæ—¶é—´: 3.2ç§’\nâ€¢ æˆåŠŸç‡: 100%\nâ€¢ ç”Ÿæˆç»“æœ: å·²ä¿å­˜åˆ°ç³»ç»Ÿ\n\næ‰€æœ‰Agentå·²æˆåŠŸåä½œå®Œæˆæ‚¨çš„ä»»åŠ¡ï¼`;
            
            addMessage('agent', result + details + summary);
        }

        // æ¸…ç©ºå¯¹è¯
        function clearChat() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—ï¼Ÿ')) {
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message agent">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="message-text">
                                    å¯¹è¯å·²æ¸…ç©ºã€‚è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦å®Œæˆä»€ä¹ˆä»»åŠ¡ï¼Œæˆ‘ä¼šåè°ƒç›¸å…³Agentä¸ºæ‚¨æä¾›æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚
                                </div>
                                <div class="message-time">åˆšåˆš</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // å¯¼å‡ºå¯¹è¯
        function exportChat() {
            const messages = document.querySelectorAll('.message');
            let exportText = 'å¤šAgentåä½œå¯¹è¯è®°å½•\n';
            exportText += '='.repeat(50) + '\n\n';
            
            messages.forEach(message => {
                const sender = message.classList.contains('user') ? 'ç”¨æˆ·' : 'Agentå›¢é˜Ÿ';
                const text = message.querySelector('.message-text').textContent;
                exportText += `${sender}: ${text}\n\n`;
            });
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `multi-agent-dialog-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å…³é—­å¯¹è¯
        function closeDialog() {
            if (confirm('ç¡®å®šè¦å…³é—­å¯¹è¯çª—å£å—ï¼Ÿ')) {
                window.close();
            }
        }
    </script>
</body>
</html>
