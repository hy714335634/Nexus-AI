description: |
  以下说明描述了Nexus-AI在构建、更新智能体时需遵守的基本规则，可用于以下场景：
  - Nexus AI进行构建、更新时需遵守base和对应workflows的规则，如build、update、deploy等
  - 使用第三方AI IDE进行编辑时，可通过规则快速了解目录结构及生成逻辑

  规则分类包括：
  - base：无论使用何种workflow，都需遵守的基础规则
  - build：构建时需遵守的规则约束
  - update：更新时需遵守的规则约束

  每类规则包含如下信息：
  - version：版本号
  - updated_on：更新日期
  - author：作者
  - change_log：变更记录
  - attributes：属性

  属性包括：
  - directory_rules：目录规则
  - generation_rules：生成规则
  - cache_rules：缓存规则
  - external_resources：外部资源规则
  - custom_rules：用户自定义规则
workflows:
  base:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "新增base规则"
      attributes:
        directory_rules: |  # 目录规则
          =====通用规则=====
          nexus-ai顶层目录保持五个分区：`agents/`、`prompts/`、`tools/`、`projects/`、`nexus_utils/`。
          - `agents/`：Agent运行代码目录，内部按`system_agents/`、`template_agents/`、`generated_agents/`区分来源。
          - `prompts/`：Agent提示词模板目录，结构与`agents/`一致，对应系统、模板、生成三类提示词。
          - `tools/`：Agent引用的工具代码目录，分为`system_tools/`、`template_tools/`、`generated_tools/`，与Agent目录一一对应。
          - `projects/<project_name>/agents/<agent_name>/`：集中存放各阶段JSON文档（需求、架构、设计、提示词、工具、代码、验收）及项目说明文件。
          - `nexus_utils/`：平台通用模块，禁止放置项目产物或临时文件。
        generation_rules: | # 生成规则
          =====通用生成规则=====
          无特殊要求
        cache_rules: |      # 缓存规则
          =====通用缓存规则=====
          如用户要求构建的Agent进行内容缓存，请按照如下规则：
          默认缓存路径：`.cache/<agent_name>/`
          在缓存目录中，Agent还应按照具体要求进行目录划分，如按<Project_ID>、<Session_ID>、<Task_ID>等进行目录划分。
        external_resources: | # 外部资源规则
          =====通用外部资源规则=====
          无特殊要求
        custom_rules: |     # 用户自定义规则
          =====通用用户自定义规则=====
          无特殊要求

  build:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "新增build规则"
      attributes:
        directory_rules: |
          - 所有阶段性文档统一存放于`projects/<project_name>/agents/<agent_name>/`目录，文件命名需与角色一致，例如`requirements_analyzer.json`、`system_architect.json`、`agent_designer.json`、`prompt_engineer.json`、`tools_developer.json`、`agent_code_developer.json`、`agent_developer_manager.json`。
          - 构建过程中生成的提示词模板必须写入`prompts/generated_agents_prompts/<project_name>/<agent_name>.yaml`；生成的智能体代码写入`agents/generated_agents/<project_name>/<agent_name>.py`；生成的工具代码写入`tools/generated_tools/<project_name>/<module>/<script_name>.py`。
          - 项目级说明文件（`config.yaml`、`README.md`、`status.yaml`）位于`projects/<project_name>/`根目录，只能通过`update_project_config`、`update_project_readme`、`update_project_status`等工具更新。
          - 生成内容一律通过`generate_content`或`update_project_stage_content`写入，禁止绕过工具直接写文件；写入后需调用`update_agent_artifact_paths`登记产物路径。
          - 所有目录和文件名使用`snake_case`或约定格式，避免空格与中文；生成的脚本须包含`if __name__ == "__main__":`入口以便本地调试。
        generation_rules: |
          - 每个角色在执行前必须调用`get_project_status`、`get_project_config`与`get_project_stage_content`同步上下文，严格按照需求→架构→设计→工具→提示词→代码→验收的顺序推进。
          - 必须先通过模板工具获取现有模板列表（例如`agent_template_provider/get_all_templates`、`tool_template_provider/list_all_tools`、`prompt_template_provider/list_prompt_templates`），再结合项目文档定制输出。
          - 阶段产物需符合对应JSON/YAML结构约束：需求、架构、设计、工具、提示词、代码及验收文档均有固定字段，不得增减关键键名，日期格式统一为`YYYY-MM-DD`。
          - 所有智能体、提示词与工具实现必须遵循Strands SDK与Nexus-AI约定：Agent通过`nexus_utils.agent_factory.create_agent_from_prompt_template`构建，工具需使用`@tool`装饰器并提供类型注解、异常处理与真实AWS调用。
          - 构建流程禁止在标准输出打印中间产物或代码，完成时仅输出各角色要求的完成提示；其余沟通与状态均通过工具接口完成。
        cache_rules: |
          - 需要落盘缓存的工具默认使用`.cache/<agent_name>/`为根目录；涉及特定业务场景时按模板要求扩展子目录（如医学文献场景使用`.cache/pmc_literature/<research_id>/`），禁止在项目目录外任意创建新路径。
          - 缓存文件须基于用户或项目提供的标识命名，禁止自行生成随机ID导致上下文丢失；更新缓存前先检查路径是否存在，必要时自动创建目录。
          - 缓存内容仅用于临时加速与状态保持，不得存放敏感凭证；提交仓库时忽略`.cache`目录，构建逻辑应具备缓存失效与重建策略。
        external_resources: |
          - 外部依赖限定为平台允许的工具与SDK：`strands_tools/*`、`system_tools/agent_build_workflow/*`、`nexus_utils/*`以及官方`boto3`库，禁止引用未授权的第三方包。
          - 调用AWS资源必须通过真实`boto3`接口或`strands_tools/use_aws`咨询，禁止伪造响应；需遵守Bedrock、AgentCore等平台限制并记录关键操作日志。
          - 模板、提示词与工具示例统一通过平台提供的检索工具获取（如`agent_template_searcher`、`tool_validator`），确保路径与依赖列表准确无误。
        custom_rules: |
          - 构建阶段遵循标准角色流程：`requirements_analyzer`→`system_architect`→`agent_designer`→`tool_developer`→`prompt_engineer`→`agent_code_developer`→`agent_developer_manager`，任何跳步需在变更记录中说明。
          - 每个阶段结束后必须调用`update_project_status`更新状态，并在`change_log`记录关键决策；若需修改上游产物须回退并重新执行后续角色。
          - 工具、提示词、代码均须在写入后使用`get_agent_artifact_paths`校验产物清单；部署前需设置`BYPASS_TOOL_CONSENT`等必要环境变量并验证Agent初始化成功。
          - 全流程保持专业沟通，禁止输出未授权信息；涉及安全、性能、合规的问题需在阶段文档和`custom_rules`补充说明。

  update:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "新增update规则"
      attributes:
        directory_rules: |
          =====Update Workflow目录规则=====
          根据指定要更新的Project Name，仅允许在以下目录范围使用工具进行创建和更新操作，其他范围仅允许读取操作：
          - `projects/<project_name>/<version_id>/`
          - `prompts/generated_agents_prompts/<project_name>/<agent_name>.yaml`
          - `tools/generated_tools/<project_name>/<version_id>/`
          - `agents/generated_agents/<project_name>/<version_id>/<agent_name>.py`
        generation_rules: |
          =====Update Workflow生成规则=====
          - 不允许修改和删除源文件，仅允许在当前工作版本的目录中创建新文件
          - 请遵循目录规则进行新文件生成
        cache_rules: |
          =====Update Workflow缓存规则=====
          无特殊要求
        external_resources: |
          =====Update Workflow外部资源规则=====
          无特殊要求
        custom_rules: |
          =====Update Workflow用户自定义规则=====
          无特殊要求