description: |
  ä»¥ä¸‹è¯´æ˜æè¿°äº†Nexus-AIåœ¨æ„å»ºã€æ›´æ–°æ™ºèƒ½ä½“æ—¶éœ€éµå®ˆçš„åŸºæœ¬è§„åˆ™ï¼Œå¯ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
  - Nexus AIè¿›è¡Œæ„å»ºã€æ›´æ–°æ—¶éœ€éµå®ˆbaseå’Œå¯¹åº”workflowsçš„è§„åˆ™ï¼Œå¦‚buildã€updateã€deployç­‰
  - ä½¿ç”¨ç¬¬ä¸‰æ–¹AI IDEè¿›è¡Œç¼–è¾‘æ—¶ï¼Œå¯é€šè¿‡è§„åˆ™å¿«é€Ÿäº†è§£ç›®å½•ç»“æ„åŠç”Ÿæˆé€»è¾‘

  è§„åˆ™åˆ†ç±»åŒ…æ‹¬ï¼š
  - baseï¼šæ— è®ºä½¿ç”¨ä½•ç§workflowï¼Œéƒ½éœ€éµå®ˆçš„åŸºç¡€è§„åˆ™
  - buildï¼šæ„å»ºæ—¶éœ€éµå®ˆçš„è§„åˆ™çº¦æŸ
  - updateï¼šæ›´æ–°æ—¶éœ€éµå®ˆçš„è§„åˆ™çº¦æŸ

  æ¯ç±»è§„åˆ™åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼š
  - versionï¼šç‰ˆæœ¬å·
  - updated_onï¼šæ›´æ–°æ—¥æœŸ
  - authorï¼šä½œè€…
  - change_logï¼šå˜æ›´è®°å½•
  - attributesï¼šå±æ€§

  å±æ€§åŒ…æ‹¬ï¼š
  - directory_rulesï¼šç›®å½•è§„åˆ™
  - generation_rulesï¼šç”Ÿæˆè§„åˆ™
  - cache_rulesï¼šç¼“å­˜è§„åˆ™
  - external_resourcesï¼šå¤–éƒ¨èµ„æºè§„åˆ™
  - custom_rulesï¼šç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™
workflows:
  base:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "æ–°å¢baseè§„åˆ™"
      attributes:
        directory_rules: |  # ç›®å½•è§„åˆ™
          =====é€šç”¨è§„åˆ™=====
          nexus-aié¡¶å±‚ç›®å½•ä¿æŒäº”ä¸ªåˆ†åŒºï¼š`agents/`ã€`prompts/`ã€`tools/`ã€`projects/`ã€`nexus_utils/`ã€‚
          - `agents/`ï¼šAgentè¿è¡Œä»£ç ç›®å½•ï¼Œå†…éƒ¨æŒ‰`system_agents/`ã€`template_agents/`ã€`generated_agents/`åŒºåˆ†æ¥æºã€‚
          - `prompts/`ï¼šAgentæç¤ºè¯æ¨¡æ¿ç›®å½•ï¼Œç»“æ„ä¸`agents/`ä¸€è‡´ï¼Œå¯¹åº”ç³»ç»Ÿã€æ¨¡æ¿ã€ç”Ÿæˆä¸‰ç±»æç¤ºè¯ã€‚
          - `tools/`ï¼šAgentå¼•ç”¨çš„å·¥å…·ä»£ç ç›®å½•ï¼Œåˆ†ä¸º`system_tools/`ã€`template_tools/`ã€`generated_tools/`ï¼Œä¸Agentç›®å½•ä¸€ä¸€å¯¹åº”ã€‚
          - `projects/<project_name>/agents/<agent_name>/`ï¼šé›†ä¸­å­˜æ”¾å„é˜¶æ®µJSONæ–‡æ¡£ï¼ˆéœ€æ±‚ã€æ¶æ„ã€è®¾è®¡ã€æç¤ºè¯ã€å·¥å…·ã€ä»£ç ã€éªŒæ”¶ï¼‰åŠé¡¹ç›®è¯´æ˜æ–‡ä»¶ã€‚
          - `nexus_utils/`ï¼šå¹³å°é€šç”¨æ¨¡å—ï¼Œç¦æ­¢æ”¾ç½®é¡¹ç›®äº§ç‰©æˆ–ä¸´æ—¶æ–‡ä»¶ã€‚
        generation_rules: | # ç”Ÿæˆè§„åˆ™
          =====é€šç”¨ç”Ÿæˆè§„åˆ™=====
          åˆ›å»ºçš„Agentæ‰§è¡Œè„šæœ¬ä¸­ï¼Œåˆ›å»ºAgentå¯¹è±¡å¿…é¡»é€šè¿‡nexus_utils.agent_factory.create_agent_from_prompt_templateå®ç°

          =====AgentCoreéƒ¨ç½²å…¥å£ç‚¹è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰=====
          æ‰€æœ‰ç”Ÿæˆçš„Agentè„šæœ¬å¿…é¡»ä½¿ç”¨ BedrockAgentCoreApp æ¨¡å¼ï¼Œä»¥æ”¯æŒéƒ¨ç½²åˆ°Amazon Bedrock AgentCoreï¼š

          1. **å¿…é¡»å¯¼å…¥å’Œåˆ›å»ºBedrockAgentCoreAppå®ä¾‹**ï¼š
             ```python
             import os
             import json
             from typing import Dict, Any
             from bedrock_agentcore.runtime import BedrockAgentCoreApp
             from nexus_utils.agent_factory import create_agent_from_prompt_template

             os.environ["BYPASS_TOOL_CONSENT"] = "true"

             # åˆ›å»º BedrockAgentCoreApp å®ä¾‹
             app = BedrockAgentCoreApp()
             ```

          2. **å¿…é¡»ä½¿ç”¨@app.entrypointè£…é¥°å™¨å®šä¹‰å¼‚æ­¥handlerå‡½æ•°ï¼ˆæ”¯æŒæµå¼å“åº”ï¼‰**ï¼š
             ```python
             @app.entrypoint
             async def handler(payload: Dict[str, Any]):
                 """
                 AgentCore æ ‡å‡†å…¥å£ç‚¹ï¼ˆæ”¯æŒæµå¼å“åº”ï¼‰

                 Args:
                     payload: AgentCore ä¼ å…¥çš„è¯·æ±‚ä½“ï¼ŒåŒ…å«:
                         - prompt: ç”¨æˆ·æ¶ˆæ¯
                         - user_id: ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
                         - session_id: ä¼šè¯IDï¼ˆå¯é€‰ï¼‰
                         - media: åª’ä½“æ–‡ä»¶åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰

                 Yields:
                     str: æµå¼å“åº”çš„æ–‡æœ¬ç‰‡æ®µï¼ˆè‡ªåŠ¨å¤„ç†æµå¼ä¼ è¾“ï¼‰
                 """
                 print(f"ğŸ“¥ Received payload: {json.dumps(payload, ensure_ascii=False)}")

                 prompt = payload.get("prompt") or payload.get("message") or payload.get("input", "")

                 if not prompt:
                     yield "Error: Missing 'prompt' in request"
                     return

                 print(f"ğŸ”„ Processing prompt: {prompt}")

                 try:
                     # ä½¿ç”¨æµå¼å“åº”
                     stream = my_agent.stream_async(prompt)
                     async for event in stream:
                         # æ¯ä¸ª event åŒ…å«æµå¼å“åº”çš„ç‰‡æ®µ
                         print(f"ğŸ“¤ Streaming event: {event}")
                         yield event

                 except Exception as e:
                     print(f"âŒ Error: {str(e)}")
                     yield f"Error: {str(e)}"
             ```

          3. **å¿…é¡»åœ¨__main__ä¸­å¯åŠ¨HTTPæœåŠ¡å™¨**ï¼š
             ```python
             if __name__ == "__main__":
                 import argparse

                 parser = argparse.ArgumentParser(description='Agent')
                 parser.add_argument('-i', '--input', type=str, default=None, help='æµ‹è¯•è¾“å…¥')
                 args = parser.parse_args()

                 # æ£€æŸ¥æ˜¯å¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œï¼ˆAgentCore éƒ¨ç½²ï¼‰
                 is_docker = os.environ.get("DOCKER_CONTAINER") == "1"

                 if is_docker:
                     # AgentCore éƒ¨ç½²æ¨¡å¼ï¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
                     print("ğŸš€ å¯åŠ¨ AgentCore HTTP æœåŠ¡å™¨ï¼Œç«¯å£: 8080")
                     app.run()
                 elif args.input:
                     # æœ¬åœ°æµ‹è¯•æ¨¡å¼
                     print(f"ğŸ“ è¾“å…¥: {args.input}")
                     result = my_agent(args.input)
                     print(f"ğŸ“‹ å“åº”: {result}")
                 else:
                     # é»˜è®¤å¯åŠ¨æœåŠ¡å™¨
                     print("ğŸš€ å¯åŠ¨ AgentCore HTTP æœåŠ¡å™¨ï¼Œç«¯å£: 8080")
                     app.run()
             ```

          4. **è¿”å›æ ¼å¼è¦æ±‚ï¼ˆæµå¼å“åº”ï¼‰**ï¼š
             - handlerå‡½æ•°å¿…é¡»æ˜¯asyncå¼‚æ­¥å‡½æ•°
             - ä½¿ç”¨yieldäº§ç”Ÿæµå¼å“åº”ç‰‡æ®µï¼Œè€Œä¸æ˜¯return
             - æ¯ä¸ªyieldäº§ç”Ÿä¸€ä¸ªæ–‡æœ¬ç‰‡æ®µï¼ŒAgentCoreä¼šè‡ªåŠ¨å¤„ç†æµå¼ä¼ è¾“
             - é”™è¯¯æ—¶yieldä»¥"Error: "å¼€å¤´çš„é”™è¯¯ä¿¡æ¯

          5. **å…³é”®æ³¨æ„äº‹é¡¹**ï¼š
             - @app.entrypointè£…é¥°çš„å‡½æ•°åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼špayloadï¼ˆDictï¼‰
             - å¿…é¡»ä½¿ç”¨async defå®šä¹‰handlerå‡½æ•°
             - å¿…é¡»ä½¿ç”¨agent.stream_async()è·å–æµå¼å“åº”
             - app.run() ä¼šå¯åŠ¨ Starlette HTTP æœåŠ¡å™¨ç›‘å¬ /invocations ç«¯ç‚¹
        cache_rules: |      # ç¼“å­˜è§„åˆ™
          =====é€šç”¨ç¼“å­˜è§„åˆ™=====
          å¦‚ç”¨æˆ·è¦æ±‚æ„å»ºçš„Agentè¿›è¡Œå†…å®¹ç¼“å­˜ï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼š
          é»˜è®¤ç¼“å­˜è·¯å¾„ï¼š`.cache/<agent_name>/`
          åœ¨ç¼“å­˜ç›®å½•ä¸­ï¼ŒAgentè¿˜åº”æŒ‰ç…§å…·ä½“è¦æ±‚è¿›è¡Œç›®å½•åˆ’åˆ†ï¼Œå¦‚æŒ‰<Project_ID>ã€<Session_ID>ã€<Task_ID>ç­‰è¿›è¡Œç›®å½•åˆ’åˆ†ã€‚
        external_resources: | # å¤–éƒ¨èµ„æºè§„åˆ™
          =====é€šç”¨å¤–éƒ¨èµ„æºè§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚
        custom_rules: |     # ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™
          =====é€šç”¨ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚

  agent_build:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "æ–°å¢buildè§„åˆ™"
      attributes:
        directory_rules: |
          =====Build Workflowç›®å½•è§„åˆ™=====
          é‡è¦å‚æ•°ï¼š
          project_name: ç”±intent analyzeråŸºäºç”¨æˆ·éœ€æ±‚æ„å›¾è¯†åˆ«åç”Ÿæˆ
          agent_name: é»˜è®¤ä¸project_nameä¸€è‡´
          é‡è¦ç›®å½•ï¼š
          é¡¹ç›®è¿‡ç¨‹ç›®å½•ï¼š`projects/<project_name>/`
          agentè¿‡ç¨‹ç›®å½•ï¼š`projects/<project_name>/agents/<agent_name>/`
          agentè„šæœ¬ç›®å½•ï¼š`agents/generated_agents/<agent_name>/<agent_name>.py`
          agentæç¤ºè¯é…ç½®ç›®å½•ï¼š`prompts/generated_agents_prompts/<agent_name>/<agent_name>.yaml`
          agentå·¥å…·ä»£ç ç›®å½•ï¼š`tools/generated_tools/<agent_name>/*.py`
          æ³¨æ„ï¼šå½“é¡¹ç›®ä¸ºå¤šAgenté¡¹ç›®æ—¶,éœ€æ±‚åˆ†æã€ æ¶æ„è®¾è®¡ã€agentè®¾è®¡åº”å­˜å‚¨åœ¨ä¸»agentè¿‡ç¨‹ä¸­ç›®å½•ï¼Œå·¥å…·å¼€å‘ã€æç¤ºè¯å·¥ç¨‹åŠagentä»£ç å¼€å‘ç­‰è®¾è®¡æ–‡æ¡£å­˜å‚¨åœ¨å„è‡ªAgentè¿‡ç¨‹ä¸­ç›®å½•ï¼Œå¦‚ï¼š
            -`projects/<project_name>/agents/<other_agent_name>/tools_developer.json`
            -`projects/<project_name>/agents/<other_agent_name>/prompt_engineer.json`
            -`projects/<project_name>/agents/<other_agent_name>/agent_code_developer.json`
        generation_rules: |
          =====Build Workflowç”Ÿæˆè§„åˆ™=====
          - ç”Ÿæˆçš„Agentåç§°åœ¨æ‰€æœ‰é˜¶æ®µéƒ½åº”å›ºå®š
          - ç”Ÿæˆçš„Agentè„šæœ¬åˆå§‹åŒ–Agentæ—¶çš„å‚æ•°é»˜è®¤ä¸ºagent_params = {"env": "production","version": "latest",  "model_id": "default","enable_logging": True}
          - å½“å­˜åœ¨å¤šä¸ªAgentæ—¶ï¼Œå¿…é¡»åœ¨æç¤ºè¯å¼€å‘é˜¶æ®µï¼Œåˆ›å»ºå¤šä¸ªyamlé…ç½®å¯¹åº”æ¯ä¸ªAgent
          - å½“åˆ›å»ºå¤šä¸ªAgentæ—¶ï¼Œä¼˜å…ˆåœ¨agentè„šæœ¬ä¸­åˆ›å»ºå¤šä¸ªAgentå¯¹è±¡ï¼Œå¹¶æŒ‰ç…§é€»è¾‘è¿›è¡Œç¼–æ’å’Œåˆ¤æ–­ï¼Œä¹Ÿå¯ä½¿ç”¨swarmæˆ–graphè¿›è¡Œç¼–æ’ã€‚
          - **é‡è¦**ï¼šå¿…é¡»éµå®ˆbaseè§„åˆ™ä¸­çš„"AgentCoreéƒ¨ç½²å…¥å£ç‚¹è§„åˆ™"ï¼Œç¡®ä¿æ‰€æœ‰ç”Ÿæˆçš„Agentè„šæœ¬éƒ½åŒ…å«handlerå…¥å£ç‚¹å‡½æ•°
        cache_rules: |
          =====Build Workflowç¼“å­˜è§„åˆ™=====
          å½“ç”¨æˆ·è¦æ±‚æ„å»ºçš„Agentè¿›è¡Œå†…å®¹ç¼“å­˜ï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹è§„åˆ™ï¼š
          é»˜è®¤ç¼“å­˜è·¯å¾„ï¼š`.cache/<agent_name>/`
          åœ¨ç¼“å­˜ç›®å½•ä¸­ï¼ŒAgentè¿˜åº”æŒ‰ç…§å…·ä½“è¦æ±‚è¿›è¡Œç›®å½•åˆ’åˆ†ï¼Œå¦‚æŒ‰<Project_ID>ã€<Session_ID>ã€<Task_ID>ç­‰è¿›è¡Œç›®å½•åˆ’åˆ†ã€‚
        external_resources: |
          =====Build Workflowå¤–éƒ¨èµ„æºè§„åˆ™=====
        custom_rules: |
          =====Build Workflowç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™=====
          - ç”Ÿæˆçš„Agentæ‰€ä½¿ç”¨çš„æ¨¡å‹å¦‚æ— ç‰¹æ®Šè¦æ±‚æˆ–éœ€æ±‚ï¼Œè¯·ä½¿ç”¨"global.anthropic.claude-sonnet-4-5-20250929-v1:0"

  agent_update:
    - version: "latest"
      updated_on: "2025-11-10"
      author: "qangz"
      change_log:
        - date: "2025-11-10"
          summary: "æ–°å¢updateè§„åˆ™"
      attributes:
        directory_rules: |
          =====Update Workflowç›®å½•è§„åˆ™=====
          æ ¹æ®æŒ‡å®šè¦æ›´æ–°çš„Project Nameï¼Œä»…å…è®¸åœ¨ä»¥ä¸‹ç›®å½•èŒƒå›´ä½¿ç”¨å·¥å…·è¿›è¡Œåˆ›å»ºå’Œæ›´æ–°æ“ä½œï¼Œå…¶ä»–èŒƒå›´ä»…å…è®¸è¯»å–æ“ä½œï¼š
          - `projects/<project_name>/<version_id>/`
          - `prompts/generated_agents_prompts/<project_name>/<agent_name>.yaml`
          - `tools/generated_tools/<project_name>/<version_id>/`
          - `agents/generated_agents/<project_name>/<version_id>/<agent_name>.py`
        generation_rules: |
          =====Update Workflowç”Ÿæˆè§„åˆ™=====
          - ä¸å…è®¸ä¿®æ”¹å’Œåˆ é™¤æºæ–‡ä»¶ï¼Œä»…å…è®¸åœ¨å½“å‰å·¥ä½œç‰ˆæœ¬çš„ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶
          - è¯·éµå¾ªç›®å½•è§„åˆ™è¿›è¡Œæ–°æ–‡ä»¶ç”Ÿæˆ
        cache_rules: |
          =====Update Workflowç¼“å­˜è§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚
        external_resources: |
          =====Update Workflowå¤–éƒ¨èµ„æºè§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚
        custom_rules: |
          =====Update Workflowç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚

  tool_build:
    - version: "latest"
      updated_on: "2025-11-11"
      author: "qangz"
      change_log:
        - date: "2025-11-11"
          summary: "æ–°å¢tool_buildè§„åˆ™"
      attributes:
        directory_rules: |
          =====Tool Build Workflowç›®å½•è§„åˆ™=====
          å·¥å…·æ„å»ºå·¥ä½œæµä»…å…è®¸åœ¨ä»¥ä¸‹ç›®å½•èŒƒå›´ä½¿ç”¨å·¥å…·è¿›è¡Œåˆ›å»ºå’Œæ›´æ–°æ“ä½œï¼š
          - `tools/generated_tools/tool_build_<tool_name>/`ï¼šå·¥å…·é¡¹ç›®æ ¹ç›®å½•ï¼Œå­˜å‚¨æ‰€æœ‰å·¥å…·æ–‡ä»¶
          - `tools/generated_tools/tool_build_<tool_name>/stages/`ï¼šå­˜å‚¨å„é˜¶æ®µJSONæ–‡æ¡£ï¼ˆéœ€æ±‚ã€è®¾è®¡ã€å¼€å‘ã€éªŒè¯ã€æ–‡æ¡£ï¼‰
          - `tools/generated_tools/tool_build_<tool_name>/config.yaml`ï¼šå·¥å…·é¡¹ç›®é…ç½®æ–‡ä»¶
          - `tools/generated_tools/tool_build_<tool_name>/status.yaml`ï¼šå·¥å…·é¡¹ç›®çŠ¶æ€æ–‡ä»¶
          - `tools/generated_tools/tool_build_<tool_name>/README.md`ï¼šå·¥å…·ä½¿ç”¨æ–‡æ¡£
          - `tools/generated_tools/tool_build_<tool_name>/*.py`ï¼šå·¥å…·ä»£ç æ–‡ä»¶
          å·¥å…·é¡¹ç›®å‘½åè§„èŒƒï¼šå¿…é¡»ä»¥ `tool_build_` å¼€å¤´ï¼Œåè·Ÿæè¿°æ€§è‹±æ–‡åç§°ï¼ˆå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼‰
        generation_rules: |
          =====Tool Build Workflowç”Ÿæˆè§„åˆ™=====
          - æ¯ä¸ªç”¨æˆ·çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ— è®ºå¼€å‘å¤šå°‘ä¸ªå·¥å…·ï¼Œéƒ½åº”å­˜å‚¨åœ¨åŒä¸€å·¥å…·é¡¹ç›®ç›®å½•çš„è„šæœ¬ä¸­
          - å·¥å…·ä»£ç å¿…é¡»ä½¿ç”¨ `@tool` è£…é¥°å™¨ï¼Œç¬¦åˆStrands SDKè§„èŒƒ
          - å·¥å…·å‡½æ•°åº”è¿”å›JSONå­—ç¬¦ä¸²æˆ–é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²
          - æ‰€æœ‰å·¥å…·å¿…é¡»æ³¨å†Œåˆ°é¡¹ç›®çš„ `status.yaml` ä¸­
          - å¿…é¡»ç”Ÿæˆå®Œæ•´çš„ README.md æ–‡æ¡£ï¼ŒåŒ…å«å·¥å…·åŠŸèƒ½å’Œä½¿ç”¨è¯´æ˜
        cache_rules: |
          =====Tool Build Workflowç¼“å­˜è§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚
        external_resources: |
          =====Tool Build Workflowå¤–éƒ¨èµ„æºè§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚
        custom_rules: |
          =====Tool Build Workflowç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™=====
          æ— ç‰¹æ®Šè¦æ±‚