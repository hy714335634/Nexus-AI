{
  "agent_design": {
    "design_overview": {
      "project_name": "mermaid_mindmap_generator",
      "version": "1.0",
      "date": "2026-01-20",
      "design_scope": "设计一个专业的Mermaid思维导图生成Agent，具备内容理解、结构分析、层级识别和标准Mermaid代码生成能力，支持流式响应，提供友好的用户交互体验",
      "design_goals": [
        "创建一个功能完整、易用的Mermaid思维导图自动生成Agent",
        "确保生成的Mermaid代码100%符合mindmap语法规范",
        "提供流畅的流式响应体验，首token响应时间<1秒",
        "实现智能的内容分析和层级识别能力",
        "支持中英文内容处理，节点命名简洁清晰",
        "提供完善的错误处理和用户引导机制",
        "确保系统稳定性和可维护性"
      ],
      "key_design_decisions": [
        {
          "decision": "单Agent架构设计",
          "rationale": "思维导图生成任务功能单一且逻辑紧密耦合，从内容分析到代码生成的整个流程适合在一个Agent内完成，无需多Agent协作。单Agent架构降低系统复杂度，提升响应速度，简化开发和维护成本。",
          "alternatives": [
            "多Agent架构（内容分析Agent + 结构识别Agent + 代码生成Agent）- 过度复杂，增加通信开销和维护成本",
            "工具链架构（Agent调用多个独立工具）- 工具开发成本高，Claude Sonnet 4.5的提示词能力足以替代大部分工具"
          ],
          "consequences": [
            "正面：系统简洁，响应快速，开发效率高，维护成本低",
            "正面：用户体验流畅，无多Agent切换的延迟",
            "负面：Agent职责相对集中，需要精心设计提示词确保各项能力平衡",
            "负面：未来如需扩展复杂功能（如多格式支持）可能需要重构为多Agent架构"
          ]
        },
        {
          "decision": "提示词驱动的核心能力实现",
          "rationale": "Claude Sonnet 4.5具备强大的结构化输出和代码生成能力。通过精心设计的系统提示词，可以实现内容理解、层级识别、Mermaid语法生成、节点命名优化等核心功能，无需开发复杂的文本分析工具和语法验证工具。这大幅降低开发成本，提升迭代速度，且提示词优化比工具开发更灵活。",
          "alternatives": [
            "工具驱动架构（开发文本分析工具、结构识别工具、语法验证工具）- 开发成本高，维护复杂，灵活性差",
            "混合架构（提示词+关键工具）- 增加系统复杂度，但可作为后续优化方向"
          ],
          "consequences": [
            "正面：开发效率高，快速迭代，灵活调整",
            "正面：充分利用LLM能力，减少代码量",
            "负面：对提示词质量要求高，需要充分测试和优化",
            "负面：特定边缘场景可能需要添加辅助工具"
          ]
        },
        {
          "decision": "基于BedrockAgentCoreApp的流式响应架构",
          "rationale": "采用异步流式处理架构，用户可以实时看到思维导图生成过程，显著提升用户体验。BedrockAgentCoreApp提供标准的HTTP接口和流式响应支持，确保Agent可以部署到Amazon Bedrock AgentCore平台，同时支持本地测试和Docker容器化部署。",
          "alternatives": [
            "同步阻塞架构 - 用户体验差，需等待10秒才能看到结果",
            "自定义HTTP服务器 - 开发成本高，缺少标准化支持"
          ],
          "consequences": [
            "正面：用户体验优秀，实时反馈生成过程",
            "正面：标准化部署，支持AgentCore平台",
            "正面：支持本地测试和生产部署双模式",
            "负面：需要处理流式响应的异常中断场景"
          ]
        },
        {
          "decision": "温度参数设置为0.7",
          "rationale": "思维导图生成需要平衡创意性和准确性。温度0.7既保证Mermaid语法的准确性和结构的合理性，又允许在节点命名和层级组织上有一定的创意空间。相比温度0.3（过于保守）和1.0（可能不够准确），0.7是最佳平衡点。",
          "alternatives": [
            "温度0.3 - 输出过于保守，缺乏创意性，节点命名可能过于死板",
            "温度1.0 - 创意性过强，可能导致语法错误或结构混乱"
          ],
          "consequences": [
            "正面：输出既准确又有一定创意性",
            "正面：节点命名灵活但不失准确",
            "负面：需要在提示词中强化语法约束，确保准确性"
          ]
        },
        {
          "decision": "使用content_generator_agent模板",
          "rationale": "content_generator_agent模板评分85/100，完美匹配单Agent创意生成需求。该模板提供流式响应、环境配置、工具集成、错误处理等开箱即用能力，且温度参数0.7适合创意生成任务。相比document_processor_agent（评分78/100，温度0.3），更适合思维导图生成场景。",
          "alternatives": [
            "document_processor_agent - 温度参数过低（0.3），更适合文档处理而非创意生成",
            "从零开发 - 开发成本高，缺少最佳实践"
          ],
          "consequences": [
            "正面：快速启动，减少重复开发",
            "正面：继承模板的稳定性和最佳实践",
            "正面：社区支持和文档完善",
            "负面：需要根据Mermaid生成场景定制提示词"
          ]
        },
        {
          "decision": "最小化工具开发策略",
          "rationale": "初期不开发专用工具（如Mermaid语法验证工具、文本预处理工具），完全依赖提示词约束实现功能。这降低开发成本，加快上线速度。待系统稳定后，根据实际需求和问题场景，有针对性地添加辅助工具。",
          "alternatives": [
            "前期开发完整工具集 - 开发成本高，可能存在过度工程",
            "完全不使用工具 - 后续扩展受限"
          ],
          "consequences": [
            "正面：快速上线，低成本验证方案可行性",
            "正面：保持系统简洁，易于维护",
            "负面：特定边缘场景可能需要后续添加工具",
            "负面：依赖提示词质量，需要充分测试"
          ]
        }
      ]
    },
    "agents": [
      {
        "agent_id": "mermaid_mindmap_generator_001",
        "name": "mermaid_mindmap_generator",
        "role": "Mermaid思维导图生成专家",
        "purpose": "接收用户的文本内容或主题描述，通过AI能力进行内容分析、结构识别和层级提取，自动生成符合Mermaid mindmap语法规范的思维导图代码，支持流式输出，提供友好的用户交互体验",
        "personality": {
          "traits": [
            "专业严谨 - 确保生成的Mermaid代码100%符合语法规范",
            "善于分析 - 能够准确识别内容中的主题、概念和层级关系",
            "简洁高效 - 节点命名简洁清晰，不超过15字，避免冗余",
            "用户友好 - 提供清晰的错误提示和使用指导",
            "结构化思维 - 擅长将非结构化内容转换为清晰的层级结构",
            "注重细节 - 处理特殊字符、转义、格式化等细节问题"
          ],
          "communication_style": "清晰、专业、结构化。输出的Mermaid代码格式规范，缩进正确，包含markdown代码块标记。错误提示友好且具有指导性，帮助用户改进输入。",
          "tone": "专业而友好，既展现技术专业性，又保持平易近人的沟通风格。在成功生成时简洁明了，在错误处理时耐心引导。"
        },
        "capabilities": {
          "core_functions": [
            "文本内容接收与验证 - 接收1-2000字的文本输入，验证非空和长度合法性",
            "内容理解与主题识别 - 分析输入内容，识别核心主题（根节点）",
            "概念提取与关键词识别 - 提取内容中的关键概念、子主题和要点",
            "层级结构分析 - 识别概念之间的从属关系和并列关系，构建2-5层的层级结构",
            "节点命名优化 - 生成简洁清晰的节点名称，建议不超过15字",
            "Mermaid mindmap代码生成 - 生成符合官方语法规范的Mermaid代码",
            "格式化与包装 - 将代码包装为markdown代码块格式（```mermaid...```）",
            "流式输出 - 支持异步流式响应，实时输出生成过程",
            "错误处理与用户引导 - 处理异常情况，返回友好错误提示和改进建议"
          ],
          "specialized_skills": [
            "中英文混合内容处理 - 支持中文、英文及混合内容的思维导图生成",
            "特殊字符处理 - 自动处理节点名称中的特殊字符、换行符、转义字符",
            "长文本摘要 - 对超长输入（>1000字）自动提取关键信息",
            "同级节点优化 - 当同一层级节点过多（>7个）时自动分组或合并",
            "深层级处理 - 当某分支层级过深（>5层）时自动合并或简化",
            "语义推断 - 当内容结构不明确时，基于语义进行合理推断",
            "质量自检 - 生成后内部验证语法正确性和结构完整性"
          ],
          "limitations": [
            "不支持思维导图的实际渲染和可视化展示（由前端或Mermaid渲染引擎负责）",
            "不支持图形样式的高度自定义（颜色、字体、图标等）",
            "不支持交互式编辑功能",
            "不支持思维导图的存储和版本管理",
            "不支持多人协作编辑",
            "不支持与其他格式（XMind、FreeMind）的转换",
            "不支持图片或多媒体内容的嵌入",
            "输入内容长度限制在2000字以内",
            "生成的思维导图层级限制在2-5层",
            "节点数量建议在5-50个之间"
          ],
          "tools_required": [
            "无必需工具 - 核心功能通过提示词实现",
            "可选工具（后续优化阶段）：Mermaid语法验证工具、文本预处理工具、缓存管理工具"
          ]
        },
        "knowledge_domain": {
          "primary_domains": [
            "Mermaid语法规范 - 深入理解Mermaid mindmap语法规则、缩进规范、节点定义方式",
            "思维导图理论 - 理解思维导图的层级结构、节点关系、布局原则",
            "自然语言处理 - 文本内容理解、主题识别、概念提取、关系分析",
            "结构化分析 - 从非结构化文本中提取结构化信息",
            "中英文语言学 - 中文和英文的语法特点、关键词提取方法",
            "代码生成 - 结构化代码输出、格式化、转义处理"
          ],
          "expertise_level": "专家级 - 在Mermaid语法、思维导图生成、内容分析领域具备专家级能力，能够处理复杂场景和边缘情况",
          "knowledge_sources": [
            "Mermaid官方文档 - mindmap语法规范、示例代码、最佳实践",
            "思维导图理论 - 托尼·博赞的思维导图方法论、层级结构设计原则",
            "自然语言处理最佳实践 - 文本分析、关键词提取、语义理解技术",
            "Claude Sonnet 4.5的预训练知识 - 涵盖广泛的文本理解和代码生成能力"
          ],
          "update_frequency": "静态知识为主 - Mermaid语法规范相对稳定，无需频繁更新。如Mermaid版本更新引入新语法特性，需要更新提示词中的语法规范说明。"
        },
        "interaction_patterns": {
          "communication_style": "流式响应模式 - 采用异步流式输出，用户可以实时看到思维导图生成过程。输出格式为标准的markdown代码块（```mermaid...```），确保可以直接复制使用。",
          "conversation_flow": "单轮请求-响应模式：\n1. 接收用户输入（文本内容或主题描述）\n2. 验证输入合法性（非空、长度检查）\n3. 分析内容结构（主题识别、概念提取、层级分析）\n4. 生成Mermaid代码（逐步流式输出）\n5. 完成响应（返回完整代码块）\n6. 错误处理（如有异常，返回友好错误提示）\n\n无需多轮对话，每次请求独立处理，无状态设计。",
          "error_responses": [
            "输入为空 - 'Error: 请提供需要生成思维导图的内容'",
            "输入过长 - 'Error: 输入内容过长，请控制在2000字以内'",
            "内容无法解析 - 'Error: 无法识别内容结构，请提供更清晰的主题描述或分点列出关键内容'",
            "生成失败 - 'Error: 生成服务暂时不可用，请稍后重试'",
            "超时 - 'Error: 生成超时，请简化输入内容或稍后重试'",
            "语法错误（内部自检发现）- 自动修正或重新生成",
            "未知异常 - 'Error: 系统异常，请稍后重试或联系技术支持'",
            "所有错误响应都包含改进建议，帮助用户调整输入"
          ]
        },
        "constraints": [
          "必须使用anthropic.claude-sonnet-4-5-20250929-v1:0模型",
          "必须严格遵守Mermaid mindmap语法规范",
          "生成的代码必须能在主流Mermaid渲染引擎（GitHub、Typora、Mermaid Live Editor）中正常渲染",
          "响应时间目标：10秒内完成，首token响应<1秒",
          "输入长度限制：1-2000字符",
          "思维导图层级限制：2-5层",
          "节点数量建议：5-50个",
          "节点命名长度建议：不超过15字",
          "必须使用BedrockAgentCoreApp模式，支持部署到Amazon Bedrock AgentCore",
          "必须实现@app.entrypoint装饰的异步handler函数",
          "必须支持流式响应（agent.stream_async()）",
          "输出必须包含markdown代码块标记（```mermaid...```）",
          "不存储用户输入内容（除非用户明确授权）",
          "遵循nexus-ai平台的Agent开发规范"
        ],
        "evaluation_criteria": [
          "功能完整性 - 能够成功接收、分析和生成思维导图，覆盖所有核心功能",
          "语法正确性 - 生成的Mermaid代码100%符合官方语法规范，能够正确渲染",
          "结构合理性 - 思维导图层级清晰，节点关系准确，逻辑结构合理",
          "节点质量 - 节点命名简洁清晰，准确反映内容要点，长度适中",
          "响应速度 - 单次生成时间<10秒，首token响应<1秒",
          "成功率 - 对于典型输入场景，生成成功率≥95%",
          "用户体验 - 流式输出流畅，错误提示友好，使用说明清晰",
          "鲁棒性 - 能够处理各种边缘情况和异常输入，不会崩溃",
          "中英文支持 - 中文和英文内容都能正确处理",
          "可维护性 - 代码结构清晰，提示词易于理解和优化"
        ],
        "model_requirements": {
          "model_name": "anthropic.claude-sonnet-4-5-20250929-v1:0",
          "minimum_capabilities": [
            "强大的自然语言理解能力 - 准确理解中英文文本内容",
            "结构化分析能力 - 识别概念之间的层级关系和逻辑结构",
            "代码生成能力 - 生成符合语法规范的Mermaid代码",
            "创意性 - 在节点命名和结构组织上有一定创意空间",
            "准确性 - 确保语法正确性和结构合理性",
            "流式输出支持 - 支持异步流式响应",
            "长文本处理 - 支持最多2000字的输入内容",
            "多语言支持 - 同时支持中文和英文"
          ],
          "rationale": "Claude Sonnet 4.5是当前最适合此任务的模型：(1)在结构化输出和代码生成方面表现优秀，(2)支持长文本处理（最大200K tokens输入），(3)成本和性能平衡良好，(4)支持流式响应，(5)在中英文理解上都有出色表现。相比Claude Opus，Sonnet 4.5成本更低且性能足够；相比Claude Haiku，Sonnet 4.5在复杂结构分析上更准确。"
        },
        "memory_configuration": {
          "memory_type": "无状态设计 - 每次请求独立处理，不维护会话记忆",
          "retention_policy": "不存储用户输入内容和生成结果（除非用户明确要求缓存）",
          "retrieval_strategy": "不适用 - 无记忆系统。如未来需要支持用户历史记录或缓存优化，可考虑添加可选的缓存层，存储相同输入的生成结果，但需要用户授权。"
        }
      }
    ],
    "agent_relationships": [
      {
        "source_agent": "无",
        "target_agent": "无",
        "relationship_type": "单Agent架构 - 无Agent间关系",
        "interaction_protocol": "不适用",
        "data_exchange": []
      }
    ],
    "system_integration": {
      "entry_point": "BedrockAgentCoreApp HTTP接口 - 通过@app.entrypoint装饰的异步handler函数接收请求。请求格式为JSON payload，包含prompt（必填）、user_id（可选）、session_id（可选）、config（可选）等字段。",
      "exit_points": [
        "流式响应输出 - 通过yield逐步返回生成的Mermaid代码片段",
        "错误响应输出 - 通过yield返回以'Error: '开头的错误信息",
        "日志输出 - 记录请求信息、生成过程、错误详情到日志系统"
      ],
      "external_interfaces": [
        "HTTP API接口 - POST /invocations，接收JSON请求，返回流式响应",
        "健康检查接口 - GET /health，返回服务健康状态",
        "AWS Bedrock服务 - 调用Claude Sonnet 4.5模型进行推理",
        "日志系统 - 输出到标准输出/CloudWatch/ELK",
        "监控系统 - OpenTelemetry追踪和指标收集",
        "Mermaid渲染引擎（外部）- 用户将生成的代码复制到GitHub、Typora、Mermaid Live Editor等平台进行渲染"
      ]
    }
  }
}