{
  "tool_development": {
    "development_overview": {
      "project_name": "children_chat_companion",
      "version": "1.0",
      "date": "2025-12-23",
      "development_scope": "为儿童陪伴聊天Agent开发用户画像管理和会话历史管理工具，支持本地文件系统的JSON数据存储，实现用户画像的CRUD操作和会话历史的完整生命周期管理",
      "design_principles": [
        "单一职责原则：每个工具函数只负责一个明确的功能",
        "错误优雅处理：所有异常都被捕获并返回结构化的错误信息",
        "数据验证：对所有输入参数进行验证，确保数据一致性",
        "文件系统隔离：每个用户的数据存储在独立目录中",
        "JSON标准化：所有数据使用JSON格式存储，便于读写和扩展",
        "返回值统一：所有工具函数返回JSON格式的结构化数据",
        "自动创建目录：支持自动创建必要的目录结构",
        "时间戳标准化：所有时间戳使用ISO 8601格式（UTC+Z后缀）"
      ],
      "key_decisions": [
        "决策1：使用@tool装饰器定义所有工具函数 - 理由：符合Strands框架规范，支持自动工具注册和调用",
        "决策2：返回JSON字符串而非Python对象 - 理由：便于Agent解析和日志记录，支持跨语言调用",
        "决策3：所有错误返回包含error_type字段 - 理由：便于Agent根据错误类型采取不同的恢复策略",
        "决策4：支持可选的cache_dir参数 - 理由：提高测试灵活性，支持多环境部署",
        "决策5：画像和会话历史分别存储在不同文件 - 理由：降低并发冲突风险，提高读写性能",
        "决策6：会话历史限制最大50轮 - 理由：控制文件大小，避免单个会话文件过大",
        "决策7：提供默认画像创建功能 - 理由：首次对话时快速初始化，避免空指针错误",
        "决策8：会话上下文窗口默认5轮 - 理由：平衡上下文连贯性和Token消耗",
        "决策9：支持会话归档功能 - 理由：管理存储空间，保留历史数据",
        "决策10：所有时间戳由工具函数自动生成 - 理由：确保时间一致性，避免客户端时区问题"
      ]
    },
    "tools": [
      {
        "tool_name": "load_user_profile",
        "description": "从本地文件系统加载用户画像，支持处理画像不存在的情况",
        "function_signature": "load_user_profile(user_id: str, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径，默认为.cache/children_chat_companion",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status（success/not_found/error）、message、user_id、profile（画像数据或None）、file_path（如果成功）等字段",
        "dependencies": [
          "json - JSON数据解析",
          "pathlib.Path - 文件路径操作",
          "strands - @tool装饰器"
        ],
        "implementation_notes": [
          "文件路径格式：<cache_dir>/<user_id>/profile.json",
          "如果文件不存在，返回status=not_found，profile=None",
          "如果JSON解析失败，返回error_type=json_decode_error",
          "如果权限不足，返回error_type=permission_error",
          "自动补充缺失的user_id字段到画像数据中"
        ],
        "error_handling": [
          "FileNotFoundError: 返回not_found状态，不抛出异常",
          "json.JSONDecodeError: 捕获并返回json_decode_error错误",
          "PermissionError: 捕获并返回permission_error错误",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "result = load_user_profile('child_001')",
          "result = load_user_profile('child_001', cache_dir='/custom/cache')"
        ]
      },
      {
        "tool_name": "save_user_profile",
        "description": "将用户画像保存到本地文件系统，自动创建必要的目录结构",
        "function_signature": "save_user_profile(user_id: str, profile_data: Dict[str, Any], cache_dir: Optional[str] = None, create_if_missing: bool = True) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "profile_data",
            "type": "Dict[str, Any]",
            "description": "用户画像数据字典",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径，默认为.cache/children_chat_companion",
            "required": false
          },
          {
            "name": "create_if_missing",
            "type": "bool",
            "description": "如果目录不存在是否创建，默认True",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status（success/error）、message、user_id、file_path、file_size_bytes、last_updated等字段",
        "dependencies": [
          "json - JSON数据序列化",
          "pathlib.Path - 文件路径操作",
          "datetime - 时间戳生成",
          "strands - @tool装饰器"
        ],
        "implementation_notes": [
          "自动补充user_id、last_updated、version字段",
          "last_updated使用UTC时间+Z后缀（ISO 8601格式）",
          "验证年龄必须在3-12岁范围内",
          "自动创建用户目录（如果create_if_missing=True）",
          "返回文件大小信息，便于监控存储使用情况"
        ],
        "error_handling": [
          "年龄验证失败: 返回validation_error错误",
          "目录不存在且不允许创建: 返回directory_not_found错误",
          "PermissionError: 捕获并返回permission_error错误",
          "OSError（磁盘空间不足）: 捕获并返回os_error错误",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "profile = {'basic_info': {'age': 8, 'gender': 'male'}}",
          "result = save_user_profile('child_001', profile)"
        ]
      },
      {
        "tool_name": "create_default_profile",
        "description": "创建默认的用户画像，用于首次对话时初始化",
        "function_signature": "create_default_profile(user_id: str, age: Optional[int] = None, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "age",
            "type": "Optional[int]",
            "description": "用户年龄，默认为7岁（中间年龄段）",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、profile（默认画像数据）",
        "dependencies": [
          "datetime - 时间戳生成",
          "save_user_profile - 调用保存画像工具"
        ],
        "implementation_notes": [
          "默认年龄为7岁，如果提供的年龄不在3-12范围内则使用默认值",
          "初始化所有必需字段：basic_info、interests、personality_traits、behavior_patterns、key_memories、conversation_stats",
          "所有列表字段初始化为空列表",
          "conversation_stats初始化为0",
          "created_at和last_updated设为当前UTC时间"
        ],
        "error_handling": [
          "调用save_user_profile的所有错误都会传播",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "result = create_default_profile('child_001')",
          "result = create_default_profile('child_001', age=6)"
        ]
      },
      {
        "tool_name": "update_profile_field",
        "description": "更新用户画像的特定字段，支持嵌套字段路径",
        "function_signature": "update_profile_field(user_id: str, field_path: str, value: Any, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "field_path",
            "type": "str",
            "description": "字段路径，使用点号分隔（如'basic_info.age'）",
            "required": true
          },
          {
            "name": "value",
            "type": "Any",
            "description": "新的字段值",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、field_path、new_value、last_updated",
        "dependencies": [
          "load_user_profile - 加载现有画像",
          "save_user_profile - 保存更新后的画像"
        ],
        "implementation_notes": [
          "支持点号分隔的嵌套路径（如'basic_info.age'）",
          "如果画像不存在，自动创建默认画像",
          "自动创建中间路径上缺失的字典节点",
          "更新后自动保存画像"
        ],
        "error_handling": [
          "画像加载失败: 尝试创建默认画像",
          "字段路径解析错误: 返回unknown_error错误",
          "保存失败: 传播save_user_profile的错误"
        ],
        "usage_examples": [
          "result = update_profile_field('child_001', 'basic_info.age', 9)",
          "result = update_profile_field('child_001', 'basic_info.nickname', '小明')"
        ]
      },
      {
        "tool_name": "add_interest",
        "description": "向用户画像添加或更新兴趣，支持权重管理和提及次数统计",
        "function_signature": "add_interest(user_id: str, interest_name: str, weight: float = 0.5, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "interest_name",
            "type": "str",
            "description": "兴趣名称",
            "required": true
          },
          {
            "name": "weight",
            "type": "float",
            "description": "兴趣权重（0.0-1.0），默认0.5",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、interest_name、weight、total_interests",
        "dependencies": [
          "load_user_profile - 加载现有画像",
          "save_user_profile - 保存更新后的画像",
          "datetime - 时间戳生成"
        ],
        "implementation_notes": [
          "权重必须在0.0-1.0范围内",
          "如果兴趣已存在，更新权重、last_mentioned和mention_count",
          "如果兴趣不存在，添加新兴趣并初始化first_mentioned、last_mentioned、mention_count",
          "mention_count每次提及自动递增",
          "如果画像不存在，自动创建默认画像"
        ],
        "error_handling": [
          "权重超出范围: 返回validation_error错误",
          "画像加载失败: 尝试创建默认画像",
          "保存失败: 传播save_user_profile的错误"
        ],
        "usage_examples": [
          "result = add_interest('child_001', '恐龙', weight=0.8)",
          "result = add_interest('child_001', '画画')"
        ]
      },
      {
        "tool_name": "update_conversation_stats",
        "description": "更新用户的对话统计信息，包括对话次数、轮数和平均轮数",
        "function_signature": "update_conversation_stats(user_id: str, turns_increment: int = 1, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "turns_increment",
            "type": "int",
            "description": "本次对话增加的轮数，默认1",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、stats（更新后的统计信息）",
        "dependencies": [
          "load_user_profile - 加载现有画像",
          "save_user_profile - 保存更新后的画像",
          "datetime - 时间戳生成"
        ],
        "implementation_notes": [
          "total_conversations递增1",
          "total_turns增加turns_increment",
          "自动计算average_turns_per_session（保留2位小数）",
          "更新last_conversation为当前时间",
          "如果是首次对话，设置first_conversation"
        ],
        "error_handling": [
          "画像加载失败: 尝试创建默认画像",
          "保存失败: 传播save_user_profile的错误"
        ],
        "usage_examples": [
          "result = update_conversation_stats('child_001')",
          "result = update_conversation_stats('child_001', turns_increment=3)"
        ]
      },
      {
        "tool_name": "get_profile_summary",
        "description": "获取用户画像的简要摘要，包含关键信息",
        "function_signature": "get_profile_summary(user_id: str, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、summary（画像摘要）",
        "dependencies": [
          "load_user_profile - 加载画像"
        ],
        "implementation_notes": [
          "提取关键信息：年龄、性别、年级、前5个兴趣、对话统计、性格特征",
          "兴趣按权重降序排序",
          "只返回前5个兴趣",
          "摘要格式便于Agent快速了解用户特征"
        ],
        "error_handling": [
          "画像加载失败: 传播load_user_profile的错误"
        ],
        "usage_examples": [
          "result = get_profile_summary('child_001')"
        ]
      },
      {
        "tool_name": "load_session_history",
        "description": "从本地文件系统加载会话历史，支持限制返回轮数",
        "function_signature": "load_session_history(user_id: str, session_id: str, cache_dir: Optional[str] = None, max_turns: Optional[int] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          },
          {
            "name": "max_turns",
            "type": "Optional[int]",
            "description": "最多加载的轮数，默认加载所有，建议3-5轮",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status（success/not_found/error）、message、user_id、session_id、history（会话历史数据）、file_path、turns_loaded",
        "dependencies": [
          "json - JSON数据解析",
          "pathlib.Path - 文件路径操作",
          "datetime - 时间戳生成",
          "strands - @tool装饰器"
        ],
        "implementation_notes": [
          "文件路径格式：<cache_dir>/<user_id>/session_<session_id>.json",
          "如果文件不存在，返回status=not_found，并返回空的会话历史结构",
          "如果指定max_turns，只返回最近的N轮对话",
          "自动补充缺失的session_id和user_id字段"
        ],
        "error_handling": [
          "FileNotFoundError: 返回not_found状态和空历史结构",
          "json.JSONDecodeError: 捕获并返回json_decode_error错误",
          "PermissionError: 捕获并返回permission_error错误",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "result = load_session_history('child_001', 'session_123')",
          "result = load_session_history('child_001', 'session_123', max_turns=5)"
        ]
      },
      {
        "tool_name": "save_session_history",
        "description": "将会话历史保存到本地文件系统，自动验证和更新元数据",
        "function_signature": "save_session_history(user_id: str, session_id: str, history_data: Dict[str, Any], cache_dir: Optional[str] = None, create_if_missing: bool = True) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "history_data",
            "type": "Dict[str, Any]",
            "description": "会话历史数据字典",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          },
          {
            "name": "create_if_missing",
            "type": "bool",
            "description": "如果目录不存在是否创建，默认True",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、file_path、file_size_bytes、total_turns、last_updated",
        "dependencies": [
          "json - JSON数据序列化",
          "pathlib.Path - 文件路径操作",
          "datetime - 时间戳生成",
          "strands - @tool装饰器"
        ],
        "implementation_notes": [
          "自动补充session_id、user_id、created_at、last_updated字段",
          "验证会话轮数不超过MAX_SESSION_TURNS（50轮）",
          "自动更新session_metadata中的total_turns",
          "如果是首次保存，设置start_time",
          "自动创建用户目录（如果create_if_missing=True）"
        ],
        "error_handling": [
          "会话轮数超限: 返回validation_error错误",
          "目录不存在且不允许创建: 返回directory_not_found错误",
          "PermissionError: 捕获并返回permission_error错误",
          "OSError（磁盘空间不足）: 捕获并返回os_error错误",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "history = {'conversation_turns': [...], 'session_metadata': {...}}",
          "result = save_session_history('child_001', 'session_123', history)"
        ]
      },
      {
        "tool_name": "append_conversation_turn",
        "description": "向会话历史追加一轮对话，自动管理轮次编号和时间戳",
        "function_signature": "append_conversation_turn(user_id: str, session_id: str, user_input: str, agent_response: str, cache_dir: Optional[str] = None, context_summary: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "user_input",
            "type": "str",
            "description": "用户输入内容",
            "required": true
          },
          {
            "name": "agent_response",
            "type": "str",
            "description": "Agent回复内容",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          },
          {
            "name": "context_summary",
            "type": "Optional[str]",
            "description": "本轮上下文摘要",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、turn_number、total_turns",
        "dependencies": [
          "load_session_history - 加载现有会话",
          "save_session_history - 保存更新后的会话",
          "datetime - 时间戳生成"
        ],
        "implementation_notes": [
          "自动计算turn_number（从1开始递增）",
          "自动生成时间戳（UTC时间+Z后缀）",
          "如果会话不存在，自动创建新会话",
          "检查是否超过最大轮数限制（50轮）",
          "自动更新session_metadata中的total_turns"
        ],
        "error_handling": [
          "会话轮数超限: 返回limit_exceeded错误",
          "会话加载失败: 传播load_session_history的错误",
          "保存失败: 传播save_session_history的错误"
        ],
        "usage_examples": [
          "result = append_conversation_turn('child_001', 'session_123', '你好', '你好呀！')",
          "result = append_conversation_turn('child_001', 'session_123', '我喜欢恐龙', '恐龙真的很神奇！', context_summary='讨论兴趣爱好')"
        ]
      },
      {
        "tool_name": "get_recent_context",
        "description": "获取最近N轮对话作为上下文，格式化为消息列表",
        "function_signature": "get_recent_context(user_id: str, session_id: str, window_size: int = 5, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "window_size",
            "type": "int",
            "description": "上下文窗口大小（最近N轮），默认5轮",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、window_size、actual_turns、context_messages（消息列表）",
        "dependencies": [
          "load_session_history - 加载会话历史"
        ],
        "implementation_notes": [
          "调用load_session_history并指定max_turns参数",
          "将conversation_turns格式化为标准的消息列表",
          "每个消息包含role（user/assistant）、content、turn、timestamp",
          "按时间顺序返回消息",
          "便于Agent直接使用作为上下文输入"
        ],
        "error_handling": [
          "会话加载失败: 传播load_session_history的错误"
        ],
        "usage_examples": [
          "result = get_recent_context('child_001', 'session_123')",
          "result = get_recent_context('child_001', 'session_123', window_size=3)"
        ]
      },
      {
        "tool_name": "create_new_session",
        "description": "创建新的会话，自动生成session_id或使用指定的ID",
        "function_signature": "create_new_session(user_id: str, session_id: Optional[str] = None, user_age: Optional[int] = None, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "Optional[str]",
            "description": "会话唯一标识，未提供则自动生成UUID",
            "required": false
          },
          {
            "name": "user_age",
            "type": "Optional[int]",
            "description": "用户年龄，用于记录会话时的年龄",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、file_path",
        "dependencies": [
          "uuid - UUID生成",
          "save_session_history - 保存新会话",
          "datetime - 时间戳生成"
        ],
        "implementation_notes": [
          "如果未提供session_id，使用uuid.uuid4()生成",
          "初始化空的conversation_turns列表",
          "设置start_time为当前时间",
          "如果提供user_age，记录到session_metadata",
          "自动创建用户目录"
        ],
        "error_handling": [
          "保存失败: 传播save_session_history的错误"
        ],
        "usage_examples": [
          "result = create_new_session('child_001')",
          "result = create_new_session('child_001', session_id='custom_id', user_age=8)"
        ]
      },
      {
        "tool_name": "list_user_sessions",
        "description": "列出用户的所有会话，按时间倒序排序",
        "function_signature": "list_user_sessions(user_id: str, cache_dir: Optional[str] = None, max_sessions: Optional[int] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          },
          {
            "name": "max_sessions",
            "type": "Optional[int]",
            "description": "最多返回的会话数，按时间倒序",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、total_sessions、returned_sessions、sessions（会话列表）",
        "dependencies": [
          "pathlib.Path - 文件路径操作",
          "json - JSON数据解析"
        ],
        "implementation_notes": [
          "查找用户目录下所有session_*.json文件",
          "读取每个会话的元数据",
          "按start_time倒序排序",
          "如果指定max_sessions，只返回最近的N个会话",
          "跳过损坏的会话文件"
        ],
        "error_handling": [
          "用户目录不存在: 返回空会话列表",
          "单个会话文件损坏: 跳过并继续处理其他文件"
        ],
        "usage_examples": [
          "result = list_user_sessions('child_001')",
          "result = list_user_sessions('child_001', max_sessions=10)"
        ]
      },
      {
        "tool_name": "get_session_summary",
        "description": "获取会话的摘要信息，包含关键统计数据",
        "function_signature": "get_session_summary(user_id: str, session_id: str, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、summary（会话摘要）",
        "dependencies": [
          "load_session_history - 加载会话历史"
        ],
        "implementation_notes": [
          "提取关键信息：开始时间、结束时间、总轮数、讨论主题、用户年龄、首条消息、最后一条消息",
          "摘要格式便于快速了解会话概况"
        ],
        "error_handling": [
          "会话不存在: 返回not_found状态",
          "会话加载失败: 传播load_session_history的错误"
        ],
        "usage_examples": [
          "result = get_session_summary('child_001', 'session_123')"
        ]
      },
      {
        "tool_name": "archive_old_sessions",
        "description": "归档旧的会话历史，保留最近的N个会话",
        "function_signature": "archive_old_sessions(user_id: str, keep_recent: int = 10, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "keep_recent",
            "type": "int",
            "description": "保留最近的会话数量，默认10",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、total_sessions、kept_sessions、archived_count、archive_directory",
        "dependencies": [
          "list_user_sessions - 列出所有会话",
          "pathlib.Path - 文件路径操作"
        ],
        "implementation_notes": [
          "调用list_user_sessions获取所有会话并按时间排序",
          "如果会话数量<=keep_recent，不执行归档",
          "创建archived_sessions子目录",
          "将旧会话文件移动到归档目录",
          "跳过无法移动的文件"
        ],
        "error_handling": [
          "单个文件移动失败: 跳过并继续处理其他文件",
          "归档目录创建失败: 返回错误"
        ],
        "usage_examples": [
          "result = archive_old_sessions('child_001')",
          "result = archive_old_sessions('child_001', keep_recent=5)"
        ]
      },
      {
        "tool_name": "delete_session",
        "description": "删除指定的会话历史文件",
        "function_signature": "delete_session(user_id: str, session_id: str, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、deleted_file",
        "dependencies": [
          "pathlib.Path - 文件路径操作"
        ],
        "implementation_notes": [
          "检查文件是否存在",
          "使用Path.unlink()删除文件",
          "删除操作不可逆，请谨慎使用"
        ],
        "error_handling": [
          "文件不存在: 返回not_found状态",
          "PermissionError: 捕获并返回permission_error错误",
          "其他异常: 捕获并返回unknown_error错误"
        ],
        "usage_examples": [
          "result = delete_session('child_001', 'session_123')"
        ]
      },
      {
        "tool_name": "update_session_topics",
        "description": "更新会话讨论的主题列表，支持追加或覆盖模式",
        "function_signature": "update_session_topics(user_id: str, session_id: str, topics: List[str], cache_dir: Optional[str] = None, append_mode: bool = True) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "topics",
            "type": "List[str]",
            "description": "主题列表",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          },
          {
            "name": "append_mode",
            "type": "bool",
            "description": "是否追加模式（True=追加，False=覆盖），默认True",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、topics、total_topics",
        "dependencies": [
          "load_session_history - 加载会话历史",
          "save_session_history - 保存更新后的会话"
        ],
        "implementation_notes": [
          "追加模式：合并新旧主题并自动去重",
          "覆盖模式：直接替换主题列表",
          "主题列表存储在session_metadata.topics_discussed中"
        ],
        "error_handling": [
          "会话加载失败: 传播load_session_history的错误",
          "保存失败: 传播save_session_history的错误"
        ],
        "usage_examples": [
          "result = update_session_topics('child_001', 'session_123', ['恐龙', '科学'])",
          "result = update_session_topics('child_001', 'session_123', ['绘画'], append_mode=True)"
        ]
      },
      {
        "tool_name": "close_session",
        "description": "关闭会话，标记会话结束时间",
        "function_signature": "close_session(user_id: str, session_id: str, cache_dir: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "user_id",
            "type": "str",
            "description": "用户唯一标识",
            "required": true
          },
          {
            "name": "session_id",
            "type": "str",
            "description": "会话唯一标识",
            "required": true
          },
          {
            "name": "cache_dir",
            "type": "Optional[str]",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的结果，包含status、message、user_id、session_id、end_time、total_turns",
        "dependencies": [
          "load_session_history - 加载会话历史",
          "save_session_history - 保存更新后的会话",
          "datetime - 时间戳生成"
        ],
        "implementation_notes": [
          "设置session_metadata.end_time为当前UTC时间",
          "关闭后的会话仍可追加对话（如果需要）",
          "end_time主要用于统计和分析"
        ],
        "error_handling": [
          "会话不存在: 返回not_found状态",
          "会话加载失败: 传播load_session_history的错误",
          "保存失败: 传播save_session_history的错误"
        ],
        "usage_examples": [
          "result = close_session('child_001', 'session_123')"
        ]
      }
    ],
    "code_quality": {
      "code_standards": [
        "遵循PEP 8代码风格规范",
        "使用完整的类型注解（typing模块）",
        "函数文档字符串包含Args、Returns、描述",
        "变量命名清晰、语义化",
        "代码结构清晰，逻辑分层",
        "避免硬编码，使用常量定义",
        "注释简洁明了，解释关键逻辑",
        "错误处理完整，覆盖所有异常场景"
      ],
      "testing_strategy": [
        "单元测试：为每个工具函数编写独立的单元测试",
        "集成测试：测试工具函数之间的协作（如load+update+save）",
        "边界测试：测试边界条件（空数据、最大轮数、权重范围）",
        "错误测试：测试各种异常场景（文件不存在、权限不足、磁盘满）",
        "性能测试：测试大量数据下的读写性能",
        "并发测试：测试多进程/多线程环境下的文件操作安全性"
      ],
      "performance_considerations": [
        "文件I/O优化：使用缓冲读写，减少磁盘操作次数",
        "JSON解析优化：使用json模块的高效解析",
        "内存管理：及时释放大对象，避免内存泄漏",
        "上下文窗口限制：load_session_history支持max_turns参数，减少数据传输",
        "会话归档：定期归档旧会话，保持活跃会话数量可控",
        "文件大小控制：限制会话最大50轮，画像文件<100KB",
        "缓存策略：未来可考虑为热门画像添加内存缓存"
      ],
      "security_measures": [
        "输入验证：验证user_id、session_id格式，防止路径遍历攻击",
        "权限控制：使用适当的文件权限（建议700），限制访问",
        "数据隔离：每个用户的数据存储在独立目录中",
        "敏感信息保护：不记录真实姓名、地址等敏感信息",
        "错误信息脱敏：错误返回不暴露系统路径等敏感信息",
        "文件锁定：未来可考虑添加文件锁，防止并发写入冲突",
        "数据加密：未来可考虑对画像数据进行加密存储"
      ]
    },
    "integration_details": {
      "aws_services": [],
      "external_libraries": [
        "strands - Strands框架，提供@tool装饰器",
        "json - Python标准库，JSON数据序列化和解析",
        "pathlib - Python标准库，文件路径操作",
        "datetime - Python标准库，时间戳生成和处理",
        "uuid - Python标准库，UUID生成",
        "typing - Python标准库，类型注解支持"
      ],
      "api_endpoints": [],
      "data_formats": [
        "JSON - 所有数据存储使用JSON格式",
        "ISO 8601 - 所有时间戳使用ISO 8601格式（UTC+Z后缀）",
        "UTF-8 - 所有文件使用UTF-8编码"
      ]
    },
    "development_notes": "工具开发完成，共开发18个工具函数，分为两个模块：profile_manager.py（7个工具）和session_manager.py（11个工具）。所有工具函数都遵循Strands框架规范，使用@tool装饰器定义，返回JSON格式的结构化数据。工具实现了完整的用户画像CRUD操作和会话历史管理功能，支持本地文件系统存储，具备良好的错误处理和数据验证能力。工具设计充分考虑了性能、安全性和可维护性，为Agent提供了可靠的数据管理基础设施。所有工具函数都包含详细的文档字符串和类型注解，便于理解和使用。建议在Agent开发阶段进行充分的测试，确保工具在各种场景下的稳定性和可靠性。"
  }
}