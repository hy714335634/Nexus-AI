{
  "system_design": {
    "design_overview": {
      "project_name": "company_info_search_agent",
      "version": "1.0",
      "date": "2025-09-30",
      "design_scope": "设计一个能够读取Excel表格中的公司信息，通过多种搜索引擎查询公司详细信息，并将结果输出为Excel表格的智能体系统",
      "design_principles": [
        "模块化设计，确保各功能组件职责单一",
        "可扩展性设计，支持未来添加更多搜索引擎和数据源",
        "容错性设计，确保在API调用失败时能够自动切换到备用搜索引擎",
        "可观测性设计，提供清晰的进度指示和错误提示",
        "安全性设计，确保API密钥等敏感信息的安全存储"
      ],
      "key_decisions": [
        "采用单Agent架构，由于处理流程相对线性，不需要多Agent协作",
        "使用深度研究专家(deep_research_agent)模板作为基础",
        "集成多种搜索工具，包括SerpAPI和http_request",
        "实现文件缓存机制，支持任务断点续传",
        "采用分批处理策略，避免token限制和内存问题"
      ],
      "workflow_type": "single_agent",
      "recommended_templates": ["deep_research_agent"]
    },
    "architecture": {
      "system_context": "系统将作为一个单一的智能体运行，接收Excel文件输入，处理公司信息查询，并生成Excel文件输出。系统与多个搜索引擎API交互，获取公司信息，并通过文件系统进行数据缓存和结果输出。",
      "agent_topology": "单Agent架构，由一个核心智能体负责整个工作流程，包括输入处理、信息查询、结果整理和输出生成。",
      "interaction_model": "用户通过提供Excel文件和配置参数与Agent交互，Agent执行查询并返回结果Excel文件。Agent内部与多个搜索引擎API和文件系统交互。",
      "technology_stack": {
        "sdk": "Strands SDK",
        "runtime": "Local",
        "integrations": [
          "SerpAPI (Google, Bing, Baidu, DuckDuckGo)",
          "HTTP请求客户端",
          "Excel文件处理库(pandas)",
          "文件系统操作"
        ]
      }
    },
    "agents": [
      {
        "name": "company_info_search_agent",
        "purpose": "读取Excel表格中的公司信息，通过多种搜索引擎查询公司详细信息，并将结果输出为Excel表格",
        "responsibilities": [
          "解析输入的Excel文件，提取公司名称信息",
          "通过多种搜索引擎查询公司详细信息",
          "深度检索网页内容获取更多公司信息",
          "整理和汇总公司信息",
          "分批处理大量公司信息",
          "管理缓存和任务进度",
          "生成输出Excel文件"
        ],
        "interfaces": {
          "inputs": [
            "Excel文件路径(包含'Company-Name-ENG'和'Company-Name-CHN'字段)",
            "任务ID(可选，用于断点续传)",
            "搜索引擎优先级(可选)",
            "API密钥(可选，用于商业搜索引擎)",
            "批处理大小(可选，控制每批处理的公司数量)"
          ],
          "outputs": [
            "中间CSV文件(分批处理结果)",
            "最终Excel文件(包含所有查询结果)",
            "进度报告(当前处理状态)",
            "错误日志(查询失败的公司和原因)"
          ]
        },
        "dependencies": [
          "SerpAPI服务",
          "文件系统",
          "网络连接"
        ],
        "implementation_notes": [
          "基于deep_research_agent模板实现",
          "使用pandas库处理Excel文件",
          "实现缓存机制，支持断点续传",
          "实现搜索引擎切换逻辑，确保查询可靠性",
          "实现分批处理逻辑，避免token限制"
        ],
        "recommended_template": "deep_research_agent"
      }
    ],
    "data_models": [
      {
        "name": "CompanyInfo",
        "schema": "{\n  \"company_name_eng\": \"英文公司名称\",\n  \"company_name_chn\": \"中文公司名称\",\n  \"revenue\": \"营业额\",\n  \"company_profile\": \"公司简介\",\n  \"related_links\": [\"相关链接列表\"],\n  \"company_type\": \"公司类型(全球/中国)\",\n  \"additional_info\": {\"其他信息字段\"},\n  \"info_sources\": [\"信息来源\"],\n  \"last_updated\": \"信息最后更新时间\"\n}",
        "validation_rules": [
          "company_name_eng或company_name_chn至少有一个非空",
          "revenue必须是数字或包含货币符号的字符串",
          "related_links必须是有效URL列表",
          "last_updated必须是有效的日期时间格式"
        ],
        "relationships": []
      },
      {
        "name": "TaskProgress",
        "schema": "{\n  \"task_id\": \"任务唯一标识符\",\n  \"total_companies\": \"总公司数量\",\n  \"processed_companies\": \"已处理公司数量\",\n  \"failed_companies\": [\"处理失败的公司列表\"],\n  \"current_batch\": \"当前处理批次\",\n  \"last_processed_index\": \"最后处理的公司索引\",\n  \"start_time\": \"任务开始时间\",\n  \"last_updated\": \"最后更新时间\"\n}",
        "validation_rules": [
          "task_id必须是唯一的字符串",
          "processed_companies必须小于等于total_companies",
          "last_processed_index必须小于total_companies"
        ],
        "relationships": []
      },
      {
        "name": "SearchResult",
        "schema": "{\n  \"company_name\": \"查询的公司名称\",\n  \"search_engine\": \"使用的搜索引擎\",\n  \"query\": \"搜索查询\",\n  \"results\": [{\n    \"title\": \"结果标题\",\n    \"link\": \"结果链接\",\n    \"snippet\": \"结果摘要\",\n    \"source\": \"信息来源\",\n    \"date\": \"信息日期(如果有)\"\n  }],\n  \"deep_content\": [{\n    \"url\": \"深度检索的URL\",\n    \"content\": \"提取的内容\",\n    \"extraction_time\": \"内容提取时间\"\n  }]\n}",
        "validation_rules": [
          "company_name不能为空",
          "search_engine必须是支持的搜索引擎之一",
          "results必须是数组，可以为空"
        ],
        "relationships": []
      }
    ],
    "interaction_flows": [
      {
        "name": "初始化流程",
        "description": "初始化Agent并解析输入文件",
        "steps": [
          {
            "step": "接收用户输入",
            "agent": "company_info_search_agent",
            "action": "解析用户提供的参数(Excel文件路径、任务ID等)",
            "data": "用户输入参数"
          },
          {
            "step": "验证输入文件",
            "agent": "company_info_search_agent",
            "action": "验证Excel文件格式和必要字段",
            "data": "Excel文件内容"
          },
          {
            "step": "加载任务状态",
            "agent": "company_info_search_agent",
            "action": "检查是否存在任务ID对应的缓存状态",
            "data": "TaskProgress数据"
          },
          {
            "step": "初始化任务",
            "agent": "company_info_search_agent",
            "action": "创建新任务或恢复现有任务",
            "data": "TaskProgress数据"
          }
        ]
      },
      {
        "name": "公司信息查询流程",
        "description": "查询公司信息并进行深度检索",
        "steps": [
          {
            "step": "准备批次处理",
            "agent": "company_info_search_agent",
            "action": "从上次处理位置获取下一批公司",
            "data": "公司名称列表"
          },
          {
            "step": "搜索引擎查询",
            "agent": "company_info_search_agent",
            "action": "使用配置的搜索引擎查询公司信息",
            "data": "SearchResult数据"
          },
          {
            "step": "深度内容检索",
            "agent": "company_info_search_agent",
            "action": "获取搜索结果中链接的HTML内容",
            "data": "SearchResult.deep_content数据"
          },
          {
            "step": "信息提取与整理",
            "agent": "company_info_search_agent",
            "action": "从搜索结果和深度内容中提取公司信息",
            "data": "CompanyInfo数据"
          },
          {
            "step": "缓存结果",
            "agent": "company_info_search_agent",
            "action": "保存处理结果和任务进度",
            "data": "CompanyInfo和TaskProgress数据"
          }
        ]
      },
      {
        "name": "结果输出流程",
        "description": "生成中间CSV和最终Excel输出",
        "steps": [
          {
            "step": "批次结果输出",
            "agent": "company_info_search_agent",
            "action": "将当前批次结果输出为CSV文件",
            "data": "CSV文件"
          },
          {
            "step": "检查任务完成状态",
            "agent": "company_info_search_agent",
            "action": "检查是否所有公司都已处理",
            "data": "TaskProgress数据"
          },
          {
            "step": "合并最终结果",
            "agent": "company_info_search_agent",
            "action": "将所有批次结果合并为一个Excel文件",
            "data": "Excel文件"
          },
          {
            "step": "生成任务报告",
            "agent": "company_info_search_agent",
            "action": "生成包含处理统计和错误信息的报告",
            "data": "任务报告"
          }
        ]
      },
      {
        "name": "错误处理流程",
        "description": "处理查询和处理过程中的错误",
        "steps": [
          {
            "step": "检测搜索引擎错误",
            "agent": "company_info_search_agent",
            "action": "检测搜索引擎API调用错误",
            "data": "错误信息"
          },
          {
            "step": "切换搜索引擎",
            "agent": "company_info_search_agent",
            "action": "切换到下一个可用的搜索引擎",
            "data": "搜索引擎配置"
          },
          {
            "step": "记录处理失败",
            "agent": "company_info_search_agent",
            "action": "记录无法处理的公司信息",
            "data": "失败记录"
          },
          {
            "step": "恢复处理流程",
            "agent": "company_info_search_agent",
            "action": "从错误中恢复并继续处理下一个公司",
            "data": "TaskProgress数据"
          }
        ]
      }
    ],
    "security_considerations": [
      "API密钥应安全存储，不应在日志或输出中暴露",
      "遵循搜索引擎的使用政策和速率限制",
      "确保缓存数据的安全性，避免敏感信息泄露",
      "实现适当的错误处理，避免暴露系统细节"
    ],
    "error_handling": [
      "实现搜索引擎API错误处理，自动切换到备用搜索引擎",
      "处理网络连接错误，实现重试机制",
      "处理文件读写错误，确保数据不丢失",
      "记录处理失败的公司信息，便于后续手动处理",
      "实现任务状态恢复机制，支持从错误中恢复"
    ],
    "performance_considerations": [
      "实现批处理机制，控制内存使用",
      "优化搜索查询，减少不必要的API调用",
      "实现缓存机制，避免重复查询",
      "控制并发请求数量，避免触发API限制",
      "优化文件读写操作，减少I/O开销"
    ],
    "monitoring_strategy": [
      "记录任务进度和处理状态",
      "记录API调用次数和响应时间",
      "记录错误和异常情况",
      "提供实时进度反馈",
      "生成任务完成报告，包含统计信息"
    ]
  },
  "design_rationale": "本设计采用单Agent架构，主要基于以下考虑：1) 处理流程相对线性，从输入到输出有明确的步骤顺序；2) 任务逻辑相对集中，不需要多Agent协作；3) 单Agent架构简化了系统复杂度，便于实现和维护。选择deep_research_agent模板作为基础，因为该模板专门设计用于进行真实的互联网查询和信息收集、分析和综合，完美匹配本项目需要查询公司详细信息的需求。它集成了网络搜索工具、数据分析工具、文件读写工具和缓存管理功能，能够从多个真实来源收集信息并进行深度分析。系统的关键设计点包括：1) 多搜索引擎集成和切换机制，确保查询可靠性；2) 深度内容检索，获取更全面的公司信息；3) 缓存机制和任务进度跟踪，支持大规模数据处理和断点续传；4) 分批处理和输出策略，避免token限制和内存问题。这些设计决策旨在构建一个高效、可靠、易用的公司信息检索系统，满足用户对大量公司信息进行查询和分析的需求。"
}