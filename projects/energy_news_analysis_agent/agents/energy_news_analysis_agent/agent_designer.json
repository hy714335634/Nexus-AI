{
  "agent_design": {
    "design_overview": {
      "project_name": "energy_news_analysis_agent",
      "version": "1.0",
      "date": "2026-01-04",
      "design_scope": "设计一个单Agent架构的能源行业新闻采集与分析智能体，实现从多数据源自动采集、智能分类、摘要生成、HTML报告生成到S3上传的全流程自动化处理",
      "design_goals": [
        "实现高效的多数据源并发采集，单次任务处理时间控制在5分钟以内",
        "通过AI驱动的智能分类和摘要生成，提供高质量的内容分析",
        "生成结构清晰、美观易读的HTML报告，支持快速浏览和信息检索",
        "实现可靠的S3上传和按日期归档，确保报告长期保存和检索",
        "提供流式响应和详细进度反馈，提升用户体验",
        "构建健壮的错误处理机制，确保系统在异常情况下仍能完成核心功能"
      ],
      "key_design_decisions": [
        {
          "decision": "采用单Agent架构而非多Agent协作模式",
          "rationale": "需求分析显示工作流是线性的（采集→分类→摘要→报告→上传），不需要复杂的Agent间协作。单Agent架构可以简化系统复杂度，降低开发和维护成本，同时满足所有功能需求",
          "alternatives": [
            "多Agent协作模式（采集Agent、分析Agent、报告Agent）",
            "基于工作流引擎的任务编排"
          ],
          "consequences": [
            "简化了系统架构，降低了开发复杂度",
            "减少了Agent间通信开销，提高了性能",
            "便于统一管理错误处理和流式响应",
            "未来如需扩展复杂协作场景，可能需要重构"
          ]
        },
        {
          "decision": "基于Playwright实现动态网页采集",
          "rationale": "目标网站（尤其是北极星能源网）可能使用JavaScript动态加载内容，传统的BeautifulSoup无法处理。Playwright可以模拟真实浏览器，执行JavaScript，大幅提高采集成功率",
          "alternatives": [
            "BeautifulSoup + requests（仅支持静态网页）",
            "Selenium（功能类似但性能较差）",
            "Scrapy框架（学习曲线较陡）"
          ],
          "consequences": [
            "提高了动态网页的采集成功率（90%+）",
            "增加了资源消耗（每个浏览器实例约150MB内存）",
            "需要限制并发浏览器实例数（最多3个）",
            "支持更复杂的反爬处理（如模拟人类行为）"
          ]
        },
        {
          "decision": "AI分类和摘要通过提示词工程实现",
          "rationale": "利用Claude Sonnet 4.5强大的语言理解能力，通过精心设计的提示词实现内容分类和摘要生成，避免训练自定义模型的高成本（数据标注、模型训练、部署）和长周期（2-3个月）",
          "alternatives": [
            "训练自定义分类模型（需要大量标注数据）",
            "使用规则引擎进行分类（准确率较低）",
            "基于传统NLP技术的关键词提取"
          ],
          "consequences": [
            "开发周期缩短至2周，成本降低80%",
            "分类准确率可达85%+，满足业务需求",
            "摘要质量高，关键信息不遗漏",
            "依赖于AI模型API的稳定性和成本",
            "需要持续优化提示词以提高准确率"
          ]
        },
        {
          "decision": "采用异步并发采集策略",
          "rationale": "使用asyncio和aiohttp实现并发请求，理论上可以将4个数据源的采集时间从串行的4分钟缩短到并发的1分钟，大幅提升性能。并发控制（最多10个并发请求）避免目标网站的反爬限制",
          "alternatives": [
            "串行采集（性能差，总时间长）",
            "多进程并发（资源消耗大，复杂度高）",
            "多线程并发（GIL限制，性能提升有限）"
          ],
          "consequences": [
            "采集时间缩短50-70%，提升用户体验",
            "需要合理控制并发数，避免被封禁",
            "增加了异步编程的复杂度",
            "需要处理并发异常和超时控制"
          ]
        },
        {
          "decision": "使用Jinja2模板引擎生成HTML报告",
          "rationale": "模板化设计将报告格式与业务逻辑分离，便于调整报告布局（如添加新的分类、修改样式）。Jinja2是成熟的模板引擎，支持丰富的模板语法，易于维护和扩展",
          "alternatives": [
            "手动拼接HTML字符串（难以维护）",
            "使用Markdown转HTML（格式灵活性受限）",
            "基于React/Vue的前端渲染（复杂度过高）"
          ],
          "consequences": [
            "报告格式易于调整和扩展",
            "模板与业务逻辑分离，提高可维护性",
            "支持动态渲染分类内容、摘要、超链接",
            "需要学习Jinja2模板语法"
          ]
        },
        {
          "decision": "S3按年/月/日目录结构归档",
          "rationale": "报告按年/月/日目录结构组织（如2026/01/04/），便于长期归档和检索。时间戳+关键词的文件名（如20260104_143025_光伏政策.html）避免文件名冲突，同时提供可读性",
          "alternatives": [
            "扁平化存储（所有文件在同一目录）",
            "按关键词分类存储",
            "按数据源分类存储"
          ],
          "consequences": [
            "便于按日期检索历史报告",
            "目录结构清晰，易于管理",
            "支持按日期统计报告数量",
            "文件名包含时间戳和关键词，提高可读性"
          ]
        }
      ]
    },
    "agents": [
      {
        "agent_id": "energy_news_analysis_agent",
        "name": "Energy News Analysis Agent",
        "role": "能源行业新闻采集与分析专家",
        "purpose": "自动化完成能源行业新闻的采集、分类、摘要、报告生成和归档的全流程处理，为用户提供结构化、易读的能源行业动态报告",
        "personality": {
          "traits": [
            "专业严谨：对能源行业术语和政策有深入理解",
            "高效执行：并发处理多个数据源，快速完成任务",
            "注重细节：确保采集内容的完整性和准确性",
            "用户友好：提供清晰的进度反馈和易读的报告"
          ],
          "communication_style": "专业、简洁、信息丰富。通过流式响应实时反馈处理进度，使用结构化的信息呈现方式，便于用户快速理解",
          "tone": "正式而友好，注重信息的准确性和可读性"
        },
        "capabilities": {
          "core_functions": [
            "多数据源并发采集：从北极星能源网、国家能源局、国家发改委、省级能源局等多个数据源并发采集能源行业新闻",
            "动态数据源发现：通过搜索引擎自动发现各省级能源局官网",
            "智能内容分类：使用AI模型将采集内容分类为政策类、案例类、新能源行业、能源科技类",
            "摘要生成：为每篇文章生成200-300字的精炼摘要，并生成500-800字的全局关键信息总结",
            "HTML报告生成：基于Jinja2模板生成结构清晰、美观易读的HTML报告",
            "S3归档上传：将报告上传到S3存储桶，按年/月/日目录结构组织",
            "流式进度反馈：实时反馈处理进度，提升用户体验",
            "错误处理和降级：在部分数据源失败时仍能完成任务，确保系统健壮性"
          ],
          "specialized_skills": [
            "动态网页采集：使用Playwright处理JavaScript动态加载的网页",
            "反爬处理：模拟真实用户行为，设置合理的请求频率，遵守robots.txt协议",
            "异步并发处理：使用asyncio实现高效的并发采集",
            "AI提示词工程：设计高质量的分类和摘要提示词，确保85%+的准确率",
            "HTML模板渲染：使用Jinja2动态生成结构化报告",
            "AWS S3操作：使用boto3实现可靠的文件上传和目录管理"
          ],
          "limitations": [
            "仅支持中文内容处理，不支持英文或其他语言",
            "依赖于目标网站的HTML结构稳定性，结构变化可能导致采集失败",
            "AI分类和摘要依赖于Claude Sonnet 4.5模型的可用性",
            "不支持实时监控和定时任务调度（需外部调度器）",
            "不支持历史报告的检索和对比分析",
            "单次任务处理时间受数据源响应速度和文章数量影响"
          ],
          "tools_required": [
            "web_scraper：基于Playwright的网页爬取工具，支持动态网页和反爬处理",
            "search_engine_query：基于Bing Search API的搜索引擎查询工具，用于发现省级能源局网站",
            "html_report_generator：基于Jinja2的HTML报告生成工具",
            "s3_uploader：基于boto3的S3上传工具，支持按日期归档",
            "content_classifier（通过提示词实现）：AI驱动的内容分类工具",
            "content_summarizer（通过提示词实现）：AI驱动的摘要生成工具"
          ]
        },
        "knowledge_domain": {
          "primary_domains": [
            "能源行业：光伏、风电、储能、氢能、核能、传统能源等领域",
            "政策法规：国家和地方能源政策、法规、规划文件",
            "技术标准：能源技术标准、行业规范、技术文档",
            "行业案例：能源项目案例、应用实践、成功经验",
            "网页爬取：HTML解析、CSS选择器、JavaScript渲染、反爬技术",
            "AI应用：提示词工程、内容分类、文本摘要生成"
          ],
          "expertise_level": "专家级 - 深入理解能源行业术语、政策背景和技术趋势，精通网页爬取和AI应用技术",
          "knowledge_sources": [
            "北极星能源网 (https://energy.bjx.com.cn/nyxny/)",
            "国家能源局 (https://www.nea.gov.cn/)",
            "国家发改委 (https://www.ndrc.gov.cn/)",
            "各省级能源局（动态发现）",
            "能源行业专业术语库",
            "AI模型知识库（Claude Sonnet 4.5）"
          ],
          "update_frequency": "实时更新 - 每次任务执行时从最新数据源采集内容"
        },
        "interaction_patterns": {
          "communication_style": "流式响应 - 通过stream_async实现实时进度反馈，每个关键步骤完成后返回进度信息",
          "conversation_flow": "线性流程 - 接收关键词 → 初始化配置 → 并发采集 → 内容分类 → 摘要生成 → 报告生成 → S3上传 → 返回结果",
          "error_responses": [
            "数据源采集失败：记录错误日志，重试3次（指数退避），失败后跳过该数据源并继续处理",
            "AI模型超时：使用降级策略（跳过该文章或使用规则分类）",
            "S3上传失败：保存报告到本地备份目录，返回本地路径和手动上传提示",
            "网络异常：自动重试，超时时间30秒",
            "HTML生成失败：使用简化的纯文本报告格式"
          ]
        },
        "constraints": [
          "必须使用Claude Sonnet 4.5模型（global.anthropic.claude-sonnet-4-5-20250929-v1:0）",
          "必须部署到AWS Bedrock AgentCore，支持HTTP /invocations端点",
          "必须使用Strands SDK框架开发",
          "S3存储桶固定为s3://newletter-2026，区域为us-west-2",
          "仅支持中文内容处理",
          "Python版本要求3.13+",
          "必须遵守目标网站的爬取规则和频率限制",
          "单次任务处理时间不超过5分钟",
          "Playwright浏览器实例数不超过3个",
          "并发请求数不超过10个"
        ],
        "evaluation_criteria": [
          "数据采集成功率：>90%（至少3个数据源采集成功）",
          "AI分类准确率：>85%",
          "摘要质量：关键信息不遗漏，长度控制在200-300字",
          "报告生成成功率：100%（即使部分数据源失败）",
          "S3上传成功率：>95%（失败时有本地备份）",
          "端到端处理时间：<5分钟（采集20篇文章）",
          "流式响应延迟：<2秒",
          "错误处理完整性：所有异常都有妥善处理和日志记录"
        ],
        "model_requirements": {
          "model_name": "global.anthropic.claude-sonnet-4-5-20250929-v1:0",
          "minimum_capabilities": [
            "理解能源行业专业术语和政策背景",
            "准确分类能源行业内容（政策类、案例类、新能源行业、能源科技类）",
            "生成高质量的文章摘要和全局总结",
            "支持多轮对话和上下文理解",
            "支持流式响应"
          ],
          "rationale": "Claude Sonnet 4.5是当前最先进的语言模型之一，具有强大的语言理解和生成能力，特别适合处理专业领域的内容分类和摘要生成任务。相比其他模型，Claude Sonnet 4.5在准确率、生成质量和稳定性方面都有显著优势"
        },
        "memory_configuration": {
          "memory_type": "短期记忆（会话级别） - 不需要长期记忆，每次任务独立执行",
          "retention_policy": "任务完成后清空内存，不保留历史数据（历史报告通过S3归档）",
          "retrieval_strategy": "无需检索历史数据，每次任务基于最新采集的内容生成报告"
        }
      }
    ],
    "agent_relationships": [],
    "system_integration": {
      "entry_point": "HTTP /invocations端点 - 通过AWS Bedrock AgentCore接收用户请求",
      "exit_points": [
        "流式响应：实时返回处理进度和最终结果（S3 URL、统计信息）",
        "S3存储：将HTML报告上传到s3://newletter-2026/{year}/{month}/{day}/",
        "本地备份：S3上传失败时保存到.cache/energy_news_analysis_agent/reports/"
      ],
      "external_interfaces": [
        "北极星能源网 (https://energy.bjx.com.cn/nyxny/) - HTTP/HTTPS",
        "国家能源局 (https://www.nea.gov.cn/) - HTTP/HTTPS",
        "国家发改委 (https://www.ndrc.gov.cn/) - HTTP/HTTPS",
        "Bing Search API - REST API",
        "AWS S3 - boto3 SDK",
        "Claude Sonnet 4.5 - AWS Bedrock API"
      ]
    }
  }
}