{
  "tool_development": {
    "development_overview": {
      "project_name": "sports_match_prediction_agent",
      "version": "1.0",
      "date": "2025-12-02",
      "development_scope": "为体育赛事预测智能体开发完整的工具集，包括体育数据API调用、缓存管理、数据验证、统计分析、预测模型和报告生成等核心功能。工具集分为两个主要模块：sports_data_tools（数据收集和管理）和sports_analysis_tools（数据分析和预测）。",
      "design_principles": [
        "模块化设计：将数据收集、分析、预测功能分离，便于维护和扩展",
        "缓存优先：实现多级缓存策略（球队24h、战绩7d、球员12h），显著提升性能",
        "容错机制：完善的错误处理和降级策略，确保系统稳定性",
        "数据验证：严格的数据完整性和有效性验证，保证分析质量",
        "可扩展性：预留接口支持更多数据源和预测模型",
        "JSON标准化：所有工具统一返回JSON格式，便于解析和处理"
      ],
      "key_decisions": [
        "采用The Sports DB作为主数据源，免费且数据全面",
        "实现本地文件系统缓存，使用pickle序列化，确保快速读写",
        "基于权重评分的预测模型（实力40%、状态20%、主客场15%、球员15%、交锋10%）",
        "置信度评估机制，根据数据完整性判断预测可靠性",
        "结构化报告生成，包含完整的分析细节和预测依据"
      ]
    },
    "tools": [
      {
        "tool_name": "cache_get",
        "description": "从缓存获取数据，支持多种数据类型（球队信息、比赛历史、球员状态、未来赛程）",
        "function_signature": "cache_get(data_type: str, identifier: str) -> str",
        "parameters": [
          {
            "name": "data_type",
            "type": "str",
            "description": "数据类型（team_info, match_history, player_status, upcoming_matches）",
            "required": true
          },
          {
            "name": "identifier",
            "type": "str",
            "description": "数据标识符（如team_id）",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的缓存数据，包含success标志、message和data字段。如果缓存未命中返回success=False",
        "dependencies": ["pickle", "hashlib", "pathlib"],
        "implementation_notes": [
          "使用MD5哈希生成缓存键，避免文件名冲突",
          "检查缓存过期时间，自动删除过期缓存",
          "缓存文件存储在.cache/sports_match_prediction_agent/目录",
          "异常处理：捕获所有读取错误，返回友好的错误信息"
        ],
        "error_handling": [
          "文件不存在：返回Cache miss",
          "文件损坏：返回Failed to get cache",
          "过期缓存：自动删除并返回Cache miss"
        ],
        "usage_examples": [
          "cache_get('team_info', '133604')",
          "cache_get('match_history', '133604:last_10')"
        ]
      },
      {
        "tool_name": "cache_set",
        "description": "设置缓存数据，支持自定义过期时间",
        "function_signature": "cache_set(data_type: str, identifier: str, data: str, ttl_hours: int = 24) -> str",
        "parameters": [
          {
            "name": "data_type",
            "type": "str",
            "description": "数据类型",
            "required": true
          },
          {
            "name": "identifier",
            "type": "str",
            "description": "数据标识符",
            "required": true
          },
          {
            "name": "data",
            "type": "str",
            "description": "要缓存的数据（JSON字符串）",
            "required": true
          },
          {
            "name": "ttl_hours",
            "type": "int",
            "description": "缓存过期时间（小时），默认24小时",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的操作结果，包含success标志和message",
        "dependencies": ["pickle", "json"],
        "implementation_notes": [
          "自动检查缓存总大小，超过500MB时清理最少使用的25%缓存",
          "使用pickle序列化，支持复杂数据结构",
          "记录缓存创建时间和过期时间"
        ],
        "error_handling": [
          "JSON解析失败：返回错误信息",
          "写入失败：捕获异常并返回友好提示"
        ],
        "usage_examples": [
          "cache_set('team_info', '133604', '{\"name\": \"Lakers\"}', 24)",
          "cache_set('match_history', '133604:last_10', match_data, 168)"
        ]
      },
      {
        "tool_name": "cache_clear",
        "description": "清空所有缓存",
        "function_signature": "cache_clear() -> str",
        "parameters": [],
        "return_type": "str",
        "return_description": "JSON格式的操作结果",
        "dependencies": ["pathlib"],
        "implementation_notes": [
          "删除.cache/sports_match_prediction_agent/目录下所有.cache文件",
          "用于维护或重置缓存"
        ],
        "error_handling": [
          "删除失败：返回错误信息"
        ],
        "usage_examples": [
          "cache_clear()"
        ]
      },
      {
        "tool_name": "search_team",
        "description": "搜索球队信息，支持模糊匹配和体育类型过滤",
        "function_signature": "search_team(team_name: str, sport_type: str = 'soccer') -> str",
        "parameters": [
          {
            "name": "team_name",
            "type": "str",
            "description": "球队名称（支持模糊匹配）",
            "required": true
          },
          {
            "name": "sport_type",
            "type": "str",
            "description": "体育类型（soccer/basketball），默认soccer",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的球队搜索结果，包含球队ID、名称、联赛、国家等信息",
        "dependencies": ["requests"],
        "implementation_notes": [
          "调用The Sports DB API的searchteams.php接口",
          "先检查缓存，缓存命中直接返回",
          "过滤指定体育类型的球队",
          "支持多结果返回，便于用户选择",
          "自动缓存搜索结果24小时"
        ],
        "error_handling": [
          "API超时：返回timeout错误，建议稍后重试",
          "球队未找到：返回友好提示和建议",
          "网络错误：捕获并返回错误信息"
        ],
        "usage_examples": [
          "search_team('Lakers', 'basketball')",
          "search_team('Manchester United', 'soccer')"
        ]
      },
      {
        "tool_name": "get_team_details",
        "description": "获取球队详细信息，包括成立年份、球场、社交媒体等",
        "function_signature": "get_team_details(team_id: str) -> str",
        "parameters": [
          {
            "name": "team_id",
            "type": "str",
            "description": "球队ID",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的球队详细信息",
        "dependencies": ["requests"],
        "implementation_notes": [
          "调用The Sports DB API的lookupteam.php接口",
          "先检查缓存（24小时）",
          "返回完整的球队资料"
        ],
        "error_handling": [
          "球队ID不存在：返回Team not found",
          "API错误：返回错误信息"
        ],
        "usage_examples": [
          "get_team_details('133604')"
        ]
      },
      {
        "tool_name": "get_team_last_matches",
        "description": "获取球队最近比赛记录，并计算统计数据",
        "function_signature": "get_team_last_matches(team_id: str, limit: int = 10) -> str",
        "parameters": [
          {
            "name": "team_id",
            "type": "str",
            "description": "球队ID",
            "required": true
          },
          {
            "name": "limit",
            "type": "int",
            "description": "返回结果数量限制，默认10场",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的比赛记录和统计数据",
        "dependencies": ["requests"],
        "implementation_notes": [
          "调用The Sports DB API的eventslast.php接口",
          "自动计算胜率、场均得分等统计指标",
          "缓存结果7天",
          "包含比赛日期、对手、比分、场地等完整信息"
        ],
        "error_handling": [
          "无比赛记录：返回友好提示",
          "API错误：返回错误信息"
        ],
        "usage_examples": [
          "get_team_last_matches('133604', 10)"
        ]
      },
      {
        "tool_name": "get_team_next_matches",
        "description": "获取球队未来赛程",
        "function_signature": "get_team_next_matches(team_id: str, limit: int = 5) -> str",
        "parameters": [
          {
            "name": "team_id",
            "type": "str",
            "description": "球队ID",
            "required": true
          },
          {
            "name": "limit",
            "type": "int",
            "description": "返回结果数量限制，默认5场",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的未来赛程",
        "dependencies": ["requests"],
        "implementation_notes": [
          "调用The Sports DB API的eventsnext.php接口",
          "返回对手ID，便于后续分析",
          "缓存结果12小时",
          "包含比赛日期、时间、对手、场地等信息"
        ],
        "error_handling": [
          "无未来赛程：返回友好提示",
          "API错误：返回错误信息"
        ],
        "usage_examples": [
          "get_team_next_matches('133604', 5)"
        ]
      },
      {
        "tool_name": "get_head_to_head",
        "description": "获取两队历史交锋记录和统计",
        "function_signature": "get_head_to_head(team1_id: str, team2_id: str) -> str",
        "parameters": [
          {
            "name": "team1_id",
            "type": "str",
            "description": "球队1 ID",
            "required": true
          },
          {
            "name": "team2_id",
            "type": "str",
            "description": "球队2 ID",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的交锋记录和统计",
        "dependencies": ["requests", "json"],
        "implementation_notes": [
          "通过获取两队最近比赛并筛选交锋记录实现",
          "计算双方胜负平统计和胜率",
          "缓存结果7天",
          "如无交锋记录返回空数据但不报错"
        ],
        "error_handling": [
          "无交锋记录：返回空列表",
          "API错误：返回错误信息"
        ],
        "usage_examples": [
          "get_head_to_head('133604', '133612')"
        ]
      },
      {
        "tool_name": "validate_team_data",
        "description": "验证球队数据的完整性和有效性",
        "function_signature": "validate_team_data(team_data: str) -> str",
        "parameters": [
          {
            "name": "team_data",
            "type": "str",
            "description": "球队数据（JSON字符串）",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的验证结果，包含完整性评分和缺失字段",
        "dependencies": ["json"],
        "implementation_notes": [
          "检查必需字段（id, name, sport, league）",
          "检查可选字段（country, stadium, formed_year, description）",
          "计算数据完整性百分比",
          "评估数据质量等级（high/medium/low）"
        ],
        "error_handling": [
          "JSON解析失败：返回错误信息"
        ],
        "usage_examples": [
          "validate_team_data('{\"id\": \"133604\", \"name\": \"Lakers\"}')"
        ]
      },
      {
        "tool_name": "validate_match_data",
        "description": "验证比赛数据的完整性和有效性",
        "function_signature": "validate_match_data(match_data: str) -> str",
        "parameters": [
          {
            "name": "match_data",
            "type": "str",
            "description": "比赛数据（JSON字符串，可以是单场比赛或比赛列表）",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的验证结果，包含每场比赛的验证详情",
        "dependencies": ["json", "statistics"],
        "implementation_notes": [
          "支持单场比赛和比赛列表验证",
          "检查必需字段（date, home_team, away_team）",
          "检查比分字段（home_score, away_score）",
          "计算整体完整性和有比分的比赛数量"
        ],
        "error_handling": [
          "JSON解析失败：返回错误信息"
        ],
        "usage_examples": [
          "validate_match_data('[{\"date\": \"2024-01-01\", \"home_team\": \"Lakers\"}]')"
        ]
      },
      {
        "tool_name": "calculate_team_statistics",
        "description": "计算球队统计指标（胜率、场均得分、近期状态等）",
        "function_signature": "calculate_team_statistics(match_history: str, team_id: str) -> str",
        "parameters": [
          {
            "name": "match_history",
            "type": "str",
            "description": "比赛历史数据（JSON字符串）",
            "required": true
          },
          {
            "name": "team_id",
            "type": "str",
            "description": "球队ID",
            "required": true
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的统计结果",
        "dependencies": ["json", "statistics"],
        "implementation_notes": [
          "计算基础统计：总场次、胜平负、胜率",
          "计算主客场统计：主客场胜率",
          "计算进攻防守：场均进球、失球、净胜球",
          "计算近期状态：最近5场表现和得分",
          "计算特殊指标：零封场次、零进球场次"
        ],
        "error_handling": [
          "无比赛数据：返回错误信息",
          "JSON解析失败：返回错误信息"
        ],
        "usage_examples": [
          "calculate_team_statistics(match_history_json, '133604')"
        ]
      },
      {
        "tool_name": "analyze_recent_form",
        "description": "分析球队近期状态和趋势",
        "function_signature": "analyze_recent_form(match_history: str, team_id: str, num_matches: int = 5) -> str",
        "parameters": [
          {
            "name": "match_history",
            "type": "str",
            "description": "比赛历史数据（JSON字符串）",
            "required": true
          },
          {
            "name": "team_id",
            "type": "str",
            "description": "球队ID",
            "required": true
          },
          {
            "name": "num_matches",
            "type": "int",
            "description": "分析的比赛数量，默认5场",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的近期状态分析",
        "dependencies": ["json", "statistics"],
        "implementation_notes": [
          "生成状态字符串（如WWDLL）",
          "计算总得分和状态百分比",
          "分析趋势（improving/declining/stable）",
          "评估状态等级（excellent/good/average/poor）",
          "计算进攻和防守稳定性（标准差）"
        ],
        "error_handling": [
          "无比赛数据：返回错误信息"
        ],
        "usage_examples": [
          "analyze_recent_form(match_history_json, '133604', 5)"
        ]
      },
      {
        "tool_name": "predict_match_outcome",
        "description": "基于权重评分模型预测比赛结果",
        "function_signature": "predict_match_outcome(team1_stats: str, team2_stats: str, is_home: bool, head_to_head: str = None) -> str",
        "parameters": [
          {
            "name": "team1_stats",
            "type": "str",
            "description": "球队1统计数据（JSON字符串）",
            "required": true
          },
          {
            "name": "team2_stats",
            "type": "str",
            "description": "球队2统计数据（JSON字符串）",
            "required": true
          },
          {
            "name": "is_home",
            "type": "bool",
            "description": "球队1是否主场作战",
            "required": true
          },
          {
            "name": "head_to_head",
            "type": "str",
            "description": "历史交锋数据（JSON字符串，可选）",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的预测结果，包含胜平负概率、置信度和得分细分",
        "dependencies": ["json"],
        "implementation_notes": [
          "权重分配：实力40%、状态20%、主客场15%、球员15%、交锋10%",
          "计算各维度得分（-50到+50）",
          "归一化到0-100概率",
          "计算平局概率（基于实力差距）",
          "评估置信度（high/medium/low）",
          "返回详细的得分细分和权重说明"
        ],
        "error_handling": [
          "JSON解析失败：返回错误信息"
        ],
        "usage_examples": [
          "predict_match_outcome(team1_stats, team2_stats, True, h2h_data)"
        ]
      },
      {
        "tool_name": "generate_prediction_report",
        "description": "生成结构化的预测报告",
        "function_signature": "generate_prediction_report(team1_info: str, team2_info: str, team1_stats: str, team2_stats: str, prediction: str, match_info: str = None) -> str",
        "parameters": [
          {
            "name": "team1_info",
            "type": "str",
            "description": "球队1基本信息（JSON字符串）",
            "required": true
          },
          {
            "name": "team2_info",
            "type": "str",
            "description": "球队2基本信息（JSON字符串）",
            "required": true
          },
          {
            "name": "team1_stats",
            "type": "str",
            "description": "球队1统计数据（JSON字符串）",
            "required": true
          },
          {
            "name": "team2_stats",
            "type": "str",
            "description": "球队2统计数据（JSON字符串）",
            "required": true
          },
          {
            "name": "prediction",
            "type": "str",
            "description": "预测结果（JSON字符串）",
            "required": true
          },
          {
            "name": "match_info",
            "type": "str",
            "description": "比赛信息（JSON字符串，可选）",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的完整预测报告",
        "dependencies": ["json", "datetime"],
        "implementation_notes": [
          "包含报告元数据（生成时间、版本）",
          "包含比赛概览（球队信息、比赛时间地点）",
          "包含预测摘要（预测结果、概率、置信度）",
          "包含分析详情（双方统计、得分细分、关键因素）",
          "包含建议（基于置信度和预测结果）",
          "自动生成关键因素说明"
        ],
        "error_handling": [
          "JSON解析失败：返回错误信息"
        ],
        "usage_examples": [
          "generate_prediction_report(info1, info2, stats1, stats2, pred, match)"
        ]
      }
    ],
    "code_quality": {
      "code_standards": [
        "遵循PEP 8代码风格规范",
        "使用完整的类型注解（Python 3.13+）",
        "每个函数都有详细的文档字符串",
        "使用@tool装饰器定义所有工具函数",
        "统一返回JSON格式，便于解析",
        "命名清晰，函数职责单一"
      ],
      "testing_strategy": [
        "单元测试：测试每个工具函数的基本功能",
        "集成测试：测试工具间的协作（如缓存+API调用）",
        "边界测试：测试异常输入和边界情况",
        "性能测试：验证缓存命中率和响应时间",
        "API模拟：使用mock测试，避免依赖外部API"
      ],
      "performance_considerations": [
        "缓存优先策略，减少API调用",
        "多级缓存过期时间优化（球队24h、战绩7d、球员12h）",
        "缓存大小限制500MB，自动清理LRU",
        "API超时设置5秒，避免长时间等待",
        "批量数据处理，减少循环次数"
      ],
      "security_measures": [
        "API密钥通过环境变量管理",
        "输入验证：检查所有用户输入",
        "异常捕获：避免敏感信息泄露",
        "HTTPS协议：所有外部API调用使用HTTPS",
        "缓存隔离：每个Agent使用独立缓存目录"
      ]
    },
    "integration_details": {
      "aws_services": [],
      "external_libraries": [
        "requests - HTTP请求库，用于API调用",
        "pickle - Python序列化库，用于缓存数据",
        "json - JSON处理库",
        "hashlib - 哈希算法库，用于生成缓存键",
        "pathlib - 路径操作库",
        "statistics - 统计计算库（mean, stdev）",
        "datetime - 日期时间处理库"
      ],
      "api_endpoints": [
        "https://www.thesportsdb.com/api/v1/json/3/searchteams.php - 搜索球队",
        "https://www.thesportsdb.com/api/v1/json/3/lookupteam.php - 获取球队详情",
        "https://www.thesportsdb.com/api/v1/json/3/eventslast.php - 获取最近比赛",
        "https://www.thesportsdb.com/api/v1/json/3/eventsnext.php - 获取未来赛程"
      ],
      "data_formats": [
        "所有工具统一返回JSON格式字符串",
        "包含success标志表示操作是否成功",
        "错误时包含error和message字段",
        "成功时包含data字段存储实际数据",
        "缓存数据使用pickle序列化"
      ]
    },
    "development_notes": "工具开发完成，共实现14个工具函数，分为两个模块：\n\n1. sports_data_tools.py（8个工具）：\n   - 缓存管理：cache_get, cache_set, cache_clear\n   - 数据收集：search_team, get_team_details, get_team_last_matches, get_team_next_matches, get_head_to_head\n\n2. sports_analysis_tools.py（6个工具）：\n   - 数据验证：validate_team_data, validate_match_data\n   - 统计分析：calculate_team_statistics, analyze_recent_form\n   - 预测生成：predict_match_outcome, generate_prediction_report\n\n关键设计决策：\n- 采用The Sports DB作为主数据源，免费且数据覆盖广\n- 实现本地文件系统缓存，使用pickle序列化，性能优秀\n- 权重评分预测模型，可解释性强，无需训练数据\n- 完善的数据验证和错误处理，确保系统稳定性\n- 所有工具返回JSON格式，便于Agent解析和处理\n\n所有工具已通过语法验证，可以直接集成到Agent中使用。下一阶段将进行提示词工程，设计Agent的系统提示词和交互逻辑。"
  }
}