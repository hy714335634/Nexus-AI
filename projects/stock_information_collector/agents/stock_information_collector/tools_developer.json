{
  "tool_development": {
    "development_overview": {
      "project_name": "stock_information_collector",
      "version": "1.0",
      "date": "2025-11-28",
      "development_scope": "开发股票信息收集Agent所需的专用工具集，包括股票查询、行情数据获取、财务数据收集、新闻收集和缓存管理五大核心工具",
      "design_principles": [
        "模块化设计：每个工具专注于特定功能，便于维护和扩展",
        "数据缓存：实现智能缓存策略，减少API调用次数和响应时间",
        "容错处理：完善的异常处理机制，确保部分数据源失效时系统仍能工作",
        "多源集成：整合Yahoo Finance和DuckDuckGo等多个数据源",
        "标准化输出：所有工具返回统一的JSON格式数据"
      ],
      "key_decisions": [
        "选择yfinance作为主要股票数据源：免费、稳定、数据全面",
        "使用DuckDuckGo作为新闻数据补充：无需API密钥、无调用限制",
        "实现基于文件的缓存系统：简单可靠、无需外部依赖",
        "采用差异化缓存策略：基本信息24小时、行情15分钟、新闻1小时、财务7天",
        "支持多市场股票代码规范化：自动识别A股、港股、美股"
      ]
    },
    "tools": [
      {
        "tool_name": "cache_manager_tool",
        "description": "缓存管理工具，支持数据的存储、读取、删除、清理和统计操作，实现智能缓存策略",
        "function_signature": "cache_manager_tool(operation: str, key: str, value: Optional[str] = None, ttl_minutes: Optional[int] = None, cache_dir: str = '.cache/stock_information_collector') -> str",
        "parameters": [
          {
            "name": "operation",
            "type": "str",
            "description": "操作类型：set(设置)、get(获取)、delete(删除)、clear(清空)、stats(统计)",
            "required": true
          },
          {
            "name": "key",
            "type": "str",
            "description": "缓存键，用于唯一标识缓存数据",
            "required": true
          },
          {
            "name": "value",
            "type": "Optional[str]",
            "description": "缓存值（JSON字符串），仅set操作需要",
            "required": false
          },
          {
            "name": "ttl_minutes",
            "type": "Optional[int]",
            "description": "缓存有效期（分钟），None表示永久有效",
            "required": false
          },
          {
            "name": "cache_dir",
            "type": "str",
            "description": "缓存目录路径",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的操作结果，包含成功状态、操作类型、相关数据",
        "dependencies": [
          "pathlib",
          "hashlib",
          "json",
          "datetime"
        ],
        "implementation_notes": [
          "使用MD5哈希避免缓存键中的特殊字符问题",
          "每个缓存项包含数据文件(.json)和元数据文件(.meta)",
          "自动检查缓存过期并清理过期数据",
          "支持缓存统计功能，便于监控缓存使用情况"
        ],
        "error_handling": [
          "文件不存在：返回cache not found错误",
          "缓存过期：自动删除过期文件并返回cache expired错误",
          "文件操作失败：捕获异常并返回详细错误信息",
          "无效操作：返回支持的操作列表"
        ],
        "usage_examples": [
          "设置缓存：cache_manager_tool('set', 'stock_basic_info:AAPL', '{\"name\":\"Apple\"}', 1440)",
          "获取缓存：cache_manager_tool('get', 'stock_basic_info:AAPL')",
          "删除缓存：cache_manager_tool('delete', 'stock_basic_info:AAPL')",
          "统计缓存：cache_manager_tool('stats', '')"
        ]
      },
      {
        "tool_name": "stock_query_tool",
        "description": "股票查询工具，通过股票代码或名称识别股票并获取基本信息，支持A股、港股、美股市场",
        "function_signature": "stock_query_tool(query: str, market: Optional[str] = None, query_type: str = 'auto') -> str",
        "parameters": [
          {
            "name": "query",
            "type": "str",
            "description": "股票代码或名称（如：AAPL、苹果、000001、平安银行）",
            "required": true
          },
          {
            "name": "market",
            "type": "Optional[str]",
            "description": "市场类型（A股/港股/美股/auto），auto表示自动识别",
            "required": false
          },
          {
            "name": "query_type",
            "type": "str",
            "description": "查询类型（symbol/name/auto），auto表示自动识别",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的股票基本信息，包含公司名称、行业、市值、描述等",
        "dependencies": [
          "yfinance",
          "json",
          "datetime"
        ],
        "implementation_notes": [
          "使用yfinance库获取股票信息",
          "自动规范化股票代码（A股添加.SS/.SZ后缀，港股添加.HK后缀）",
          "支持自动识别市场类型",
          "缓存基本信息24小时，减少API调用",
          "返回格式化的市值数据（万亿/亿/百万）"
        ],
        "error_handling": [
          "yfinance未安装：返回安装提示",
          "股票不存在：返回stock not found错误",
          "API调用失败：捕获异常并返回详细错误信息",
          "数据不完整：使用默认值'N/A'填充缺失字段"
        ],
        "usage_examples": [
          "查询美股：stock_query_tool('AAPL')",
          "查询A股：stock_query_tool('000001', 'A股')",
          "查询港股：stock_query_tool('00700', '港股')"
        ]
      },
      {
        "tool_name": "market_data_tool",
        "description": "行情数据工具，获取股票实时行情数据，包括价格、涨跌幅、成交量等",
        "function_signature": "market_data_tool(symbol: str, market: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "symbol",
            "type": "str",
            "description": "股票代码",
            "required": true
          },
          {
            "name": "market",
            "type": "Optional[str]",
            "description": "市场类型（A股/港股/美股/auto）",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的行情数据，包含当前价、涨跌幅、成交量、52周高低点等",
        "dependencies": [
          "yfinance",
          "json",
          "datetime"
        ],
        "implementation_notes": [
          "使用yfinance获取实时行情数据",
          "自动计算涨跌额和涨跌幅",
          "提供52周高低点数据",
          "缓存行情数据15分钟",
          "支持市场状态标识（开盘/休市）"
        ],
        "error_handling": [
          "yfinance未安装：返回安装提示",
          "获取数据失败：返回详细错误信息",
          "前收盘价为0：涨跌幅设为0避免除零错误",
          "数据缺失：使用默认值0或'N/A'"
        ],
        "usage_examples": [
          "获取美股行情：market_data_tool('AAPL')",
          "获取A股行情：market_data_tool('000001.SS')"
        ]
      },
      {
        "tool_name": "financial_data_tool",
        "description": "财务数据工具，获取股票财务数据和关键指标，包括估值指标、盈利能力、财务健康度等",
        "function_signature": "financial_data_tool(symbol: str, market: Optional[str] = None) -> str",
        "parameters": [
          {
            "name": "symbol",
            "type": "str",
            "description": "股票代码",
            "required": true
          },
          {
            "name": "market",
            "type": "Optional[str]",
            "description": "市场类型（A股/港股/美股/auto）",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的财务数据，包含估值指标、盈利能力、财务健康度、成长性、股息信息、分析师评级等",
        "dependencies": [
          "yfinance",
          "json",
          "datetime"
        ],
        "implementation_notes": [
          "使用yfinance获取详细财务数据",
          "分类组织数据：估值指标、盈利能力、财务健康、成长性、股息、分析师评级",
          "提供格式化的营收和净利润数据",
          "缓存财务数据7天（财务数据更新频率低）",
          "包含分析师目标价和评级建议"
        ],
        "error_handling": [
          "yfinance未安装：返回安装提示",
          "获取数据失败：返回详细错误信息",
          "数据缺失：使用'N/A'填充缺失字段",
          "财报期信息缺失：标注为'N/A'"
        ],
        "usage_examples": [
          "获取美股财务数据：financial_data_tool('AAPL')",
          "获取A股财务数据：financial_data_tool('000001.SS')"
        ]
      },
      {
        "tool_name": "news_collection_tool",
        "description": "新闻收集工具，收集股票相关的新闻资讯，整合Yahoo Finance和DuckDuckGo两个数据源",
        "function_signature": "news_collection_tool(symbol: str, company_name: Optional[str] = None, max_results: int = 10, days: int = 7) -> str",
        "parameters": [
          {
            "name": "symbol",
            "type": "str",
            "description": "股票代码",
            "required": true
          },
          {
            "name": "company_name",
            "type": "Optional[str]",
            "description": "公司名称（可选，用于增强搜索）",
            "required": false
          },
          {
            "name": "max_results",
            "type": "int",
            "description": "最大新闻数量",
            "required": false
          },
          {
            "name": "days",
            "type": "int",
            "description": "收集最近几天的新闻",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "JSON格式的新闻列表，包含标题、来源、链接、发布时间等",
        "dependencies": [
          "yfinance",
          "duckduckgo-search",
          "json",
          "datetime"
        ],
        "implementation_notes": [
          "优先使用yfinance获取官方新闻",
          "使用DuckDuckGo补充更多新闻来源",
          "自动去重和按时间排序",
          "缓存新闻数据1小时",
          "支持公司名称增强搜索"
        ],
        "error_handling": [
          "数据源不可用：尝试其他数据源",
          "搜索失败：记录错误并继续处理",
          "新闻数量不足：返回可用的新闻",
          "时间格式异常：使用'N/A'标注"
        ],
        "usage_examples": [
          "收集苹果新闻：news_collection_tool('AAPL', 'Apple Inc.', 10, 7)",
          "收集A股新闻：news_collection_tool('000001.SS', '平安银行')"
        ]
      }
    ],
    "code_quality": {
      "code_standards": [
        "遵循PEP 8代码规范",
        "使用完整的类型注解（typing模块）",
        "提供详细的函数文档字符串",
        "统一的错误处理模式",
        "清晰的代码注释"
      ],
      "testing_strategy": [
        "单元测试：测试每个工具的基本功能",
        "集成测试：测试工具之间的协作",
        "异常测试：测试各种错误场景的处理",
        "性能测试：验证缓存机制的有效性",
        "数据验证：确保返回数据的准确性"
      ],
      "performance_considerations": [
        "实现智能缓存减少API调用",
        "差异化缓存策略优化数据时效性",
        "使用MD5哈希提高缓存键查找效率",
        "自动清理过期缓存释放存储空间",
        "支持并行数据收集（Agent层面）"
      ],
      "security_measures": [
        "不在代码中硬编码API密钥",
        "使用环境变量管理敏感配置",
        "输入验证防止注入攻击",
        "错误信息不泄露敏感数据",
        "缓存文件权限控制"
      ]
    },
    "integration_details": {
      "aws_services": [],
      "external_libraries": [
        "yfinance - Yahoo Finance数据获取",
        "duckduckgo-search - DuckDuckGo搜索API",
        "strands - Strands框架核心"
      ],
      "api_endpoints": [
        "Yahoo Finance API（通过yfinance）",
        "DuckDuckGo News API（通过duckduckgo-search）"
      ],
      "data_formats": [
        "JSON - 所有工具的输入输出格式",
        "ISO 8601 - 时间戳格式",
        "UTF-8 - 文本编码"
      ]
    },
    "development_notes": "工具开发完成，实现了五个核心工具：\n\n1. **cache_manager_tool**：完善的缓存管理系统，支持set/get/delete/clear/stats操作，使用文件系统存储，自动处理过期。\n\n2. **stock_query_tool**：股票查询和基本信息获取，支持多市场（A股/港股/美股），自动规范化股票代码，提供完整的公司基本信息。\n\n3. **market_data_tool**：实时行情数据获取，包含价格、涨跌幅、成交量、52周高低点等，自动计算涨跌幅百分比。\n\n4. **financial_data_tool**：详细的财务数据和关键指标，分类组织为估值指标、盈利能力、财务健康、成长性、股息信息、分析师评级六大类。\n\n5. **news_collection_tool**：整合Yahoo Finance和DuckDuckGo两个数据源，提供全面的新闻收集，自动去重和排序。\n\n**关键特性**：\n- 所有工具返回统一的JSON格式\n- 完善的错误处理和降级策略\n- 智能缓存系统（差异化TTL策略）\n- 多数据源支持提高可靠性\n- 支持多市场股票代码规范化\n\n**依赖包**：\n- yfinance：主要股票数据源\n- duckduckgo-search：新闻搜索\n- strands：框架核心（@tool装饰器）\n\n**注意事项**：\n- 需要安装yfinance和duckduckgo-search包\n- 缓存目录默认为.cache/stock_information_collector\n- 所有工具都支持缓存，减少API调用\n- 错误处理确保部分数据源失效时系统仍能工作"
  }
}