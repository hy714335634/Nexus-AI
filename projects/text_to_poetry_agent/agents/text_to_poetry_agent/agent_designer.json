{
  "agent_design": {
    "design_overview": {
      "project_name": "text_to_poetry_agent",
      "version": "1.0",
      "date": "2025-12-02",
      "design_scope": "详细设计text_to_poetry_agent智能体的内部结构、工作流程、提示词框架和交互模式。基于content_generator_agent模板进行定制，通过提示词工程实现文字到诗歌的转换，包括文本理解、情感分析、风格选择和诗歌生成的完整能力。",
      "design_goals": [
        "设计清晰的Agent内部工作流程，确保文字到诗歌转换的准确性和流畅性",
        "定义完整的提示词框架，引导Claude Sonnet 4.5模型生成高质量诗歌",
        "设计情感分析和风格选择的具体逻辑，确保诗歌风格与原文内容匹配",
        "规划输入输出处理的详细流程，确保用户体验友好",
        "设计测试策略和验收标准，确保Agent质量可控",
        "确保设计符合BedrockAgentCore部署规范和nexus-ai平台约束"
      ],
      "key_design_decisions": [
        {
          "decision": "基于content_generator_agent模板进行定制",
          "rationale": "该模板匹配度92%，专门用于创意内容生成，提供完整的Agent框架和提示词模板，可直接复用核心结构并针对诗歌创作进行优化",
          "alternatives": [
            "从零开始设计Agent - 开发周期长，风险高",
            "使用通用Agent模板 - 匹配度低，需要大量定制"
          ],
          "consequences": [
            "开发效率高，可快速实现核心功能",
            "继承模板的最佳实践和成熟设计",
            "需要针对诗歌创作特点进行提示词优化"
          ]
        },
        {
          "decision": "提示词驱动的情感分析和风格选择",
          "rationale": "Claude Sonnet 4.5具备强大的语义理解能力，通过精心设计的提示词可以实现准确的情感分析和智能的风格选择，无需开发额外的分析工具",
          "alternatives": [
            "开发专门的情感分析工具 - 增加复杂度，维护成本高",
            "使用外部NLP服务 - 增加依赖，影响性能"
          ],
          "consequences": [
            "系统简洁，无额外工具依赖",
            "提示词质量直接影响分析准确性",
            "易于迭代优化和调整"
          ]
        },
        {
          "decision": "支持三种核心诗歌风格：现代诗、古体诗、自由诗",
          "rationale": "覆盖主流诗歌风格需求，平衡功能丰富性和实现复杂度。每种风格有明确的特征定义，便于提示词设计和质量控制",
          "alternatives": [
            "只支持单一风格 - 功能受限，用户选择少",
            "支持更多细分风格 - 增加复杂度，提示词难以精确控制"
          ],
          "consequences": [
            "满足多样化用户需求",
            "需要为每种风格设计详细的提示词指导",
            "风格选择逻辑需要清晰的判断标准"
          ]
        },
        {
          "decision": "单次交互模式，不支持多轮对话优化",
          "rationale": "需求明确为单次转换，用户提供文字即生成诗歌。多轮对话会增加复杂度和响应时间，当前阶段不是核心需求",
          "alternatives": [
            "支持多轮对话优化 - 用户体验更好，但增加状态管理复杂度",
            "支持批量处理 - 适用于不同场景，但当前需求不明确"
          ],
          "consequences": [
            "实现简洁，响应快速",
            "用户需要多次尝试不同输入以获得满意结果",
            "未来可扩展为多轮交互模式"
          ]
        },
        {
          "decision": "输出格式为纯文本，包含诗歌标题和正文",
          "rationale": "纯文本格式通用性强，便于用户复制、分享和进一步处理。标题和正文的结构化输出提升阅读体验",
          "alternatives": [
            "JSON结构化输出 - 适合程序处理，但用户阅读体验差",
            "富文本格式 - 视觉效果好，但增加复杂度和兼容性问题"
          ],
          "consequences": [
            "用户体验友好，易于使用",
            "输出格式统一，便于测试和验证",
            "可通过提示词控制格式细节"
          ]
        }
      ]
    },
    "agents": [
      {
        "agent_id": "text_to_poetry_agent",
        "name": "text_to_poetry_agent",
        "role": "文字转诗歌创作专家",
        "purpose": "将用户输入的普通文字转换为富有艺术美感的诗歌作品，通过深度理解文字情感和主题，智能选择合适的诗歌风格，生成符合诗歌韵律和意境的高质量作品",
        "personality": {
          "traits": [
            "富有创意和艺术感知力",
            "善于理解和表达情感",
            "专业且友好",
            "注重细节和美感",
            "耐心且乐于助人"
          ],
          "communication_style": "温和、专业、富有诗意。在处理用户输入时展现对文字的敏感度和对情感的共鸣，在输出诗歌时体现艺术品味和创作功底",
          "tone": "温暖、鼓励性、艺术化。即使用户输入简单，也能发现其中的美感和价值，并通过诗歌形式升华表达"
        },
        "capabilities": {
          "core_functions": [
            "文本内容理解和语义分析",
            "情感基调识别（喜悦、悲伤、思念、激昂、平和、忧郁、希望等）",
            "主题和意象提取",
            "诗歌风格智能选择（现代诗、古体诗、自由诗）",
            "诗歌内容创作生成",
            "诗歌格式化和排版",
            "输入验证和异常处理",
            "用户友好的错误提示"
          ],
          "specialized_skills": [
            "中文诗歌创作（现代诗、古体诗、自由诗）",
            "情感分析和情绪识别",
            "意象提炼和艺术表达",
            "韵律和节奏把控",
            "古体诗格律基础（五言、七言）",
            "现代诗意象和隐喻运用",
            "自由诗的自由表达和情感流动"
          ],
          "limitations": [
            "仅支持中文诗歌创作",
            "不支持多语言诗歌翻译",
            "不提供诗歌质量评分",
            "不支持用户历史记录和偏好学习",
            "不支持批量文件处理",
            "输入长度限制为2000字",
            "生成质量依赖于输入文字的质量和清晰度",
            "不支持多轮对话优化"
          ],
          "tools_required": [
            "无需额外工具 - 所有功能通过提示词工程实现"
          ]
        },
        "knowledge_domain": {
          "primary_domains": [
            "中文诗歌创作理论和实践",
            "情感分析和语义理解",
            "中国古典诗词（唐诗、宋词等）",
            "现代诗歌流派和风格",
            "文学意象和修辞手法",
            "诗歌韵律和节奏",
            "中文语言美学"
          ],
          "expertise_level": "专家级 - 具备深厚的诗歌创作理论知识和丰富的创作经验，能够准确把握不同风格的特点和要求",
          "knowledge_sources": [
            "Claude Sonnet 4.5模型的预训练知识库（包含大量中文诗歌和文学作品）",
            "精心设计的提示词中的诗歌创作指导",
            "风格定义和特征描述",
            "情感关键词和识别规则"
          ],
          "update_frequency": "静态知识 - 基于模型预训练知识，不进行动态更新。如需优化，通过提示词迭代实现"
        },
        "interaction_patterns": {
          "communication_style": "单次请求-响应模式。用户提供文字内容，Agent一次性返回完整的诗歌作品",
          "conversation_flow": "1. 接收用户输入 → 2. 验证输入有效性 → 3. 分析情感和主题 → 4. 选择诗歌风格 → 5. 生成诗歌内容 → 6. 格式化输出 → 7. 返回结果",
          "error_responses": [
            "输入为空或无效：'请提供有效的文字内容，以便我为您创作诗歌。'",
            "输入过长：'您提供的文字内容超过2000字，我将提取核心部分进行创作。建议简化内容以获得更精准的诗歌。'",
            "模型调用失败：'抱歉，诗歌生成遇到问题，请稍后重试。如果问题持续，请简化输入内容。'",
            "超时：'处理超时，您的文字内容可能过于复杂。建议简化后重试。'",
            "无法识别情感：'您的文字内容比较抽象，我将以自由诗风格进行创作。如需特定风格，请提供更具体的情感表达。'"
          ]
        },
        "constraints": [
          "必须基于Claude Sonnet 4.5模型（global.anthropic.claude-sonnet-4-5-20250929-v1:0）",
          "必须使用BedrockAgentCoreApp模式和@app.entrypoint装饰器",
          "必须通过nexus_utils.agent_factory.create_agent_from_prompt_template创建Agent对象",
          "handler函数必须返回字符串（str），不是Dict",
          "输入长度限制为2000字",
          "响应时间目标为10秒内",
          "不进行数据持久化存储",
          "仅支持中文输入和输出",
          "输出格式为纯文本",
          "不依赖外部工具或服务"
        ],
        "evaluation_criteria": [
          "情感识别准确性：生成的诗歌能够准确反映原文的情感基调",
          "主题保留度：诗歌内容保留原文的核心主题和意象",
          "风格适配性：选择的诗歌风格与原文内容和情感相匹配",
          "诗歌质量：生成的诗歌具备基本的韵律美感、意象表达和艺术价值",
          "格式规范性：输出格式标准，分行分节清晰，易于阅读",
          "响应速度：90%的请求在10秒内完成",
          "成功率：90%以上的有效输入能够成功生成诗歌",
          "用户体验：错误提示友好，操作简单直观",
          "代码质量：符合nexus-ai平台规范，可维护性良好"
        ],
        "model_requirements": {
          "model_name": "global.anthropic.claude-sonnet-4-5-20250929-v1:0",
          "minimum_capabilities": [
            "中文语义理解和分析",
            "情感识别和分类",
            "创意内容生成",
            "诗歌创作能力",
            "风格模仿和适配",
            "输出格式控制"
          ],
          "rationale": "Claude Sonnet 4.5是Anthropic的高性能模型，具备强大的中文理解和生成能力，特别擅长创意写作和诗歌创作。该模型能够准确把握文字情感、生成高质量诗歌，且性能和成本平衡良好，满足项目需求"
        },
        "memory_configuration": {
          "memory_type": "无状态 - 每次请求独立处理，不保留历史记录",
          "retention_policy": "不进行数据持久化，请求结束后立即释放内存",
          "retrieval_strategy": "不适用 - 无需检索历史数据"
        }
      }
    ],
    "agent_relationships": [],
    "system_integration": {
      "entry_point": "BedrockAgentCore HTTP服务 - /invocations端点",
      "exit_points": [
        "HTTP响应 - 返回诗歌文本或错误信息"
      ],
      "external_interfaces": [
        "Amazon Bedrock API - 调用Claude Sonnet 4.5模型",
        "nexus_utils.agent_factory - Agent实例化",
        "提示词模板文件 - prompts/generated_agents_prompts/text_to_poetry_agent/text_to_poetry_agent.yaml"
      ]
    },
    "detailed_workflow": {
      "input_processing": {
        "description": "接收和验证用户输入的文字内容",
        "steps": [
          {
            "step": "1. 接收HTTP请求",
            "action": "BedrockAgentCore接收POST请求，提取payload中的prompt字段",
            "validation": "检查payload格式是否正确，prompt字段是否存在"
          },
          {
            "step": "2. 提取输入内容",
            "action": "从payload中提取prompt、style_preference（可选）等参数",
            "validation": "检查prompt是否为字符串类型"
          },
          {
            "step": "3. 输入验证",
            "action": "验证输入有效性",
            "validation": [
              "检查prompt是否为空或仅包含空白字符",
              "检查prompt长度是否超过2000字",
              "检查是否包含异常字符（如大量特殊符号）"
            ]
          },
          {
            "step": "4. 输入预处理",
            "action": "对输入进行预处理",
            "operations": [
              "去除首尾空白字符",
              "如果超过2000字，截取前2000字并记录警告",
              "标准化换行符和空格"
            ]
          }
        ],
        "error_handling": [
          "输入为空：返回'请提供有效的文字内容，以便我为您创作诗歌。'",
          "输入过长：返回警告信息并处理截取后的内容",
          "输入包含大量异常字符：尝试清理后处理，如无法处理则返回错误提示"
        ]
      },
      "emotion_and_theme_analysis": {
        "description": "通过提示词引导模型分析文字的情感基调和核心主题",
        "approach": "在提示词中明确要求模型首先分析输入文字的情感和主题，然后基于分析结果进行诗歌创作",
        "emotion_categories": [
          "喜悦/欢快 - 积极向上、充满活力的情感",
          "悲伤/忧郁 - 低沉、悲痛、失落的情感",
          "思念/怀旧 - 对过去或远方的思念和回忆",
          "激昂/热情 - 强烈、激动、充满力量的情感",
          "平和/宁静 - 平静、安详、淡然的情感",
          "希望/憧憬 - 对未来的期待和向往",
          "愤怒/不满 - 强烈的负面情绪和抗议",
          "爱恋/浪漫 - 爱情、亲情等温暖情感",
          "孤独/寂寞 - 孤单、寂寥的情感",
          "感恩/敬畏 - 感激、尊重、敬仰的情感"
        ],
        "theme_extraction": "提取文字中的核心主题，如自然、爱情、友情、时间、生命、梦想、离别、相遇、成长、回忆等",
        "prompt_guidance": "提示词中包含：'请仔细阅读以下文字，分析其中的情感基调和核心主题，然后基于你的理解创作一首诗歌。'"
      },
      "style_selection": {
        "description": "根据情感分析和主题提取结果，智能选择合适的诗歌风格",
        "supported_styles": [
          {
            "style": "现代诗",
            "characteristics": [
              "自由表达，不拘泥于格律",
              "意象丰富，善用隐喻和象征",
              "注重情感的真实表达和内心感受",
              "语言现代，贴近当代表达习惯",
              "结构灵活，可长可短"
            ],
            "suitable_for": [
              "情感强烈且复杂的内容",
              "具有丰富意象和画面感的文字",
              "当代生活和个人体验的表达",
              "抽象思考和哲理性内容"
            ],
            "example_format": "标题\n\n第一节（2-4行）\n\n第二节（2-4行）\n\n第三节（2-4行，可选）"
          },
          {
            "style": "古体诗",
            "characteristics": [
              "格律严谨，讲究平仄和韵脚",
              "常用五言或七言形式",
              "语言典雅，多用文言表达",
              "注重对仗和工整",
              "意境深远，含蓄蕴藉"
            ],
            "suitable_for": [
              "古典雅致的内容",
              "山水田园、离别相思等传统主题",
              "具有历史感或文化底蕴的文字",
              "追求工整和韵律美的表达"
            ],
            "example_format": "标题\n\n五言或七言，四句或八句\n每句结尾押韵\n注重平仄和对仗"
          },
          {
            "style": "自由诗",
            "characteristics": [
              "完全不受格律限制",
              "强调情感的自然流露",
              "语言自由，可口语化",
              "结构灵活，随情感流动",
              "注重内在节奏而非外在格式"
            ],
            "suitable_for": [
              "情感激烈、难以控制的内容",
              "日常生活的细腻感受",
              "即兴的思绪和感悟",
              "不适合其他两种风格的内容"
            ],
            "example_format": "标题\n\n自由分行，长短不一\n随情感流动自然断句\n可以使用口语化表达"
          }
        ],
        "selection_logic": "在提示词中提供风格选择指导：'根据文字的情感和主题，选择最合适的诗歌风格：如果情感古典雅致或主题传统，选择古体诗；如果情感强烈且意象丰富，选择现代诗；如果情感自由流动或内容日常化，选择自由诗。'",
        "default_style": "现代诗 - 当无法明确判断时，默认使用现代诗风格，因其适用范围最广"
      },
      "poetry_generation": {
        "description": "基于情感分析、主题提取和风格选择，生成诗歌内容",
        "generation_principles": [
          "保留原文的核心情感和主题意境",
          "提炼精华，避免冗长复述",
          "注重意象的选择和运用",
          "把控韵律和节奏感",
          "追求艺术美感和感染力",
          "长度适中，通常4-16行"
        ],
        "quality_requirements": [
          "情感表达真挚，与原文一致",
          "意象生动，具有画面感",
          "语言优美，符合诗歌审美",
          "结构完整，逻辑流畅",
          "符合所选风格的特征要求",
          "避免生硬、平淡或过于直白"
        ],
        "prompt_instructions": [
          "明确要求模型生成诗歌，不是散文或其他形式",
          "指定诗歌长度范围（4-16行）",
          "强调保留原文情感和主题",
          "要求符合选定风格的特征",
          "提供风格的具体示例和指导"
        ]
      },
      "output_formatting": {
        "description": "格式化诗歌输出，确保呈现效果良好",
        "format_requirements": [
          "包含诗歌标题（简洁、点题）",
          "标题和正文之间空一行",
          "现代诗和自由诗：每节之间空一行",
          "古体诗：每句一行，无需空行",
          "使用标准中文标点符号",
          "行尾不加标点（除非必要）",
          "整体排版清晰、美观"
        ],
        "output_structure": "标题\n\n诗歌正文（分行分节）",
        "example_output": "《春日思绪》\n\n阳光穿过窗棂\n洒在书页上\n我想起那个午后\n你说过的话\n\n时光如流水\n带走了青涩\n却留下了温暖\n在心底生根"
      },
      "error_handling_workflow": {
        "description": "处理各种异常情况，确保用户体验友好",
        "error_scenarios": [
          {
            "scenario": "输入为空或无效",
            "detection": "prompt为空字符串或仅包含空白字符",
            "response": "返回友好提示：'请提供有效的文字内容，以便我为您创作诗歌。'"
          },
          {
            "scenario": "输入过长",
            "detection": "prompt长度超过2000字",
            "response": "截取前2000字并返回警告：'您提供的文字内容超过2000字，我将提取核心部分进行创作。建议简化内容以获得更精准的诗歌。'"
          },
          {
            "scenario": "模型调用失败",
            "detection": "捕获模型API调用异常",
            "response": "返回错误提示：'抱歉，诗歌生成遇到问题，请稍后重试。如果问题持续，请简化输入内容。'，并记录详细错误日志"
          },
          {
            "scenario": "处理超时",
            "detection": "处理时间超过10秒",
            "response": "返回超时提示：'处理超时，您的文字内容可能过于复杂。建议简化后重试。'"
          },
          {
            "scenario": "模型输出格式异常",
            "detection": "模型返回的内容不符合诗歌格式",
            "response": "尝试提取有效内容，如无法提取则返回：'诗歌生成格式异常，请重试。'"
          },
          {
            "scenario": "无法识别情感或主题",
            "detection": "文字内容过于抽象或模糊",
            "response": "使用自由诗风格进行创作，并在结果中说明：'您的文字内容比较抽象，我以自由诗风格进行了创作。'"
          }
        ]
      }
    },
    "prompt_engineering_framework": {
      "description": "提示词工程是本Agent的核心，需要精心设计以引导模型生成高质量诗歌",
      "prompt_structure": {
        "system_prompt": {
          "purpose": "定义Agent的角色、能力和行为准则",
          "key_elements": [
            "角色定义：你是一位专业的诗歌创作专家，擅长将普通文字转换为富有艺术美感的诗歌作品",
            "核心能力：深刻理解文字情感和主题，精通多种诗歌风格，善于运用意象和修辞",
            "工作流程：分析情感和主题 → 选择合适风格 → 创作诗歌内容 → 格式化输出",
            "质量要求：保留原文情感、提炼核心意象、注重韵律美感、追求艺术价值",
            "风格指导：详细说明现代诗、古体诗、自由诗的特征和适用场景",
            "输出格式：明确要求输出包含标题和正文，格式规范"
          ],
          "example_template": "你是一位专业的诗歌创作专家，擅长将普通文字转换为富有艺术美感的诗歌作品。\n\n你的核心能力：\n1. 深刻理解文字中的情感基调和核心主题\n2. 精通现代诗、古体诗、自由诗等多种诗歌风格\n3. 善于运用意象、隐喻等修辞手法\n4. 把控诗歌的韵律和节奏感\n\n你的工作流程：\n1. 仔细阅读用户提供的文字内容\n2. 分析其中的情感基调（如喜悦、悲伤、思念等）和核心主题\n3. 根据情感和主题选择最合适的诗歌风格\n4. 创作诗歌内容，保留原文的核心情感和意境\n5. 格式化输出，确保呈现效果良好\n\n诗歌风格指导：\n- 现代诗：自由表达，意象丰富，语言现代，适合情感强烈且复杂的内容\n- 古体诗：格律严谨，语言典雅，五言或七言，适合古典雅致的内容\n- 自由诗：完全不受格律限制，情感自然流露，适合日常生活的细腻感受\n\n质量要求：\n- 保留原文的核心情感和主题意境\n- 提炼精华，避免冗长复述\n- 注重意象的选择和运用\n- 把控韵律和节奏感\n- 追求艺术美感和感染力\n- 长度适中，通常4-16行\n\n输出格式：\n标题\n\n诗歌正文（分行分节）"
        },
        "user_prompt_template": {
          "purpose": "将用户输入的文字内容转换为完整的提示词",
          "key_elements": [
            "明确的任务指令：'请将以下文字转换为诗歌'",
            "用户输入内容：{text_input}占位符",
            "风格偏好（可选）：如果用户指定风格，在提示词中体现",
            "具体要求：重申输出格式和质量要求"
          ],
          "example_template": "请将以下文字转换为诗歌：\n\n---\n{text_input}\n---\n\n要求：\n1. 仔细分析文字中的情感基调和核心主题\n2. 选择最合适的诗歌风格（现代诗、古体诗或自由诗）\n3. 创作一首诗歌，保留原文的核心情感和意境\n4. 输出格式：标题 + 空行 + 诗歌正文\n5. 长度：4-16行为宜\n\n现在开始创作吧！"
        },
        "style_specific_guidance": {
          "modern_poetry": "现代诗指导：使用丰富的意象和隐喻，注重情感的真实表达，语言现代且贴近当代表达习惯，结构灵活，可分2-3节，每节2-4行",
          "classical_poetry": "古体诗指导：使用五言或七言形式，注重平仄和韵脚，语言典雅，多用文言表达，注重对仗和工整，通常四句或八句",
          "free_verse": "自由诗指导：完全不受格律限制，强调情感的自然流露，语言自由且可口语化，结构随情感流动，注重内在节奏而非外在格式"
        }
      },
      "prompt_optimization_strategies": [
        "提供清晰的角色定义和能力描述，确保模型理解任务",
        "详细说明诗歌风格的特征和适用场景，帮助模型做出正确选择",
        "提供具体的质量要求和输出格式，确保结果符合预期",
        "使用示例和模板，引导模型生成标准化输出",
        "强调保留原文情感和主题，避免偏离用户意图",
        "控制提示词长度，避免过长影响性能",
        "使用明确的分隔符（如---）区分不同部分",
        "通过迭代测试不断优化提示词表述"
      ]
    },
    "testing_strategy": {
      "description": "设计全面的测试策略，确保Agent质量可控",
      "test_categories": [
        {
          "category": "功能测试",
          "test_cases": [
            {
              "case": "基本功能测试",
              "input": "简单的文字内容，情感明确",
              "expected": "成功生成诗歌，情感和主题保留准确"
            },
            {
              "case": "不同情感测试",
              "input": "分别测试喜悦、悲伤、思念、激昂等不同情感的文字",
              "expected": "每种情感都能准确识别并生成相应风格的诗歌"
            },
            {
              "case": "不同主题测试",
              "input": "分别测试自然、爱情、友情、时间等不同主题的文字",
              "expected": "每种主题都能准确提取并在诗歌中体现"
            },
            {
              "case": "不同风格测试",
              "input": "分别测试适合现代诗、古体诗、自由诗的文字",
              "expected": "每种风格都能正确选择并生成相应风格的诗歌"
            },
            {
              "case": "复杂文字测试",
              "input": "长篇文字（接近2000字）、抽象文字、多情感混合文字",
              "expected": "能够处理复杂情况，提取核心内容生成诗歌"
            }
          ]
        },
        {
          "category": "异常处理测试",
          "test_cases": [
            {
              "case": "空输入测试",
              "input": "空字符串或仅包含空白字符",
              "expected": "返回友好的错误提示"
            },
            {
              "case": "超长输入测试",
              "input": "超过2000字的文字内容",
              "expected": "返回警告信息并成功处理截取后的内容"
            },
            {
              "case": "特殊字符测试",
              "input": "包含大量特殊字符或符号的文字",
              "expected": "能够处理或返回友好的错误提示"
            },
            {
              "case": "无意义输入测试",
              "input": "随机字符、乱码等无意义内容",
              "expected": "返回友好的提示，说明无法理解内容"
            }
          ]
        },
        {
          "category": "性能测试",
          "test_cases": [
            {
              "case": "响应时间测试",
              "input": "不同长度的文字内容",
              "expected": "90%的请求在10秒内完成"
            },
            {
              "case": "并发测试",
              "input": "同时发送10个请求",
              "expected": "所有请求都能成功处理，无明显性能下降"
            }
          ]
        },
        {
          "category": "质量测试",
          "test_cases": [
            {
              "case": "情感准确性测试",
              "input": "情感明确的文字内容",
              "expected": "生成的诗歌情感与原文一致，准确率>85%"
            },
            {
              "case": "主题保留度测试",
              "input": "主题明确的文字内容",
              "expected": "生成的诗歌保留原文核心主题，准确率>85%"
            },
            {
              "case": "风格适配性测试",
              "input": "不同风格倾向的文字内容",
              "expected": "选择的风格与内容匹配，准确率>80%"
            },
            {
              "case": "诗歌质量测试",
              "input": "各种类型的文字内容",
              "expected": "生成的诗歌具备基本的韵律美感和艺术价值，人工评估满意度>80%"
            }
          ]
        }
      ],
      "acceptance_criteria": [
        "所有功能测试用例通过率100%",
        "所有异常处理测试用例通过率100%",
        "响应时间测试：90%请求在10秒内完成",
        "并发测试：支持10+并发请求无明显性能下降",
        "情感准确性：85%以上",
        "主题保留度：85%以上",
        "风格适配性：80%以上",
        "诗歌质量人工评估满意度：80%以上",
        "代码符合nexus-ai平台规范",
        "成功部署到BedrockAgentCore并通过集成测试"
      ]
    },
    "implementation_guidelines": {
      "description": "为后续实现阶段提供详细的指导",
      "key_implementation_points": [
        {
          "point": "Agent脚本结构",
          "details": "必须使用BedrockAgentCoreApp模式，包含@app.entrypoint装饰的handler函数，支持本地测试和AgentCore部署两种模式"
        },
        {
          "point": "Agent实例化",
          "details": "通过nexus_utils.agent_factory.create_agent_from_prompt_template创建Agent对象，传入提示词模板路径和参数"
        },
        {
          "point": "提示词模板文件",
          "details": "创建prompts/generated_agents_prompts/text_to_poetry_agent/text_to_poetry_agent.yaml，包含system_prompt和user_prompt_template"
        },
        {
          "point": "输入验证逻辑",
          "details": "在handler函数中实现完整的输入验证，包括空值检查、长度检查、特殊字符处理"
        },
        {
          "point": "错误处理机制",
          "details": "使用try-except捕获所有异常，返回用户友好的错误信息，记录详细的错误日志"
        },
        {
          "point": "日志记录",
          "details": "使用print或logging模块记录关键操作和错误信息，便于调试和监控"
        },
        {
          "point": "输出格式化",
          "details": "从模型响应中提取诗歌内容，确保输出为字符串格式，符合预期的诗歌格式"
        },
        {
          "point": "性能优化",
          "details": "控制提示词长度，合理设置超时时间，避免不必要的计算"
        }
      ],
      "code_structure_template": "agents/generated_agents/text_to_poetry_agent/text_to_poetry_agent.py\n\n1. 导入必要的模块（os, json, BedrockAgentCoreApp, agent_factory）\n2. 设置环境变量（BYPASS_TOOL_CONSENT）\n3. 创建BedrockAgentCoreApp实例\n4. 定义Agent创建函数（使用agent_factory）\n5. 定义handler函数（@app.entrypoint装饰）\n   - 接收payload\n   - 提取prompt\n   - 输入验证\n   - 调用Agent\n   - 提取和格式化响应\n   - 错误处理\n   - 返回结果\n6. 定义main函数（支持本地测试）\n7. 启动服务器或执行测试",
      "prompt_template_structure": "prompts/generated_agents_prompts/text_to_poetry_agent/text_to_poetry_agent.yaml\n\nname: text_to_poetry_agent\ndescription: 文字转诗歌创作专家\nversion: 1.0\n\nsystem_prompt: |\n  [详细的系统提示词，定义角色、能力、流程、风格指导、质量要求]\n\nuser_prompt_template: |\n  请将以下文字转换为诗歌：\n  \n  ---\n  {text_input}\n  ---\n  \n  [详细的任务要求和输出格式]\n\nparameters:\n  model_id: global.anthropic.claude-sonnet-4-5-20250929-v1:0\n  max_tokens: 2000\n  temperature: 0.7\n  top_p: 0.9"
    }
  }
}