{
  "agent_code_development": {
    "development_overview": {
      "project_name": "aws_network_topology_analyzer",
      "version": "1.0",
      "date": "2025-11-11",
      "development_scope": "开发AWS网络拓扑分析Agent，用于扫描AWS账号中的网络资源，构建网络拓扑关系图，并通过自然语言交互帮助用户理解网络结构、诊断问题和进行安全分析",
      "design_principles": [
        "模块化设计，分离关注点",
        "可扩展性，支持添加新的资源类型和查询功能",
        "容错性，处理API错误和数据不一致",
        "可观测性，提供详细的操作日志",
        "安全性，不存储敏感凭证"
      ],
      "key_decisions": [
        "使用AWSNetworkTopologyAnalyzer类封装Agent功能，提供便捷的方法接口",
        "实现命令行界面，支持多种操作模式",
        "添加交互模式，方便用户进行连续操作",
        "使用Strands遥测功能，提高可观测性",
        "使用默认参数简化配置"
      ]
    },
    "agent_implementation": {
      "agent_name": "aws_network_topology_analyzer",
      "file_path": "agents/generated_agents/aws_network_topology_analyzer/aws_network_topology_analyzer.py",
      "main_class": "AWSNetworkTopologyAnalyzer",
      "entry_point": "if __name__ == \"__main__\"",
      "dependencies": [
        "nexus_utils.agent_factory",
        "strands.telemetry",
        "logging",
        "argparse",
        "os",
        "json"
      ],
      "imports": [
        "from nexus_utils.agent_factory import create_agent_from_prompt_template",
        "from strands.telemetry import StrandsTelemetry",
        "import os",
        "import json",
        "import logging",
        "import argparse",
        "from typing import Dict, List, Optional, Any, Union"
      ]
    },
    "core_functions": [
      {
        "function_name": "scan_resources",
        "purpose": "扫描AWS资源并存储到Neo4j数据库",
        "parameters": [
          {
            "name": "profile_name",
            "type": "str",
            "description": "AWS配置文件名称",
            "required": true
          },
          {
            "name": "region",
            "type": "str",
            "description": "AWS区域",
            "required": true
          },
          {
            "name": "resource_types",
            "type": "Optional[List[str]]",
            "description": "要扫描的资源类型列表，如果为None则扫描所有网络资源",
            "required": false
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含AWS配置和Neo4j配置的提示词",
          "调用Agent执行扫描操作",
          "处理可能的异常并记录日志"
        ]
      },
      {
        "function_name": "query_topology",
        "purpose": "通过自然语言查询网络拓扑",
        "parameters": [
          {
            "name": "query",
            "type": "str",
            "description": "自然语言查询",
            "required": true
          },
          {
            "name": "profile_name",
            "type": "Optional[str]",
            "description": "AWS配置文件名称（可选）",
            "required": false
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含查询和Neo4j配置的提示词",
          "调用Agent执行查询操作",
          "处理可能的异常并记录日志"
        ]
      },
      {
        "function_name": "analyze_path",
        "purpose": "分析两个资源之间的网络路径",
        "parameters": [
          {
            "name": "source",
            "type": "str",
            "description": "源资源ID或名称",
            "required": true
          },
          {
            "name": "destination",
            "type": "str",
            "description": "目标资源ID或名称",
            "required": true
          },
          {
            "name": "profile_name",
            "type": "Optional[str]",
            "description": "AWS配置文件名称（可选）",
            "required": false
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含源目标资源和Neo4j配置的提示词",
          "调用Agent执行路径分析操作",
          "处理可能的异常并记录日志"
        ]
      },
      {
        "function_name": "visualize_topology",
        "purpose": "可视化网络拓扑",
        "parameters": [
          {
            "name": "scope",
            "type": "str",
            "description": "可视化范围，可选值: all, vpc, subnet",
            "required": false
          },
          {
            "name": "resource_type",
            "type": "Optional[str]",
            "description": "资源类型过滤器（可选）",
            "required": false
          },
          {
            "name": "resource_id",
            "type": "Optional[str]",
            "description": "资源ID过滤器（可选）",
            "required": false
          },
          {
            "name": "profile_name",
            "type": "Optional[str]",
            "description": "AWS配置文件名称（可选）",
            "required": false
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含可视化参数和Neo4j配置的提示词",
          "调用Agent执行可视化操作",
          "处理可能的异常并记录日志"
        ]
      },
      {
        "function_name": "analyze_security",
        "purpose": "分析网络安全配置",
        "parameters": [
          {
            "name": "resource_id",
            "type": "Optional[str]",
            "description": "资源ID（可选）",
            "required": false
          },
          {
            "name": "vpc_id",
            "type": "Optional[str]",
            "description": "VPC ID（可选）",
            "required": false
          },
          {
            "name": "profile_name",
            "type": "Optional[str]",
            "description": "AWS配置文件名称（可选）",
            "required": false
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含安全分析参数和Neo4j配置的提示词",
          "调用Agent执行安全分析操作",
          "处理可能的异常并记录日志"
        ]
      },
      {
        "function_name": "run_custom_query",
        "purpose": "执行自定义查询",
        "parameters": [
          {
            "name": "query",
            "type": "str",
            "description": "自然语言查询或Cypher查询",
            "required": true
          },
          {
            "name": "neo4j_uri",
            "type": "str",
            "description": "Neo4j数据库URI",
            "required": false
          },
          {
            "name": "neo4j_user",
            "type": "str",
            "description": "Neo4j用户名",
            "required": false
          },
          {
            "name": "neo4j_password",
            "type": "str",
            "description": "Neo4j密码",
            "required": false
          }
        ],
        "return_type": "str",
        "return_description": "Agent的响应",
        "implementation_notes": [
          "构建包含查询和Neo4j配置的提示词",
          "调用Agent执行自定义查询操作",
          "处理可能的异常并记录日志"
        ]
      }
    ],
    "tool_integration": {
      "custom_tools": [
        "aws_profile_manager",
        "aws_resource_scanner",
        "neo4j_database_connector",
        "neo4j_node_creator",
        "neo4j_edge_creator",
        "neo4j_query_executor",
        "neo4j_path_analyzer",
        "neo4j_topology_visualizer",
        "natural_language_to_cypher_converter",
        "error_analyzer_and_resolver"
      ],
      "system_tools": [
        "file_read",
        "file_write",
        "current_time",
        "calculator"
      ],
      "strands_tools": [
        "StrandsTelemetry"
      ],
      "integration_notes": [
        "使用agent_factory创建Agent，自动集成所有工具",
        "使用StrandsTelemetry进行遥测",
        "通过提示词指导Agent正确使用工具"
      ]
    },
    "configuration": {
      "environment_variables": [
        "BYPASS_TOOL_CONSENT",
        "OTEL_EXPORTER_OTLP_ENDPOINT"
      ],
      "model_configuration": {
        "model_name": "default",
        "max_tokens": 60000,
        "temperature": 0.3,
        "top_p": 0.8
      },
      "streaming_config": {
        "enabled": true,
        "chunk_size": null
      }
    },
    "error_handling": {
      "exception_types": [
        "Exception",
        "ClientError",
        "AuthError",
        "ServiceUnavailable",
        "DatabaseError"
      ],
      "error_responses": [
        "详细的错误日志记录",
        "用户友好的错误消息",
        "技术细节和恢复步骤",
        "替代查询建议"
      ],
      "recovery_strategies": [
        "捕获并记录异常",
        "提供明确的错误原因和解决建议",
        "继续扫描其他资源",
        "事务回滚和错误日志"
      ]
    },
    "testing": {
      "test_cases": [
        "AWS认证和配置管理",
        "资源扫描和数据库存储",
        "自然语言查询",
        "网络路径分析",
        "网络拓扑可视化",
        "安全配置分析",
        "自定义查询执行"
      ],
      "test_scenarios": [
        "正常扫描流程",
        "认证错误处理",
        "数据库连接错误处理",
        "复杂查询处理",
        "交互模式操作"
      ],
      "validation_criteria": [
        "扫描结果的完整性和准确性",
        "查询结果的正确性",
        "错误处理的有效性",
        "交互体验的流畅性",
        "命令行参数的正确解析"
      ]
    },
    "deployment": {
      "deployment_requirements": [
        "Python 3.13+",
        "Strands SDK",
        "AWS Boto3 SDK",
        "Neo4j Python Driver",
        "AWS Bedrock访问权限"
      ],
      "runtime_dependencies": [
        "nexus_utils",
        "strands",
        "boto3",
        "neo4j"
      ],
      "performance_considerations": [
        "批量处理API请求",
        "优化Neo4j查询",
        "缓存常用查询结果",
        "并行扫描独立资源"
      ]
    },
    "development_notes": "在开发AWS网络拓扑分析Agent时，我采用了模块化设计，将Agent功能封装在AWSNetworkTopologyAnalyzer类中，提供了多个便捷方法来执行不同类型的操作。为了提高用户体验，我实现了命令行界面，支持多种操作模式，包括扫描资源、查询拓扑、分析路径、可视化拓扑、安全分析和自定义查询。特别添加了交互模式，允许用户连续执行多个命令而无需重新启动程序。\n\n在错误处理方面，我确保了所有操作都有适当的异常捕获和日志记录，提供清晰的错误信息和恢复建议。为了提高可观测性，我集成了Strands遥测功能。\n\n代码结构清晰，使用了类型注解提高可读性，并提供了详细的文档字符串。每个方法都有明确的职责和参数说明，遵循PEP 8编码风格。\n\n在集成工具方面，我使用agent_factory创建Agent，自动集成所有必要的工具，并通过提示词指导Agent正确使用这些工具。默认参数的使用简化了配置，同时保留了灵活性，允许用户根据需要自定义参数。"
  }
}