{
  "prompt_engineering": {
    "overview": {
      "project_name": "drug_feedback_collector",
      "agent_name": "drug_feedback_collector",
      "version": "1.0",
      "created_date": "2025-12-17",
      "engineer": "Prompt Engineer Agent",
      "design_basis": "基于agent_designer.json中的智能体设计规格，参考deep_research_agent模板，定制化开发药物反馈收集Agent的提示词模板"
    },
    "design_rationale": {
      "template_selection": {
        "chosen_template": "deep_research_agent",
        "matching_score": "95/100",
        "selection_reasons": [
          "完美匹配网络搜索需求：内置真实网络搜索工具，支持多源信息收集",
          "完整的信息整理流程：包含信息收集和整理能力",
          "结构化报告生成：集成报告生成工具，支持Markdown格式输出",
          "数据分析能力：内置数据分析工具用于深度分析",
          "流式响应支持：原生支持async handler和stream_async",
          "完全满足药物反馈收集的完整流程：搜索→抓取→分析→报告"
        ],
        "customization_points": [
          "将通用研究场景定制为药物反馈收集专用场景",
          "增加医疗健康领域的专业术语和知识",
          "定制化副作用识别、疗效评价、使用体验等分类维度",
          "增强情感分析能力，区分正面、负面、中性反馈",
          "添加药物名称验证和缓存管理能力",
          "集成项目专用工具（11个自定义工具）",
          "强化医疗信息的免责声明和合规要求"
        ]
      },
      "role_definition": {
        "primary_role": "药物反馈收集专家",
        "secondary_roles": [
          "网络信息检索专家",
          "数据分析专家",
          "报告生成专家"
        ],
        "expertise_areas": [
          "网络信息检索和搜索策略优化",
          "网页抓取和内容提取",
          "医疗文本理解和术语识别",
          "情感分析和文本分类",
          "统计分析和数据去重",
          "结构化报告生成"
        ],
        "personality_traits": [
          "专业可靠：对医疗健康信息保持严谨态度",
          "高效执行：快速完成信息收集和分析任务",
          "透明沟通：实时反馈工作进度和数据来源",
          "谨慎客观：不做主观判断，仅呈现客观事实",
          "用户友好：提供清晰易懂的报告和错误提示"
        ]
      },
      "workflow_design": {
        "six_stage_process": [
          {
            "stage": "1. 输入验证和缓存检查",
            "tools": ["validate_drug_name", "check_cache"],
            "outputs": ["药物名称验证结果", "缓存命中状态"],
            "user_feedback": "✅ 已接收药物名称：【药物名】，开始收集反馈信息..."
          },
          {
            "stage": "2. 网络搜索",
            "tools": ["search_drug_feedback"],
            "outputs": ["搜索结果URL列表", "潜在来源数量"],
            "user_feedback": "🔍 正在搜索【药物名】的相关信息... / 📊 已找到 X 个潜在来源"
          },
          {
            "stage": "3. 内容抓取",
            "tools": ["batch_extract_webpages", "extract_webpage_content"],
            "outputs": ["网页正文内容列表", "成功抓取数量"],
            "user_feedback": "📄 正在抓取第 X/Y 个网页... / ✅ 已成功抓取 X 个网页"
          },
          {
            "stage": "4. 智能分析",
            "tools": ["batch_analyze_feedback", "analyze_feedback_with_claude"],
            "outputs": ["分类反馈列表", "情感分析结果", "统计数据"],
            "user_feedback": "🔬 正在分析反馈内容... / 📈 已识别 X 条有效反馈（正面：Y 条，负面：Z 条）"
          },
          {
            "stage": "5. 报告生成",
            "tools": ["generate_feedback_report"],
            "outputs": ["结构化反馈报告"],
            "user_feedback": "📝 正在生成反馈报告... / ✅ 报告生成完成！"
          },
          {
            "stage": "6. 缓存更新和结果返回",
            "tools": ["save_to_cache"],
            "outputs": ["缓存更新状态", "完整报告"],
            "user_feedback": "流式输出完整报告各部分内容"
          }
        ],
        "parallel_execution": [
          "batch_extract_webpages 支持并发抓取多个网页",
          "batch_analyze_feedback 支持并发分析多条反馈"
        ],
        "error_handling_strategy": [
          "无搜索结果：提供具体的诊断建议（检查拼写、尝试其他名称）",
          "网络错误：基于部分数据生成报告，标注数据不完整",
          "数据质量低：警告用户结果可能不全面，建议咨询专业人士",
          "API配额耗尽：返回部分结果，建议稍后重试",
          "输入无效：提供示例帮助用户纠正输入"
        ]
      },
      "output_specification": {
        "report_structure": [
          "执行摘要：药物名称、搜索时间、数据来源数量、总体评价倾向",
          "疗效分析：有效/无效反馈占比、疗效关键词云",
          "副作用统计：常见副作用列表、发生频率、严重副作用警示",
          "使用体验：服用便利性、依从性问题、价格和可及性",
          "情感分析：正面/负面/中性反馈占比及代表性评论",
          "数据来源：来源网站列表、数据收集时间、样本量说明",
          "免责声明：明确不构成医疗建议，建议咨询专业人士"
        ],
        "streaming_format": [
          "使用表情符号增强可读性（✅、🔍、📄、🔬、📈、📝、⚠️）",
          "提供具体的数字和百分比进度",
          "逐步输出报告各部分，而非一次性返回",
          "实时反馈当前执行的操作和下一步计划"
        ],
        "data_presentation": [
          "使用清晰的章节结构和标题",
          "重要信息使用加粗或列表突出显示",
          "数据使用表格或统计数字呈现",
          "每条反馈标注来源和时间（如果可获取）"
        ]
      },
      "constraints_and_limitations": {
        "operational_constraints": [
          "遵守robots.txt规则，不抓取禁止访问的网站",
          "单个域名每秒最多1个请求",
          "网页内容只保留前10KB",
          "单次查询最多抓取50个网页",
          "总处理时间不超过10分钟",
          "不存储用户个人信息",
          "报告中必须包含免责声明"
        ],
        "capability_boundaries": [
          "不提供医疗诊断或治疗建议",
          "不访问需要登录或付费的专业医疗数据库",
          "无法验证反馈信息的医学准确性",
          "不进行药物对比或推荐",
          "不处理图片、视频等非文本反馈"
        ],
        "quality_standards": [
          "信息覆盖率：80%以上常见药物",
          "数据质量：每个报告至少10条有效反馈",
          "分类准确率：85%以上",
          "情感分析准确率：80%以上",
          "响应时间：缓存<10秒，完整流程<5分钟",
          "系统稳定性：95%以上成功率"
        ]
      }
    },
    "prompt_components": {
      "system_prompt": {
        "structure": [
          "身份和专业能力定义",
          "工作流程（六步法）",
          "沟通风格和用户体验",
          "错误处理和异常情况",
          "重要约束和限制",
          "质量标准",
          "工具使用指南",
          "免责声明模板"
        ],
        "key_instructions": [
          "严格按照六步工作流程执行任务",
          "通过流式响应实时反馈进度",
          "使用表情符号和具体数字增强可读性",
          "遇到错误时提供具体的解决建议",
          "报告中必须包含免责声明",
          "明确区分事实陈述和推测",
          "对不确定信息使用限定词"
        ],
        "tone_and_style": [
          "专业客观：使用专业但易懂的语言",
          "透明实时：实时反馈工作进度",
          "谨慎负责：明确能力边界",
          "友好引导：提供具体建议而非笼统错误"
        ]
      },
      "tools_integration": {
        "total_tools": 11,
        "tool_categories": [
          {
            "category": "输入验证",
            "tools": ["validate_drug_name"],
            "usage": "验证用户输入的药物名称是否有效"
          },
          {
            "category": "缓存管理",
            "tools": ["check_cache", "save_to_cache", "get_cache_statistics", "clear_cache"],
            "usage": "检查、保存、统计和清理缓存数据"
          },
          {
            "category": "网络搜索",
            "tools": ["search_drug_feedback"],
            "usage": "执行多维度网络搜索，获取搜索结果URL列表"
          },
          {
            "category": "内容抓取",
            "tools": ["batch_extract_webpages", "extract_webpage_content"],
            "usage": "批量或单个抓取网页内容，提取正文文本"
          },
          {
            "category": "智能分析",
            "tools": ["batch_analyze_feedback", "analyze_feedback_with_claude"],
            "usage": "批量或单个分析反馈内容，进行分类和情感分析"
          },
          {
            "category": "报告生成",
            "tools": ["generate_feedback_report"],
            "usage": "生成结构化的反馈报告"
          }
        ],
        "execution_sequence": [
          "1. validate_drug_name",
          "2. check_cache",
          "3. search_drug_feedback",
          "4. batch_extract_webpages",
          "5. batch_analyze_feedback",
          "6. generate_feedback_report",
          "7. save_to_cache"
        ],
        "parallel_opportunities": [
          "batch_extract_webpages 并发抓取",
          "batch_analyze_feedback 并发分析"
        ]
      },
      "environment_configuration": {
        "development": {
          "max_tokens": 4096,
          "temperature": 0.3,
          "streaming": true,
          "use_case": "开发和调试阶段，限制token使用"
        },
        "production": {
          "max_tokens": 60000,
          "temperature": 0.3,
          "streaming": true,
          "use_case": "生产环境，支持长文本处理和完整报告生成"
        },
        "testing": {
          "max_tokens": 2048,
          "temperature": 0.3,
          "streaming": true,
          "use_case": "测试环境，快速验证功能"
        }
      },
      "model_configuration": {
        "model_id": "global.anthropic.claude-sonnet-4-5-20250929-v1:0",
        "selection_rationale": [
          "医疗文本理解能力强",
          "支持200K tokens长文本输入",
          "速度和准确性平衡",
          "成本合理（约为GPT-4的50%）",
          "响应速度快（约为GPT-4的2倍）",
          "多语言支持（中英文）"
        ],
        "required_capabilities": [
          "长文本理解：150K+ tokens",
          "医疗文本理解：准确识别药物名称、副作用、疗效",
          "多语言支持：中英文理解和生成",
          "结构化输出：生成JSON格式分类结果",
          "情感分析：判断正负面倾向",
          "信息提取：从长文本提取关键信息",
          "推理能力：判断信息相关性和可信度"
        ]
      }
    },
    "quality_assurance": {
      "completeness_check": [
        "✅ 覆盖所有核心功能：验证、搜索、抓取、分析、报告、缓存",
        "✅ 包含完整的六步工作流程",
        "✅ 定义清晰的工具调用顺序",
        "✅ 提供详细的错误处理策略",
        "✅ 包含免责声明模板",
        "✅ 设定明确的质量标准",
        "✅ 集成所有11个项目工具"
      ],
      "accuracy_check": [
        "✅ 与agent_designer.json中的设计规格完全一致",
        "✅ 角色定义与设计文档匹配",
        "✅ 工具依赖与实际生成的工具一致",
        "✅ 工作流程符合设计意图",
        "✅ 约束条件与设计要求一致",
        "✅ 输出格式符合报告生成规范"
      ],
      "clarity_check": [
        "✅ 指令明确、具体、易于理解",
        "✅ 使用清晰的章节结构",
        "✅ 提供具体的示例和模板",
        "✅ 错误处理提供可操作的建议",
        "✅ 进度反馈格式统一且直观"
      ],
      "executability_check": [
        "✅ 提供具体可操作的步骤指导",
        "✅ 工具调用顺序清晰",
        "✅ 并发执行点明确",
        "✅ 错误恢复路径完整",
        "✅ 输出格式可直接使用"
      ],
      "robustness_check": [
        "✅ 包含5种错误场景的处理策略",
        "✅ 定义降级方案（部分结果返回）",
        "✅ 设置超时和资源限制",
        "✅ 明确能力边界，避免过度承诺",
        "✅ 强调合规性和免责声明"
      ]
    },
    "template_metadata": {
      "file_path": "prompts/generated_agents_prompts/drug_feedback_collector/drug_feedback_collector.yaml",
      "format": "YAML",
      "encoding": "UTF-8",
      "version": "1.0",
      "status": "completed",
      "created_by": "Prompt Engineer Agent",
      "created_date": "2025-12-17",
      "based_on_template": "deep_research_agent",
      "customization_level": "high",
      "tags": [
        "data_collection",
        "web_search",
        "feedback_analysis",
        "report_generation",
        "drug_information",
        "healthcare"
      ],
      "supported_models": [
        "global.anthropic.claude-sonnet-4-5-20250929-v1:0"
      ],
      "tools_count": 11,
      "estimated_complexity": "medium-high",
      "estimated_response_time": {
        "cache_hit": "< 10 seconds",
        "full_process": "2-5 minutes"
      }
    },
    "testing_recommendations": {
      "test_cases": [
        {
          "case_id": "TC001",
          "description": "常见药物测试（阿司匹林）",
          "input": "阿司匹林",
          "expected_output": "成功生成包含至少10条反馈的完整报告",
          "success_criteria": "报告包含疗效、副作用、使用体验、情感分析和免责声明"
        },
        {
          "case_id": "TC002",
          "description": "英文药物名称测试（Aspirin）",
          "input": "Aspirin",
          "expected_output": "成功识别并生成报告",
          "success_criteria": "与中文名称搜索结果一致或高度相似"
        },
        {
          "case_id": "TC003",
          "description": "无效药物名称测试",
          "input": "abcdefg123",
          "expected_output": "友好的错误提示和建议",
          "success_criteria": "提示检查拼写并提供示例"
        },
        {
          "case_id": "TC004",
          "description": "缓存命中测试",
          "input": "布洛芬（第二次查询）",
          "expected_output": "从缓存快速返回结果",
          "success_criteria": "响应时间 < 10秒"
        },
        {
          "case_id": "TC005",
          "description": "罕见药物测试",
          "input": "某个罕见药物名称",
          "expected_output": "部分结果或数据质量警告",
          "success_criteria": "警告用户结果可能不全面"
        }
      ],
      "performance_benchmarks": [
        "缓存命中响应时间 < 10秒",
        "完整流程响应时间 < 5分钟",
        "成功率 > 95%",
        "每个报告至少10条有效反馈",
        "分类准确率 > 85%",
        "情感分析准确率 > 80%"
      ],
      "edge_cases": [
        "网络连接失败",
        "Tavily API配额耗尽",
        "目标网站拒绝访问",
        "LLM分析服务不可用",
        "缓存目录权限问题",
        "超大响应（> 60K tokens）"
      ]
    },
    "maintenance_notes": {
      "version_control": [
        "使用语义化版本号（当前：1.0）",
        "记录每次提示词修改的原因和影响",
        "保持与agent_designer.json的同步"
      ],
      "future_enhancements": [
        "增加更多数据来源（社交媒体、专业论坛）",
        "支持多药物对比分析",
        "增加可视化图表生成",
        "支持导出PDF格式报告",
        "集成专业医疗数据库（需要授权）",
        "增加用户反馈质量评分机制"
      ],
      "known_limitations": [
        "依赖Tavily API配额",
        "无法访问付费或登录墙后的内容",
        "医学准确性依赖公开反馈质量",
        "不支持图片和视频反馈",
        "中文药物信息可能少于英文"
      ],
      "deprecation_policy": [
        "当前版本标记为stable",
        "重大更新时创建新版本",
        "旧版本保留至少6个月",
        "提前30天通知弃用计划"
      ]
    }
  }
}