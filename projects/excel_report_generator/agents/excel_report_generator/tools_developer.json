{
  "tools_development": {
    "project_name": "excel_report_generator",
    "agent_name": "excel_report_generator",
    "version": "1.0",
    "date": "2025-11-18",
    "development_overview": "为Excel报表生成系统开发9个核心工具函数，确保每个工具都具备独立性、稳定性和幂等性",
    "tools_list": [
      {
        "tool_name": "excel_data_reader",
        "tool_id": "TL-001",
        "description": "Excel文件读取工具，支持.xlsx和.xls格式",
        "function_signature": "def excel_data_reader(file_path: str, sheet_name: Optional[str] = None, encoding: str = 'utf-8') -> Dict[str, Any]",
        "parameters": {
          "file_path": "str - Excel文件的完整路径",
          "sheet_name": "Optional[str] - 工作表名称，若为None则返回所有工作表列表",
          "encoding": "str - 文件编码，默认utf-8"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 操作是否成功",
            "data": "pd.DataFrame - 读取的数据",
            "sheets": "List[str] - 所有工作表名称列表",
            "metadata": "dict - 元数据包括：columns(列名列表), dtypes(数据类型), rows(行数), null_counts(空值统计)",
            "error": "str - 错误信息（如果操作失败）"
          }
        },
        "implementation_notes": [
          "使用openpyxl和xlrd支持多种Excel格式",
          "自动检测列数据类型",
          "记录空值位置和数量",
          "支持多工作表处理"
        ],
        "error_handling": [
          "文件不存在：返回文件未找到错误",
          "格式不支持：返回格式不支持错误",
          "权限不足：返回权限错误",
          "文件损坏：返回文件损坏错误"
        ],
        "idempotency": "完全幂等 - 相同输入返回相同输出",
        "testing_cases": [
          "正常Excel文件读取",
          "多工作表文件处理",
          "包含空值的数据",
          "混合数据类型",
          "文件不存在处理",
          "格式错误处理"
        ]
      },
      {
        "tool_name": "data_analyzer",
        "tool_id": "TL-002",
        "description": "数据深度分析工具，支持统计分析、趋势识别、相关性计算",
        "function_signature": "def data_analyzer(df: pd.DataFrame, analysis_config: Optional[Dict[str, Any]] = None) -> Dict[str, Any]",
        "parameters": {
          "df": "pd.DataFrame - 输入数据",
          "analysis_config": "Optional[Dict] - 分析配置，包括：numeric_cols(数值列列表), categorical_cols(分类列列表), time_col(时间列名称)"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "statistics": "dict - 基础统计：均值、中位数、标准差、最小值、最大值、四分位数等",
            "distributions": "dict - 数据分布特征",
            "correlations": "dict - 相关系数矩阵",
            "anomalies": "list - 异常值列表，包含位置和值",
            "trends": "dict - 时间序列趋势分析（如适用）",
            "insights": "list - 关键洞察总结",
            "recommendations": "list - 可视化建议"
          }
        },
        "implementation_notes": [
          "使用numpy和scipy进行统计计算",
          "使用IQR方法检测异常值",
          "自动识别时间序列数据",
          "计算Pearson相关系数矩阵",
          "使用固定随机种子确保幂等性"
        ],
        "error_handling": [
          "空DataFrame：返回空数据错误",
          "无数值列：返回无可分析数据错误",
          "NaN过多：返回数据质量警告",
          "内存不足：采用分块处理"
        ],
        "idempotency": "完全幂等 - 确定性算法，相同输入返回相同输出",
        "testing_cases": [
          "单列数据分析",
          "多列混合类型分析",
          "包含时间序列的数据",
          "包含异常值的数据",
          "空值处理",
          "大数据集处理"
        ]
      },
      {
        "tool_name": "generate_pie_chart",
        "tool_id": "TL-003",
        "description": "饼图生成工具，用于展示数据分布",
        "function_signature": "def generate_pie_chart(df: pd.DataFrame, category_col: str, value_col: str, title: str, output_path: str, color_palette: str = 'Set3') -> Dict[str, Any]",
        "parameters": {
          "df": "pd.DataFrame - 输入数据",
          "category_col": "str - 分类列名称",
          "value_col": "str - 数值列名称",
          "title": "str - 图表标题",
          "output_path": "str - PNG文件保存路径",
          "color_palette": "str - 颜色方案，默认Set3"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "chart_stats": "dict - 图表统计信息",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用matplotlib生成图表",
          "固定图表尺寸为8x8英寸，DPI为100",
          "使用固定的颜色方案和样式",
          "固定字体和字号",
          "使用固定随机种子",
          "支持PNG和SVG输出"
        ],
        "error_handling": [
          "列不存在：返回列未找到错误",
          "无数据：返回空数据错误",
          "写入失败：返回文件写入错误",
          "样式错误：降级到默认样式"
        ],
        "idempotency": "完全幂等 - 固定样式、参数、随机种子，生成完全相同的PNG",
        "testing_cases": [
          "正常饼图生成",
          "单个分类",
          "多个分类",
          "包含零值的数据",
          "包含负数的数据",
          "文件路径不存在"
        ]
      },
      {
        "tool_name": "generate_line_chart",
        "tool_id": "TL-004",
        "description": "折线图生成工具，用于展示趋势变化",
        "function_signature": "def generate_line_chart(df: pd.DataFrame, x_col: str, y_cols: Union[str, List[str]], title: str, output_path: str, style: str = 'seaborn-v0_8-darkgrid') -> Dict[str, Any]",
        "parameters": {
          "df": "pd.DataFrame - 输入数据",
          "x_col": "str - X轴列名称",
          "y_cols": "Union[str, List[str]] - Y轴列名称（支持多条线）",
          "title": "str - 图表标题",
          "output_path": "str - PNG文件保存路径",
          "style": "str - 图表样式，默认seaborn-v0_8-darkgrid"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "num_lines": "int - 折线数量",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用matplotlib生成图表",
          "固定图表尺寸为12x6英寸，DPI为100",
          "支持多条折线",
          "固定线条样式和颜色",
          "固定字体和字号",
          "使用固定随机种子"
        ],
        "error_handling": [
          "列不存在：返回列未找到错误",
          "无数据：返回空数据错误",
          "写入失败：返回文件写入错误"
        ],
        "idempotency": "完全幂等 - 固定所有参数，生成完全相同的PNG",
        "testing_cases": [
          "单条折线",
          "多条折线",
          "时间序列数据",
          "包含NaN值的数据",
          "单点数据",
          "文件路径不存在"
        ]
      },
      {
        "tool_name": "generate_heatmap",
        "tool_id": "TL-005",
        "description": "热图生成工具，用于展示数据密度或相关性",
        "function_signature": "def generate_heatmap(data: Union[pd.DataFrame, np.ndarray], title: str, output_path: str, cmap: str = 'YlOrRd', vmin: Optional[float] = None, vmax: Optional[float] = None) -> Dict[str, Any]",
        "parameters": {
          "data": "Union[pd.DataFrame, np.ndarray] - 输入数据或相关系数矩阵",
          "title": "str - 图表标题",
          "output_path": "str - PNG文件保存路径",
          "cmap": "str - 颜色映射方案，默认YlOrRd",
          "vmin": "Optional[float] - 最小值，用于颜色映射",
          "vmax": "Optional[float] - 最大值，用于颜色映射"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "shape": "tuple - 热图数据形状",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用seaborn生成热图",
          "固定图表尺寸根据数据大小自适应",
          "固定颜色映射方案",
          "显示数值注释",
          "固定字体和字号"
        ],
        "error_handling": [
          "数据为空：返回空数据错误",
          "数据不是2D：返回维度错误",
          "写入失败：返回文件写入错误"
        ],
        "idempotency": "完全幂等 - 固定所有参数，生成完全相同的PNG",
        "testing_cases": [
          "相关系数矩阵",
          "二维DataFrame",
          "二维numpy数组",
          "包含NaN值的数据",
          "单行或单列数据"
        ]
      },
      {
        "tool_name": "generate_bar_chart",
        "tool_id": "TL-006",
        "description": "柱状图生成工具，用于数据对比",
        "function_signature": "def generate_bar_chart(df: pd.DataFrame, x_col: str, y_col: str, title: str, output_path: str, orientation: str = 'vertical') -> Dict[str, Any]",
        "parameters": {
          "df": "pd.DataFrame - 输入数据",
          "x_col": "str - X轴列名称",
          "y_col": "str - Y轴列名称",
          "title": "str - 图表标题",
          "output_path": "str - PNG文件保存路径",
          "orientation": "str - 方向：vertical或horizontal，默认vertical"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "num_bars": "int - 柱子数量",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用matplotlib生成图表",
          "固定图表尺寸为10x6英寸，DPI为100",
          "固定柱子颜色和样式",
          "固定字体和字号",
          "支持竖直和水平方向"
        ],
        "error_handling": [
          "列不存在：返回列未找到错误",
          "无数据：返回空数据错误",
          "写入失败：返回文件写入错误"
        ],
        "idempotency": "完全幂等 - 固定所有参数，生成完全相同的PNG",
        "testing_cases": [
          "正常柱状图",
          "多个柱子",
          "包含负数的数据",
          "包含零值的数据",
          "文件路径不存在"
        ]
      },
      {
        "tool_name": "generate_scatter_plot",
        "tool_id": "TL-007",
        "description": "散点图生成工具，用于展示数据关系",
        "function_signature": "def generate_scatter_plot(df: pd.DataFrame, x_col: str, y_col: str, title: str, output_path: str, color_col: Optional[str] = None, size_col: Optional[str] = None) -> Dict[str, Any]",
        "parameters": {
          "df": "pd.DataFrame - 输入数据",
          "x_col": "str - X轴列名称",
          "y_col": "str - Y轴列名称",
          "title": "str - 图表标题",
          "output_path": "str - PNG文件保存路径",
          "color_col": "Optional[str] - 颜色编码列名称",
          "size_col": "Optional[str] - 大小编码列名称"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "num_points": "int - 散点数量",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用matplotlib生成图表",
          "固定图表尺寸为10x8英寸，DPI为100",
          "固定点的大小和透明度",
          "固定颜色方案",
          "固定字体和字号"
        ],
        "error_handling": [
          "列不存在：返回列未找到错误",
          "无数据：返回空数据错误",
          "写入失败：返回文件写入错误"
        ],
        "idempotency": "完全幂等 - 固定所有参数，生成完全相同的PNG",
        "testing_cases": [
          "基本散点图",
          "带颜色编码的散点图",
          "带大小编码的散点图",
          "包含NaN值的数据",
          "单点数据"
        ]
      },
      {
        "tool_name": "html_report_builder",
        "tool_id": "TL-008",
        "description": "HTML报告生成工具，生成包含分析逻辑和图表的专业HTML报告",
        "function_signature": "def html_report_builder(title: str, summary: str, analysis_results: Dict[str, Any], chart_paths: List[Dict[str, str]], conclusions: str, output_path: str, metadata: Optional[Dict] = None) -> Dict[str, Any]",
        "parameters": {
          "title": "str - 报告标题",
          "summary": "str - 报告摘要",
          "analysis_results": "Dict[str, Any] - 分析结果字典",
          "chart_paths": "List[Dict[str, str]] - 图表路径列表，格式：[{'title': '图表标题', 'path': '相对路径', 'description': '描述'}]",
          "conclusions": "str - 结论和建议",
          "output_path": "str - HTML文件保存路径",
          "metadata": "Optional[Dict] - 元数据，包括生成时间、数据源等"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 生成是否成功",
            "file_path": "str - 保存的文件路径",
            "file_size": "int - 文件大小（字节）",
            "num_charts": "int - 包含的图表数量",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "使用jinja2模板引擎",
          "生成响应式HTML，支持多种屏幕尺寸",
          "内嵌CSS样式，无需外部依赖",
          "使用相对路径引用图表",
          "包含完整的分析逻辑和结论",
          "支持暗黑模式和亮色模式"
        ],
        "error_handling": [
          "输出路径不可写：返回文件写入错误",
          "图表文件不存在：使用占位符替代",
          "模板错误：返回模板错误"
        ],
        "idempotency": "完全幂等 - 相同输入生成相同HTML内容（除时间戳外）",
        "testing_cases": [
          "完整报告生成",
          "包含多个图表的报告",
          "缺少部分图表的报告",
          "长篇幅分析内容",
          "文件路径不存在"
        ]
      },
      {
        "tool_name": "cache_manager",
        "tool_id": "TL-009",
        "description": "缓存管理工具，管理生成的图表和报告缓存",
        "function_signature": "def cache_manager(operation: str, session_id: str, file_info: Optional[Dict[str, Any]] = None, config: Optional[Dict[str, Any]] = None) -> Dict[str, Any]",
        "parameters": {
          "operation": "str - 操作类型：create_session, save_file, get_file, list_files, cleanup_session, cleanup_expired",
          "session_id": "str - 会话ID",
          "file_info": "Optional[Dict] - 文件信息，包括：name, content_hash, file_path, file_type",
          "config": "Optional[Dict] - 配置参数，包括：base_path, retention_days, max_size"
        },
        "returns": {
          "type": "Dict[str, Any]",
          "schema": {
            "success": "bool - 操作是否成功",
            "session_path": "str - 会话缓存目录",
            "file_path": "str - 文件路径（如适用）",
            "cache_size": "int - 缓存大小",
            "files": "list - 文件列表（如适用）",
            "error": "str - 错误信息（如果失败）"
          }
        },
        "implementation_notes": [
          "基础路径：.cache/excel_report_generator/",
          "会话目录格式：<session_id>/",
          "文件命名格式：<name>_<timestamp>.png",
          "支持内容哈希的文件复用检测",
          "支持过期文件自动清理（默认30天）",
          "支持缓存大小限制"
        ],
        "error_handling": [
          "目录创建失败：返回目录创建错误",
          "写入权限不足：返回权限错误",
          "磁盘空间不足：返回空间不足错误"
        ],
        "idempotency": "完全幂等 - 相同操作返回相同结果",
        "testing_cases": [
          "创建会话",
          "保存文件",
          "获取文件",
          "列出文件",
          "清理会话",
          "清理过期文件",
          "重复操作幂等性"
        ]
      }
    ],
    "dependencies": {
      "core_libraries": [
        "pandas>=2.0.0",
        "numpy>=1.24.0",
        "openpyxl>=3.10.0",
        "xlrd>=2.0.1",
        "matplotlib>=3.7.0",
        "seaborn>=0.12.0",
        "scipy>=1.10.0",
        "scikit-learn>=1.3.0",
        "jinja2>=3.1.0"
      ],
      "platform_dependencies": [
        "Python 3.13+"
      ],
      "optional_dependencies": [
        "plotly>=5.14.0 (用于交互式图表)"
      ]
    },
    "quality_assurance": {
      "testing_strategy": [
        "单元测试：每个工具函数都有独立的单元测试",
        "集成测试：测试工具之间的协作",
        "幂等性测试：验证相同输入返回相同输出",
        "性能测试：验证处理时间符合要求",
        "容错测试：验证错误处理机制"
      ],
      "code_standards": [
        "遵循PEP 8编码规范",
        "完整的函数文档字符串（docstring）",
        "类型提示（type hints）",
        "单元测试覆盖率目标：>95%"
      ],
      "performance_targets": [
        "excel_data_reader：1MB文件 <1秒",
        "data_analyzer：10000行数据 <5秒",
        "各图表生成工具：10000行数据 <10秒",
        "html_report_builder：<30秒",
        "cache_manager：<1秒"
      ]
    },
    "deployment_notes": {
      "tool_location": "tools/generated_tools/excel_report_generator/",
      "module_structure": [
        "excel_reader.py - excel_data_reader",
        "data_analysis.py - data_analyzer",
        "chart_generators.py - 所有图表生成工具",
        "report_builder.py - html_report_builder",
        "cache_manager.py - cache_manager",
        "__init__.py - 模块初始化和导出",
        "utils.py - 共享工具函数",
        "tests/ - 单元测试目录"
      ],
      "integration_notes": [
        "所有工具函数通过__init__.py导出",
        "Agent通过import导入工具函数",
        "工具函数应该是无状态的（除缓存外）",
        "错误处理应该返回统一格式的字典"
      ]
    },
    "status": "completed",
    "completion_date": "2025-11-18T04:10:15Z",
    "notes": "工具开发设计完成。所有工具都遵循统一的设计原则：独立性、稳定性、幂等性、可测试性。每个工具都有清晰的职责边界和完善的错误处理机制。"
  }
}